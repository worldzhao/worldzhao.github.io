<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://worldzhao.github.io</id>
    <title>æµ·ç§‹</title>
    <updated>2023-11-16T03:33:04.102Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://worldzhao.github.io"/>
    <link rel="self" href="https://worldzhao.github.io/atom.xml"/>
    <subtitle>å›å­ç”Ÿéå¼‚ä¹Ÿï¼Œå–„å‡äºç‰©ä¹Ÿã€‚</subtitle>
    <logo>https://worldzhao.github.io/images/avatar.png</logo>
    <icon>https://worldzhao.github.io/favicon.ico</icon>
    <rights>All rights reserved 2023, æµ·ç§‹</rights>
    <entry>
        <title type="html"><![CDATA[React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å•å…ƒæµ‹è¯•]]></title>
        <id>https://worldzhao.github.io/post/build-your-own-react-ui-library-4/</id>
        <link href="https://worldzhao.github.io/post/build-your-own-react-ui-library-4/">
        </link>
        <updated>2020-02-12T02:04:33.000Z</updated>
        <summary type="html"><![CDATA[<p>ä¸è½¯ä»¶æ“ä½œè¡Œä¸ºè¶Šæ¥è¿‘çš„æµ‹è¯•ï¼Œè¶Šèƒ½ç»™äºˆä½ ä¿¡å¿ƒã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä¸è½¯ä»¶æ“ä½œè¡Œä¸ºè¶Šæ¥è¿‘çš„æµ‹è¯•ï¼Œè¶Šèƒ½ç»™äºˆä½ ä¿¡å¿ƒã€‚</p>
<!--more -->
<ul>
<li><a href="https://juejin.im/post/5df9a39f6fb9a0165b4cdb26">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å‡†å¤‡å·¥ä½œ</a></li>
<li><a href="https://juejin.im/post/5dfb09b1e51d4558096d5f94">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å¼€å‘è°ƒè¯•</a></li>
<li><a href="https://juejin.im/post/5e030b926fb9a0162c487c7b">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-æ‰“åŒ…è¾“å‡º</a></li>
<li><a href="https://juejin.im/post/5e23e4035188252c6c478665">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å•å…ƒæµ‹è¯•</a></li>
</ul>
<h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h2>
<p>æœ¬èŠ‚ä¸»è¦è®²è¿°å¦‚ä½•åœ¨ç»„ä»¶åº“ä¸­å¼•å…¥<a href="https://jestjs.io/">jest</a>ä»¥åŠ<a href="https://testing-library.com/docs/react-testing-library/intro">@testing-library/react</a>ï¼Œè€Œä¸ä¼šæ·±å…¥å•å…ƒæµ‹è¯•çš„å­¦ä¹ ã€‚</p>
<p>å¦‚æœä½ å¯¹ä¸‹åˆ—é—®é¢˜æ„Ÿå…´è¶£ï¼š</p>
<ol>
<li>What-å•å…ƒæµ‹è¯•æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>Why-ä¸ºä»€ä¹ˆè¦å†™å•å…ƒæµ‹è¯•ï¼Ÿ</li>
<li>How-ç¼–å†™å•å…ƒæµ‹è¯•çš„æœ€ä½³å®è·µï¼Ÿ</li>
</ol>
<p>é‚£ä¹ˆå¯ä»¥çœ‹çœ‹ä»¥ä¸‹æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://thomlom.dev/test-react-testing-library/">Test React apps with React Testing Library</a>ï¼šé€šè¿‡ä¸€ä¸ª<code>&lt;Counter /&gt;</code>çš„ä¾‹å­å»¶ä¼¸ï¼Œé˜è¿°äº†é€‰æ‹©<code>React Testing Library</code>è€Œé<code>Enzyme</code>çš„ç†ç”±ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†ä¸€äº›å…¥é—¨æ•™å­¦ï¼›</li>
<li><a href="https://testing-library.com/docs/react-testing-library/intro">React Testing Library</a>ï¼š<code>@testing-library/react</code>çš„å®˜æ–¹æ–‡æ¡£ï¼Œè¯¥åº“æä¾›çš„ API åœ¨æŸä¸ªç¨‹åº¦ä¸Šå°±æ˜¯åœ¨æŒ‡å¼•å¼€å‘è€…è¿›è¡Œå•å…ƒæµ‹è¯•çš„æœ€ä½³å®è·µï¼›</li>
<li><a href="https://testing-library.com/docs/recipes">React Testing Library-examples</a>ï¼š<code>@testing-library/react</code>çš„ä¸€äº›å®ä¾‹ï¼Œæä¾›äº†å„ç§å¸¸è§åœºæ™¯çš„æµ‹è¯•ï¼›</li>
<li><a href="https://github.com/linesh-simplicity/linesh-simplicity.github.io/issues/200">React å•å…ƒæµ‹è¯•ç­–ç•¥åŠè½åœ°</a>ï¼šå¦‚æ ‡é¢˜æ‰€ç¤ºï¼Œå€¼å¾—ä¸€çœ‹ã€‚</li>
</ul>
<p>æœ¬èŠ‚æ‰€æœ‰ä»£ç å¯åœ¨ä»“åº“<a href="https://github.com/worldzhao/react-ui-library-tutorial/tree/chapter-4/test">chapter-4</a>åˆ†æ”¯ä¸­è·å–ã€‚</p>
<h2 id="ç›¸å…³é…ç½®">ç›¸å…³é…ç½®</h2>
<p>å®‰è£…ä¾èµ–ï¼š</p>
<pre><code class="language-bash">yarn add jest ts-jest @testing-library/react @testing-library/jest-dom identity-obj-proxy @types/jest @types/testing-library__react --dev
</code></pre>
<ul>
<li><a href="https://jestjs.io/">jest</a>: JavaScript æµ‹è¯•æ¡†æ¶ï¼Œä¸“æ³¨äºç®€æ´æ˜å¿«ï¼›</li>
<li><a href="https://github.com/kulshekhar/ts-jest">ts-jest</a>ï¼šä¸º<code>TypeScript</code>ç¼–å†™<code>jest</code>æµ‹è¯•ç”¨ä¾‹æä¾›æ”¯æŒï¼›</li>
<li><a href="https://testing-library.com/docs/react-testing-library/intro">@testing-library/react</a>ï¼šç®€å•è€Œå®Œæ•´çš„<code>React DOM</code>æµ‹è¯•å·¥å…·ï¼Œé¼“åŠ±è‰¯å¥½çš„æµ‹è¯•å®è·µï¼›</li>
<li><a href="https://testing-library.com/docs/ecosystem-jest-dom">@testing-library/jest-dom</a>ï¼šè‡ªå®šä¹‰çš„<code>jest</code>åŒ¹é…å™¨(<code>matchers</code>)ï¼Œç”¨äºæµ‹è¯•<code>DOM</code>çš„çŠ¶æ€ï¼ˆå³ä¸º<code>jest</code>çš„<code>except</code>æ–¹æ³•è¿”å›å€¼å¢åŠ æ›´å¤šä¸“æ³¨äº<code>DOM</code>çš„<code>matchers</code>ï¼‰ï¼›</li>
<li><a href="https://www.npmjs.com/package/identity-obj-proxy">identity-obj-proxy</a>ï¼šä¸€ä¸ªå·¥å…·åº“ï¼Œæ­¤å¤„ç”¨æ¥<code>mock</code>æ ·å¼æ–‡ä»¶ã€‚</li>
</ul>
<p>æ–°å»º<code>jest.config.js</code>ï¼Œå¹¶å†™å…¥ç›¸å…³é…ç½®ï¼Œæ›´å¤šé…ç½®å¯å‚è€ƒ<a href="https://jestjs.io/docs/en/configuration">jest å®˜æ–¹æ–‡æ¡£-é…ç½®</a>ï¼Œåªçœ‹å‡ ä¸ªå¸¸ç”¨çš„å°±å¯ä»¥ã€‚</p>
<p><strong>jest.config.js</strong></p>
<pre><code class="language-js">module.exports = {
  verbose: true,
  roots: ['&lt;rootDir&gt;/components'],
  moduleNameMapper: {
    '\\.(css|less|scss)$': 'identity-obj-proxy',
    '^components$': '&lt;rootDir&gt;/components/index.tsx',
    '^components(.*)$': '&lt;rootDir&gt;/components/$1',
  },
  testRegex: '(/test/.*|\\.(test|spec))\\.(ts|tsx|js)$',
  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx'],
  testPathIgnorePatterns: ['/node_modules/', '/lib/', '/esm/', '/dist/'],
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
};
</code></pre>
<p>ä¿®æ”¹<code>package.json</code>ï¼Œå¢åŠ æµ‹è¯•ç›¸å…³å‘½ä»¤ï¼Œå¹¶ä¸”ä»£ç æäº¤å‰ï¼Œè·‘æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚ä¸‹ï¼š</p>
<p><strong>package.json</strong></p>
<pre><code class="language-diff">&quot;scripts&quot;: {
  ...
+  &quot;test&quot;: &quot;jest&quot;,                         # æ‰§è¡Œjest
+  &quot;test:watch&quot;: &quot;jest --watch&quot;,           # watchæ¨¡å¼ä¸‹æ‰§è¡Œ
+  &quot;test:coverage&quot;: &quot;jest --coverage&quot;,     # ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
+  &quot;test:update&quot;: &quot;jest --updateSnapshot&quot;  # æ›´æ–°å¿«ç…§
},
...
&quot;lint-staged&quot;: {
  &quot;components/**/*.ts?(x)&quot;: [
    &quot;prettier --write&quot;,
    &quot;eslint --fix&quot;,
+   &quot;jest --bail --findRelatedTests&quot;,
    &quot;git add&quot;
  ],
  ...
}
</code></pre>
<p>ä¿®æ”¹<code>gulpfile.js</code>ä»¥åŠ<code>tsconfig.json</code>ï¼Œé¿å…æ‰“åŒ…æ—¶ï¼ŒæŠŠæµ‹è¯•æ–‡ä»¶ä¸€å¹¶å¤„ç†äº†ã€‚</p>
<p><strong>gulpfile.js</strong></p>
<pre><code class="language-diff">const paths = {
  ...
- scripts: ['components/**/*.{ts,tsx}', '!components/**/demo/*.{ts,tsx}'],
+ scripts: [
+   'components/**/*.{ts,tsx}',
+   '!components/**/demo/*.{ts,tsx}',
+   '!components/**/__tests__/*.{ts,tsx}',
+ ],
};
</code></pre>
<p><strong>tsconfig.json</strong></p>
<pre><code class="language-diff">{
- &quot;exclude&quot;: [&quot;components/**/demo&quot;]
+ &quot;exclude&quot;: [&quot;components/**/demo&quot;, &quot;components/**/__tests__&quot;]
}
</code></pre>
<h2 id="ç¼–å†™æµ‹è¯•ç”¨ä¾‹">ç¼–å†™æµ‹è¯•ç”¨ä¾‹</h2>
<p><code>&lt;Alert /&gt;</code>æ¯”è¾ƒç®€å•ï¼Œæ­¤å¤„åªä½œç¤ºä¾‹ç”¨ï¼Œç®€å•è¿›è¡Œä¸€ä¸‹å¿«ç…§æµ‹è¯•ã€‚</p>
<p>åœ¨å¯¹åº”ç»„ä»¶çš„æ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>__tests__</code>æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾æµ‹è¯•æ–‡ä»¶ï¼Œå…¶å†…æ–°å»º<code>index.test.tsx</code>æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<p><strong>components/alert/<strong>tests</strong>/index.test.tsx</strong></p>
<pre><code class="language-jsx">import React from 'react';
import { render } from '@testing-library/react';
import Alert from '../alert';

describe('&lt;Alert /&gt;', () =&gt; {
  test('should render default', () =&gt; {
    const { container } = render(&lt;Alert&gt;default&lt;/Alert&gt;);
    expect(container).toMatchSnapshot();
  });

  test('should render alert with type', () =&gt; {
    const kinds: any[] = ['info', 'warning', 'positive', 'negative'];

    const { getByText } = render(
      &lt;&gt;
        {kinds.map(k =&gt; (
          &lt;Alert kind={k} key={k}&gt;
            {k}
          &lt;/Alert&gt;
        ))}
      &lt;/&gt;,
    );

    kinds.forEach(k =&gt; {
      expect(getByText(k)).toMatchSnapshot();
    });
  });
});
</code></pre>
<p>æ›´æ–°ä¸€ä¸‹å¿«ç…§ï¼š</p>
<pre><code class="language-bash">yarn test:update
</code></pre>
<p>å¯ä»¥çœ‹è§åŒçº§ç›®å½•ä¸‹æ–°å¢äº†ä¸€ä¸ª<code>__snapshots__</code>æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜æ”¾å¯¹åº”æµ‹è¯•ç”¨ä¾‹çš„å¿«ç…§æ–‡ä»¶ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcbw704fpmj31c00r2wi4.jpg" alt="ç”Ÿæˆçš„å¿«ç…§æ–‡ä»¶" loading="lazy"></figure>
<p>å†æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼š</p>
<pre><code class="language-bash">yarn test
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcbw73egztj30uw0ee0u2.jpg" alt="é€šè¿‡æµ‹è¯•ç”¨ä¾‹" loading="lazy"></figure>
<p>å¯ä»¥å‘ç°æˆ‘ä»¬é€šè¿‡äº†æµ‹è¯•ç”¨ä¾‹ã€‚ã€‚ã€‚é¢ï¼Œè¿™é‡Œå½“ç„¶èƒ½é€šè¿‡ï¼Œä¸»è¦æ˜¯åç»­æˆ‘ä»¬è¿›è¡Œè¿­ä»£é‡æ„æ—¶ï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä¸æœ€è¿‘çš„ä¸€æ¬¡å¿«ç…§è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸å¿«ç…§ä¸ä¸€è‡´ï¼ˆç»“æ„å‘ç”Ÿäº†æ”¹å˜ï¼‰ï¼Œé‚£ä¹ˆç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹å°±æ— æ³•é€šè¿‡ã€‚</p>
<p>å¯¹äºå¿«ç…§æµ‹è¯•ï¼Œè¤’è´¬ä¸ä¸€ï¼Œè¿™ä¸ªä¾‹å­ä¹Ÿç€å®ç®€å•å¾—å¾ˆï¼Œç”šè‡³è¿æ‰©å±•çš„ <code>jest-dom</code>æä¾›çš„ <code>matchers</code> éƒ½æ²¡ç”¨ä¸Šï¼Œå¦‚ä½•ç¼–å†™ä¼˜ç§€çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€ä¸ªæ–°æ‰‹ï¼Œåªèƒ½è¯´å¤šçœ‹å¤šå†™å¤šå°è¯•ï¼Œæ¦‚è¿°æ¨èçš„æ–‡ç« å¾ˆä¸é”™ã€‚</p>
<p>æœ¬æ–‡å¦‚æœ‰é”™è¯¯ï¼Œæ³è¯·æŒ‡æ­£ï¼Œå…±åŒäº¤æµå­¦ä¹ ã€‚</p>
<p>To be Continued...</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[React ç»„ä»¶åº“æ­å»ºæŒ‡å—-æ‰“åŒ…è¾“å‡º]]></title>
        <id>https://worldzhao.github.io/post/build-your-own-react-ui-library-3/</id>
        <link href="https://worldzhao.github.io/post/build-your-own-react-ui-library-3/">
        </link>
        <updated>2019-12-25T07:15:14.000Z</updated>
        <summary type="html"><![CDATA[<p>é‡å¤´æˆæ¥äº†ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>é‡å¤´æˆæ¥äº†ã€‚</p>
<!--more -->
<ul>
<li><a href="https://juejin.im/post/5df9a39f6fb9a0165b4cdb26">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å‡†å¤‡å·¥ä½œ</a></li>
<li><a href="https://juejin.im/post/5dfb09b1e51d4558096d5f94">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å¼€å‘è°ƒè¯•</a></li>
<li><a href="https://juejin.im/post/5e030b926fb9a0162c487c7b">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-æ‰“åŒ…è¾“å‡º</a></li>
<li><a href="https://juejin.im/post/5e23e4035188252c6c478665">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å•å…ƒæµ‹è¯•</a></li>
</ul>
<h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h2>
<p><strong>å®¿ä¸»ç¯å¢ƒå„ä¸ç›¸åŒï¼Œéœ€è¦å°†æºç è¿›è¡Œç›¸å…³å¤„ç†åå‘å¸ƒè‡³ npmã€‚</strong></p>
<p>æ˜ç¡®ä»¥ä¸‹ç›®æ ‡ï¼š</p>
<ol>
<li>å¯¼å‡ºç±»å‹å£°æ˜æ–‡ä»¶</li>
<li>å¯¼å‡º <code>umd</code>/<code>Commonjs module</code>/<code>ES module</code> ç­‰ 3 ç§å½¢å¼ä¾›ä½¿ç”¨è€…å¼•å…¥</li>
<li>æ”¯æŒæ ·å¼æ–‡ä»¶ <code>css</code> å¼•å…¥ï¼Œè€Œéåªæœ‰<code>less</code></li>
<li>æ”¯æŒæŒ‰éœ€åŠ è½½</li>
</ol>
<p>æœ¬èŠ‚æ‰€æœ‰ä»£ç å¯åœ¨ä»“åº“<a href="https://github.com/worldzhao/react-ui-library-tutorial/tree/chapter-3/build">chapter-3</a>åˆ†æ”¯ä¸­è·å–ã€‚</p>
<h2 id="å¯¼å‡ºç±»å‹å£°æ˜æ–‡ä»¶">å¯¼å‡ºç±»å‹å£°æ˜æ–‡ä»¶</h2>
<p>æ—¢ç„¶æ˜¯ä½¿ç”¨<code>typescript</code>ç¼–å†™çš„ç»„ä»¶åº“ï¼Œé‚£ä¹ˆä½¿ç”¨è€…åº”å½“äº«å—åˆ°ç±»å‹ç³»ç»Ÿçš„å¥½å¤„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç”Ÿæˆç±»å‹å£°æ˜æ–‡ä»¶ï¼Œå¹¶åœ¨<code>package.json</code>ä¸­å®šä¹‰å…¥å£ï¼Œå¦‚ä¸‹ï¼š</p>
<p><strong>package.json</strong></p>
<pre><code class="language-json">{
  &quot;typings&quot;: &quot;types/index.d.ts&quot;, // å®šä¹‰ç±»å‹å…¥å£æ–‡ä»¶
  &quot;scripts&quot;: {
    &quot;build:types&quot;: &quot;tsc --emitDeclarationOnly&quot; // æ‰§è¡Œtscå‘½ä»¤ åªç”Ÿæˆå£°æ˜æ–‡ä»¶
  }
}
</code></pre>
<p>æ‰§è¡Œ<code>yarn build:types</code>ï¼Œå¯ä»¥å‘ç°æ ¹ç›®å½•ä¸‹å·²ç»ç”Ÿæˆäº†<code>types</code>æ–‡ä»¶å¤¹ï¼ˆ<code>tsconfig.json</code>ä¸­å®šä¹‰çš„<code>outDir</code>å­—æ®µï¼‰ï¼Œç›®å½•ç»“æ„ä¸<code>components</code>æ–‡ä»¶å¤¹ä¿æŒä¸€è‡´ï¼Œå¦‚ä¸‹ï¼š</p>
<p><strong>types</strong></p>
<pre><code>â”œâ”€â”€ alert
â”‚   â”œâ”€â”€ alert.d.ts
â”‚   â”œâ”€â”€ index.d.ts
â”‚   â”œâ”€â”€ interface.d.ts
â”‚   â””â”€â”€ style
â”‚       â””â”€â”€ index.d.ts
â””â”€â”€ index.d.ts
</code></pre>
<p>è¿™æ ·ä½¿ç”¨è€…å¼•å…¥<code>npm</code> åŒ…æ—¶ï¼Œä¾¿èƒ½å¾—åˆ°è‡ªåŠ¨æç¤ºï¼Œä¹Ÿèƒ½å¤Ÿå¤ç”¨ç›¸å…³ç»„ä»¶çš„ç±»å‹å®šä¹‰ã€‚</p>
<p>æ¥ä¸‹æ¥å°†<code>ts(x)</code>ç­‰æ–‡ä»¶å¤„ç†æˆ<code>js</code>æ–‡ä»¶ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦è¾“å‡º<code>Commonjs module</code>ä»¥åŠ<code>ES module</code>ä¸¤ç§æ¨¡å—ç±»å‹çš„æ–‡ä»¶ï¼ˆæš‚ä¸è€ƒè™‘<code>umd</code>ï¼‰ï¼Œä»¥ä¸‹ä½¿ç”¨<code>cjs</code>æŒ‡ä»£<code>Commonjs module</code>ï¼Œ<code>esm</code>æŒ‡ä»£<code>ES module</code>ã€‚<br/> å¯¹æ­¤æœ‰ç–‘é—®çš„åŒå­¦æ¨èé˜…è¯»ï¼š<a href="https://github.com/ShowJoy-com/showjoy-blog/issues/39">importã€requireã€exportã€module.exports æ··åˆè¯¦è§£</a></p>
</blockquote>
<h2 id="å¯¼å‡º-commonjs-æ¨¡å—">å¯¼å‡º Commonjs æ¨¡å—</h2>
<p>å…¶å®å®Œå…¨å¯ä»¥ä½¿ç”¨<code>babel</code>æˆ–<code>tsc</code>å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œä»£ç ç¼–è¯‘å¤„ç†ï¼ˆå®é™…ä¸Šå¾ˆå¤šå·¥å…·åº“å°±æ˜¯è¿™æ ·åšçš„ï¼‰ï¼Œä½†è€ƒè™‘åˆ°è¿˜è¦<strong>å¤„ç†æ ·å¼åŠå…¶æŒ‰éœ€åŠ è½½</strong>ï¼Œæˆ‘ä»¬å€ŸåŠ© <code>gulp</code> æ¥ä¸²èµ·è¿™ä¸ªæµç¨‹ã€‚</p>
<h3 id="babel-é…ç½®">babel é…ç½®</h3>
<p>é¦–å…ˆå®‰è£…<code>babel</code>åŠå…¶ç›¸å…³ä¾èµ–</p>
<pre><code class="language-bash">yarn add @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript @babel/plugin-proposal-class-properties  @babel/plugin-transform-runtime --dev
</code></pre>
<pre><code class="language-bash">yarn add @babel/runtime-corejs3
</code></pre>
<p>æ–°å»º<code>.babelrc.js</code>æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<p><strong>.babelrc.js</strong></p>
<pre><code class="language-js">module.exports = {
  presets: ['@babel/env', '@babel/typescript', '@babel/react'],
  plugins: [
    '@babel/proposal-class-properties',
    [
      '@babel/plugin-transform-runtime',
      {
        corejs: 3,
        helpers: true,
      },
    ],
  ],
};
</code></pre>
<p>å…³äº<code>@babel/plugin-transform-runtime</code>ä¸<code>@babel/runtime-corejs3</code>ï¼š</p>
<ul>
<li>è‹¥<code>helpers</code>é€‰é¡¹è®¾ç½®ä¸º<code>true</code>ï¼Œå¯æŠ½ç¦»ä»£ç ç¼–è¯‘è¿‡ç¨‹é‡å¤ç”Ÿæˆçš„ <code>helper</code> å‡½æ•°ï¼ˆ<code>classCallCheck</code>,<code>extends</code>ç­‰ï¼‰ï¼Œå‡å°ç”Ÿæˆçš„ä»£ç ä½“ç§¯ï¼›</li>
<li>è‹¥<code>corejs</code>è®¾ç½®ä¸º<code>3</code>ï¼Œå¯å¼•å…¥ä¸æ±¡æŸ“å…¨å±€çš„æŒ‰éœ€<code>polyfill</code>ï¼Œå¸¸ç”¨äºç±»åº“ç¼–å†™ï¼ˆæˆ‘æ›´æ¨èï¼šä¸å¼•å…¥<code>polyfill</code>ï¼Œè½¬è€Œå‘ŠçŸ¥ä½¿ç”¨è€…éœ€è¦å¼•å…¥ä½•ç§<code>polyfill</code>ï¼Œé¿å…é‡å¤å¼•å…¥æˆ–äº§ç”Ÿå†²çªï¼Œåé¢ä¼šè¯¦ç»†æåˆ°ï¼‰ã€‚</li>
</ul>
<p>æ›´å¤šå‚è§<a href="https://babeljs.io/docs/en/next/babel-plugin-transform-runtime">å®˜æ–¹æ–‡æ¡£-@babel/plugin-transform-runtime </a></p>
<p><strong>é…ç½®ç›®æ ‡ç¯å¢ƒ</strong></p>
<p>ä¸ºäº†é¿å…è½¬è¯‘æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„è¯­æ³•ï¼Œæ–°å»º<code>.browserslistrc</code>æ–‡ä»¶ï¼Œæ ¹æ®é€‚é…éœ€æ±‚ï¼Œå†™å…¥æ”¯æŒæµè§ˆå™¨èŒƒå›´ï¼Œä½œç”¨äº<code>@babel/preset-env</code>ã€‚</p>
<p><strong>.browserslistrc</strong></p>
<pre><code>&gt;0.2%
not dead
not op_mini all
</code></pre>
<p>å¾ˆé—æ†¾çš„æ˜¯ï¼Œ<code>@babel/runtime-corejs3</code>æ— æ³•åœ¨æŒ‰éœ€å¼•å…¥çš„åŸºç¡€ä¸Šæ ¹æ®ç›®æ ‡æµè§ˆå™¨æ”¯æŒç¨‹åº¦å†æ¬¡å‡å°‘<code>polyfill</code>çš„å¼•å…¥ï¼Œå‚è§<a href="https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md#babelruntime-for-target-environment">@babel/runtime for target environment </a>ã€‚</p>
<p>è¿™æ„å‘³ç€<code>@babel/runtime-corejs3</code> ç”šè‡³ä¼šåœ¨é’ˆå¯¹ç°ä»£å¼•æ“çš„æƒ…å†µä¸‹æ³¨å…¥æ‰€æœ‰å¯èƒ½çš„ <code>polyfill</code>ï¼šä¸å¿…è¦åœ°å¢åŠ äº†æœ€ç»ˆæ†ç»‘åŒ…çš„å¤§å°ã€‚</p>
<p>å¯¹äºç»„ä»¶åº“ï¼ˆä»£ç é‡å¯èƒ½å¾ˆå¤§ï¼‰ï¼Œä¸ªäººå»ºè®®å°†<code>polyfill</code>çš„é€‰æ‹©æƒäº¤è¿˜ç»™ä½¿ç”¨è€…ï¼Œåœ¨å®¿ä¸»ç¯å¢ƒè¿›è¡Œ<code>polyfill</code>ã€‚è‹¥ä½¿ç”¨è€…å…·æœ‰å…¼å®¹æ€§è¦æ±‚ï¼Œè‡ªç„¶ä¼šä½¿ç”¨<code>@babel/preset-env + core-js + .browserslistrc</code>è¿›è¡Œå…¨å±€<code>polyfill</code>ï¼Œè¿™å¥—ç»„åˆæ‹³å¼•å…¥äº†æœ€ä½ç›®æ ‡æµè§ˆå™¨ä¸æ”¯æŒ<code>API</code>çš„å…¨éƒ¨ <code>polyfill</code>ã€‚</p>
<blockquote>
<p>å°†<code>@babel/preset-env</code>çš„<code>useBuiltIns</code>é€‰é¡¹å€¼è®¾ç½®ä¸º <code>usage</code>ï¼ŒåŒæ—¶æŠŠ<code>node_modules</code>ä»<code>babel-loader</code>ä¸­<code>exclude</code>æ‰çš„åŒå­¦å¯èƒ½æƒ³è¦è¿™ä¸ªç‰¹æ€§ï¼š<a href="https://github.com/babel/babel/issues/9419">&quot;useBuiltIns: usage&quot; for node_modules without transpiling #9419</a>ï¼Œåœ¨æœªæ”¯æŒè¯¥<code>issue</code>æåˆ°çš„å†…å®¹ä¹‹å‰ï¼Œè¿˜æ˜¯ä¹–ä¹–åœ°å°†<code>useBuiltIns</code>è®¾ç½®ä¸º<code>entry</code>ï¼Œæˆ–è€…ä¸è¦æŠŠ<code>node_modules</code>ä»<code>babel-loader</code>ä¸­<code>exclude</code>ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ç»„ä»¶åº“ä¸ç”¨ç”»è›‡æ·»è¶³ï¼Œå¼•å…¥å¤šä½™çš„<code>polyfill</code>ï¼Œå†™å¥½æ–‡æ¡£è¯´æ˜ï¼Œæ¯”ä»€ä¹ˆéƒ½é‡è¦ï¼ˆå°±åƒ<a href="https://github.com/youzan/zent#required-polyfills">zent</a>å’Œ<a href="https://ant.design/docs/react/getting-started-cn#%E5%85%BC%E5%AE%B9%E6%80%A7">antd</a>è¿™æ ·ï¼‰ã€‚</p>
<p>ç°åœ¨<code>@babel/runtime-corejs3</code>æ›´æ¢ä¸º<code>@babel/runtime</code>ï¼Œåªè¿›è¡Œ<code>helper</code>å‡½æ•°æŠ½ç¦»ã€‚</p>
<pre><code class="language-bash">yarn remove @babel/runtime-corejs3

yarn add @babel/runtime
</code></pre>
<p><strong>.babelrc.js</strong></p>
<pre><code class="language-js">module.exports = {
  presets: ['@babel/env', '@babel/typescript', '@babel/react'],
  plugins: ['@babel/plugin-transform-runtime', '@babel/proposal-class-properties'],
};
</code></pre>
<blockquote>
<p><code>@babel/transform-runtime</code>çš„<code>helper</code>é€‰é¡¹é»˜è®¤ä¸º<code>true</code>ã€‚</p>
</blockquote>
<h3 id="gulp-é…ç½®">gulp é…ç½®</h3>
<p>å†æ¥å®‰è£…<code>gulp</code>ç›¸å…³ä¾èµ–</p>
<pre><code class="language-bash">yarn add gulp gulp-babel --dev
</code></pre>
<p>æ–°å»º<code>gulpfile.js</code>ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<p><strong>gulpfile.js</strong></p>
<pre><code class="language-js">const gulp = require('gulp');
const babel = require('gulp-babel');

const paths = {
  dest: {
    lib: 'lib', // commonjs æ–‡ä»¶å­˜æ”¾çš„ç›®å½•å - æœ¬å—å…³æ³¨
    esm: 'esm', // ES module æ–‡ä»¶å­˜æ”¾çš„ç›®å½•å - æš‚æ—¶ä¸å…³å¿ƒ
    dist: 'dist', // umdæ–‡ä»¶å­˜æ”¾çš„ç›®å½•å - æš‚æ—¶ä¸å…³å¿ƒ
  },
  styles: 'components/**/*.less', // æ ·å¼æ–‡ä»¶è·¯å¾„ - æš‚æ—¶ä¸å…³å¿ƒ
  scripts: ['components/**/*.{ts,tsx}', '!components/**/demo/*.{ts,tsx}'], // è„šæœ¬æ–‡ä»¶è·¯å¾„
};

function compileCJS() {
  const { dest, scripts } = paths;
  return gulp
    .src(scripts)
    .pipe(babel()) // ä½¿ç”¨gulp-babelå¤„ç†
    .pipe(gulp.dest(dest.lib));
}

// å¹¶è¡Œä»»åŠ¡ åç»­åŠ å…¥æ ·å¼å¤„ç† å¯ä»¥å¹¶è¡Œå¤„ç†
const build = gulp.parallel(compileCJS);

exports.build = build;

exports.default = build;
</code></pre>
<p>ä¿®æ”¹<code>package.json</code></p>
<p><strong>package.json</strong></p>
<pre><code class="language-diff">{
- &quot;main&quot;: &quot;index.js&quot;,
+ &quot;main&quot;: &quot;lib/index.js&quot;,
  &quot;scripts&quot;: {
    ...
+   &quot;clean&quot;: &quot;rimraf types lib esm dist&quot;,
+   &quot;build&quot;: &quot;npm run clean &amp;&amp; npm run build:types &amp;&amp; gulp&quot;,
    ...
  },
}
</code></pre>
<p>æ‰§è¡Œ<code>yarn build</code>ï¼Œå¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p>
<p><strong>lib</strong></p>
<pre><code>â”œâ”€â”€ alert
â”‚   â”œâ”€â”€ alert.js
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ interface.js
â”‚   â””â”€â”€ style
â”‚       â””â”€â”€ index.js
â””â”€â”€ index.js
</code></pre>
<p>è§‚å¯Ÿç¼–è¯‘åçš„æºç ï¼Œå¯ä»¥å‘ç°ï¼šè¯¸å¤š<code>helper</code>æ–¹æ³•å·²è¢«æŠ½ç¦»è‡³<code>@babel/runtime</code>ä¸­ï¼Œæ¨¡å—å¯¼å…¥å¯¼å‡ºå½¢å¼ä¹Ÿæ˜¯<code>commonjs</code>è§„èŒƒã€‚</p>
<p><strong>lib/alert/alert.js</strong></p>
<figure data-type="image" tabindex="1"><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gabgju58mlj30ve0u0k4o.jpg" alt="lib/alert/alert.js" loading="lazy"></figure>
<h2 id="å¯¼å‡º-es-module">å¯¼å‡º ES module</h2>
<p>ç”Ÿæˆ<code>ES module</code>å¯ä»¥æ›´å¥½åœ°è¿›è¡Œ<a href="https://webpack.docschina.org/guides/tree-shaking/">tree shaking</a>ï¼ŒåŸºäºä¸Šä¸€æ­¥çš„<code>babel</code>é…ç½®ï¼Œæ›´æ–°ä»¥ä¸‹å†…å®¹ï¼š</p>
<ol>
<li>é…ç½®<code>@babel/preset-env</code>çš„<code>modules</code>é€‰é¡¹ä¸º<code>false</code>ï¼Œå…³é—­æ¨¡å—è½¬æ¢ï¼›</li>
<li>é…ç½®<code>@babel/plugin-transform-runtime</code>çš„<code>useESModules</code>é€‰é¡¹ä¸º<code>true</code>ï¼Œä½¿ç”¨<code>ES module</code>å½¢å¼å¼•å…¥<code>helper</code>å‡½æ•°ã€‚</li>
</ol>
<p><strong>.babelrc.js</strong></p>
<pre><code class="language-js">module.exports = {
  presets: [
    [
      '@babel/env',
      {
        modules: false, // å…³é—­æ¨¡å—è½¬æ¢
      },
    ],
    '@babel/typescript',
    '@babel/react',
  ],
  plugins: [
    '@babel/proposal-class-properties',
    [
      '@babel/plugin-transform-runtime',
      {
        useESModules: true, // ä½¿ç”¨esmå½¢å¼çš„helper
      },
    ],
  ],
};
</code></pre>
<p>ç›®æ ‡è¾¾æˆï¼Œæˆ‘ä»¬å†ä½¿ç”¨ç¯å¢ƒå˜é‡åŒºåˆ†<code>esm</code>å’Œ<code>cjs</code>ï¼ˆæ‰§è¡Œä»»åŠ¡æ—¶è®¾ç½®å¯¹åº”çš„ç¯å¢ƒå˜é‡å³å¯ï¼‰ï¼Œæœ€ç»ˆ<code>babel</code>é…ç½®å¦‚ä¸‹ï¼š</p>
<p><strong>.babelrc.js</strong></p>
<pre><code class="language-js">module.exports = {
  presets: ['@babel/env', '@babel/typescript', '@babel/react'],
  plugins: ['@babel/plugin-transform-runtime', '@babel/proposal-class-properties'],
  env: {
    esm: {
      presets: [
        [
          '@babel/env',
          {
            modules: false,
          },
        ],
      ],
      plugins: [
        [
          '@babel/plugin-transform-runtime',
          {
            useESModules: true,
          },
        ],
      ],
    },
  },
};
</code></pre>
<p>æ¥ä¸‹æ¥ä¿®æ”¹<code>gulp</code>ç›¸å…³é…ç½®ï¼ŒæŠ½ç¦»<code>compileScripts</code>ä»»åŠ¡ï¼Œå¢åŠ <code>compileESM</code>ä»»åŠ¡ã€‚</p>
<p><strong>gulpfile.js</strong></p>
<pre><code class="language-js">// ...

/**
 * ç¼–è¯‘è„šæœ¬æ–‡ä»¶
 * @param {string} babelEnv babelç¯å¢ƒå˜é‡
 * @param {string} destDir ç›®æ ‡ç›®å½•
 */
function compileScripts(babelEnv, destDir) {
  const { scripts } = paths;
  // è®¾ç½®ç¯å¢ƒå˜é‡
  process.env.BABEL_ENV = babelEnv;
  return gulp
    .src(scripts)
    .pipe(babel()) // ä½¿ç”¨gulp-babelå¤„ç†
    .pipe(gulp.dest(destDir));
}

/**
 * ç¼–è¯‘cjs
 */
function compileCJS() {
  const { dest } = paths;
  return compileScripts('cjs', dest.lib);
}

/**
 * ç¼–è¯‘esm
 */
function compileESM() {
  const { dest } = paths;
  return compileScripts('esm', dest.esm);
}

// ä¸²è¡Œæ‰§è¡Œç¼–è¯‘è„šæœ¬ä»»åŠ¡ï¼ˆcjs,esmï¼‰ é¿å…ç¯å¢ƒå˜é‡å½±å“
const buildScripts = gulp.series(compileCJS, compileESM);

// æ•´ä½“å¹¶è¡Œæ‰§è¡Œä»»åŠ¡
const build = gulp.parallel(buildScripts);

// ...
</code></pre>
<p>æ‰§è¡Œ<code>yarn build</code>ï¼Œå¯ä»¥å‘ç°ç”Ÿæˆäº†<code>types</code>/<code>lib</code>/<code>esm</code>ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œè§‚å¯Ÿ<code>esm</code>ç›®å½•ï¼Œç»“æ„åŒ<code>lib</code>/<code>types</code>ä¸€è‡´ï¼Œjs æ–‡ä»¶éƒ½æ˜¯ä»¥<code>ES module</code>æ¨¡å—å½¢å¼å¯¼å…¥å¯¼å‡ºã€‚</p>
<p><strong>esm/alert/alert.js</strong></p>
<figure data-type="image" tabindex="2"><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gabgrzmgjqj311i0u0air.jpg" alt="esm/alert/alert.js" loading="lazy"></figure>
<p>åˆ«å¿˜äº†ç»™<code>package.json</code>å¢åŠ ç›¸å…³å…¥å£ã€‚</p>
<p><strong>package.json</strong></p>
<pre><code class="language-diff">{
+ &quot;module&quot;: &quot;esm/index.js&quot;
}
</code></pre>
<h2 id="å¤„ç†æ ·å¼æ–‡ä»¶">å¤„ç†æ ·å¼æ–‡ä»¶</h2>
<h3 id="æ‹·è´-less-æ–‡ä»¶">æ‹·è´ less æ–‡ä»¶</h3>
<p>æˆ‘ä»¬ä¼šå°†<code>less</code>æ–‡ä»¶åŒ…å«åœ¨<code>npm</code>åŒ…ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡<code>happy-ui/lib/alert/style/index.js</code>çš„å½¢å¼æŒ‰éœ€å¼•å…¥<code>less</code>æ–‡ä»¶ï¼Œæ­¤å¤„å¯ä»¥ç›´æ¥å°† less æ–‡ä»¶æ‹·è´è‡³ç›®æ ‡æ–‡ä»¶å¤¹ã€‚</p>
<p>åœ¨<code>gulpfile.js</code>ä¸­æ–°å»º<code>copyLess</code>ä»»åŠ¡ã€‚</p>
<p><strong>gulpfile.js</strong></p>
<pre><code class="language-js">// ...

/**
 * æ‹·è´lessæ–‡ä»¶
 */
function copyLess() {
  return gulp
    .src(paths.styles)
    .pipe(gulp.dest(paths.dest.lib))
    .pipe(gulp.dest(paths.dest.esm));
}

const build = gulp.parallel(buildScripts, copyLess);

// ...
</code></pre>
<p>è§‚å¯Ÿ<code>lib</code>ç›®å½•ï¼Œå¯ä»¥å‘ç° <code>less</code> æ–‡ä»¶å·²è¢«æ‹·è´è‡³<code>alert/style</code>ç›®å½•ä¸‹ã€‚</p>
<p><strong>lib</strong></p>
<pre><code>â”œâ”€â”€ alert
â”‚   â”œâ”€â”€ alert.js
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ interface.js
â”‚   â””â”€â”€ style
â”‚       â”œâ”€â”€ index.js
â”‚       â””â”€â”€ index.less # lessæ–‡ä»¶
â””â”€â”€ index.js
</code></pre>
<p>å¯èƒ½æœ‰äº›åŒå­¦å·²ç»å‘ç°é—®é¢˜ï¼šè‹¥ä½¿ç”¨è€…æ²¡æœ‰ä½¿ç”¨<code>less</code>é¢„å¤„ç†å™¨ï¼Œä½¿ç”¨çš„æ˜¯<code>sass</code>æ–¹æ¡ˆç”šè‡³åŸç”Ÿ<code>css</code>æ–¹æ¡ˆï¼Œé‚£ç°æœ‰æ–¹æ¡ˆå°±æä¸å®šäº†ã€‚ç»åˆ†æï¼Œæœ‰ä»¥ä¸‹ 3 ç§é¢„é€‰æ–¹æ¡ˆï¼š</p>
<ol>
<li>å‘ŠçŸ¥ç”¨æˆ·å¢åŠ <code>less-loader</code>ï¼›</li>
<li>æ‰“åŒ…å‡ºä¸€ä»½å®Œæ•´çš„ <code>css</code> æ–‡ä»¶ï¼Œè¿›è¡Œ<strong>å…¨é‡</strong>å¼•å…¥ï¼›</li>
<li>å•ç‹¬æä¾›ä¸€ä»½<code>style/css.js</code>æ–‡ä»¶ï¼Œå¼•å…¥çš„æ˜¯ç»„ä»¶ <code>css</code>æ–‡ä»¶ä¾èµ–ï¼Œè€Œé <code>less</code> ä¾èµ–ï¼Œç»„ä»¶åº“åº•å±‚æŠ¹å¹³å·®å¼‚ã€‚</li>
</ol>
<p>æ–¹æ¡ˆ 1 ä¼šå¯¼è‡´ä½¿ç”¨æˆæœ¬å¢åŠ ã€‚</p>
<p>æ–¹æ¡ˆ 2 æ— æ³•å¯¹æ ·å¼æ–‡ä»¶è¿›è¡ŒæŒ‰éœ€å¼•å…¥ï¼ˆåç»­åœ¨ <code>umd</code> æ‰“åŒ…æ—¶æˆ‘ä»¬ä¹Ÿä¼šæä¾›è¯¥æ ·å¼æ–‡ä»¶ï¼‰ã€‚</p>
<p>ä»¥ä¸Šä¸¤ç§æ–¹æ¡ˆå®ä¸ºä¸‹ç­–ï¼ˆç”»å¤–éŸ³ï¼šå¦‚æœä½¿ç”¨<code>css in js</code>å°±æ²¡æœ‰è¿™ä¹ˆå¤šå±äº‹äº†ï¼‰ã€‚</p>
<p>æ–¹æ¡ˆ 3 æ¯”è¾ƒç¬¦åˆæ­¤æ—¶çš„çš„åœºæ™¯ï¼Œ<code>antd</code>ä½¿ç”¨çš„ä¹Ÿæ˜¯è¿™ç§æ–¹æ¡ˆã€‚</p>
<p>åœ¨æ­å»ºç»„ä»¶åº“çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘å¾ˆä¹…ï¼šä¸ºä»€ä¹ˆéœ€è¦<code>alert/style/index.js</code>å¼•å…¥<code>less</code>æ–‡ä»¶æˆ–<code>alert/style/css.js</code>å¼•å…¥<code>css</code>æ–‡ä»¶ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯<strong>ç®¡ç†æ ·å¼ä¾èµ–</strong>ã€‚</p>
<p>å‡è®¾å­˜åœ¨ä»¥ä¸‹åœºæ™¯ï¼šå¼•å…¥<code>&lt;Button /&gt;</code>ï¼Œ<code>&lt;Button /&gt;</code>ä¾èµ–äº†<code>&lt;Icon /&gt;</code>ï¼Œä½¿ç”¨è€…éœ€è¦æ‰‹åŠ¨å»å¼•å…¥è°ƒç”¨çš„ç»„ä»¶çš„æ ·å¼ï¼ˆ<code>&lt;Button /&gt;</code>ï¼‰åŠå…¶ä¾èµ–çš„ç»„ä»¶æ ·å¼ï¼ˆ<code>&lt;Icon /&gt;</code>ï¼‰ï¼Œé‡åˆ°å¤æ‚ç»„ä»¶æå…¶éº»çƒ¦ï¼Œæ‰€ä»¥ç»„ä»¶åº“å¼€å‘è€…å¯ä»¥æä¾›ä¸€ä»½è¿™æ ·çš„<code>js</code>æ–‡ä»¶ï¼Œä½¿ç”¨è€…æ‰‹åŠ¨å¼•å…¥è¿™ä¸ª<code>js</code>æ–‡ä»¶ï¼Œå°±èƒ½å¼•å…¥å¯¹åº”ç»„ä»¶åŠå…¶ä¾èµ–ç»„ä»¶çš„æ ·å¼ã€‚</p>
<p>ç»§ç»­æˆ‘ä»¬çš„æ—…ç¨‹ã€‚</p>
<h3 id="ç”Ÿæˆ-css-æ–‡ä»¶">ç”Ÿæˆ css æ–‡ä»¶</h3>
<p>å®‰è£…ç›¸å…³ä¾èµ–ã€‚</p>
<pre><code class="language-bash">yarn add gulp-less gulp-autoprefixer gulp-cssnano --dev
</code></pre>
<p>å°†<code>less</code>æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„<code>css</code>æ–‡ä»¶ï¼Œåœ¨<code>gulpfile.js</code>ä¸­å¢åŠ <code>less2css</code>ä»»åŠ¡ã€‚</p>
<pre><code class="language-js">// ...

/**
 * ç”Ÿæˆcssæ–‡ä»¶
 */
function less2css() {
  return gulp
    .src(paths.styles)
    .pipe(less()) // å¤„ç†lessæ–‡ä»¶
    .pipe(autoprefixer()) // æ ¹æ®browserslistrcå¢åŠ å‰ç¼€
    .pipe(cssnano({ zindex: false, reduceIdents: false })) // å‹ç¼©
    .pipe(gulp.dest(paths.dest.lib))
    .pipe(gulp.dest(paths.dest.esm));
}

const build = gulp.parallel(buildScripts, copyLess, less2css);

// ...
</code></pre>
<p>æ‰§è¡Œ<code>yarn build</code>ï¼Œç»„ä»¶<code>style</code>ç›®å½•ä¸‹å·²ç»å­˜åœ¨<code>css</code>æ–‡ä»¶äº†ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ª<code>alert/style/css.js</code>æ¥å¸®ç”¨æˆ·å¼•å…¥<code>css</code>æ–‡ä»¶ã€‚</p>
<h3 id="ç”Ÿæˆ-cssjs">ç”Ÿæˆ css.js</h3>
<p>æ­¤å¤„å‚è€ƒ<a href="https://github.com/ant-design/antd-tools/blob/master/lib/gulpfile.js#L248">antd-tools</a>çš„å®ç°æ–¹å¼ï¼šåœ¨å¤„ç†<code>scripts</code>ä»»åŠ¡ä¸­ï¼Œæˆªä½<code>style/index.js</code>ï¼Œç”Ÿæˆ<code>style/css.js</code>ï¼Œå¹¶é€šè¿‡æ­£åˆ™å°†å¼•å…¥çš„<code>less</code>æ–‡ä»¶åç¼€æ”¹æˆ<code>css</code>ã€‚</p>
<p>å®‰è£…ç›¸å…³ä¾èµ–ã€‚</p>
<pre><code class="language-bash">yarn add through2 --dev
</code></pre>
<p><strong>gulpfile.js</strong></p>
<pre><code class="language-js">// ...

/**
 * ç¼–è¯‘è„šæœ¬æ–‡ä»¶
 * @param {*} babelEnv babelç¯å¢ƒå˜é‡
 * @param {*} destDir ç›®æ ‡ç›®å½•
 */
function compileScripts(babelEnv, destDir) {
  const { scripts } = paths;
  process.env.BABEL_ENV = babelEnv;
  return gulp
    .src(scripts)
    .pipe(babel()) // ä½¿ç”¨gulp-babelå¤„ç†
    .pipe(
      through2.obj(function z(file, encoding, next) {
        this.push(file.clone());
        // æ‰¾åˆ°ç›®æ ‡
        if (file.path.match(/(\/|\\)style(\/|\\)index\.js/)) {
          const content = file.contents.toString(encoding);
          file.contents = Buffer.from(cssInjection(content)); // æ–‡ä»¶å†…å®¹å¤„ç†
          file.path = file.path.replace(/index\.js/, 'css.js'); // æ–‡ä»¶é‡å‘½å
          this.push(file); // æ–°å¢è¯¥æ–‡ä»¶
          next();
        } else {
          next();
        }
      }),
    )
    .pipe(gulp.dest(destDir));
}

// ...
</code></pre>
<p><code>cssInjection</code>çš„å®ç°ï¼š</p>
<p><strong>gulpfile.js</strong></p>
<pre><code class="language-js">/**
 * å½“å‰ç»„ä»¶æ ·å¼ import './index.less' =&gt; import './index.css'
 * ä¾èµ–çš„å…¶ä»–ç»„ä»¶æ ·å¼ import '../test-comp/style' =&gt; import '../test-comp/style/css.js'
 * ä¾èµ–çš„å…¶ä»–ç»„ä»¶æ ·å¼ import '../test-comp/style/index.js' =&gt; import '../test-comp/style/css.js'
 * @param {string} content
 */
function cssInjection(content) {
  return content
    .replace(/\/style\/?'/g, &quot;/style/css'&quot;)
    .replace(/\/style\/?&quot;/g, '/style/css&quot;')
    .replace(/\.less/g, '.css');
}
</code></pre>
<p>å†è¿›è¡Œæ‰“åŒ…ï¼Œå¯ä»¥çœ‹è§ç»„ä»¶<code>style</code>ç›®å½•ä¸‹ç”Ÿæˆäº†<code>css.js</code>æ–‡ä»¶ï¼Œå¼•å…¥çš„ä¹Ÿæ˜¯ä¸Šä¸€æ­¥<code>less</code>è½¬æ¢è€Œæ¥çš„<code>css</code>æ–‡ä»¶ã€‚</p>
<p><strong>lib/alert</strong></p>
<pre><code>â”œâ”€â”€ alert.js
â”œâ”€â”€ index.js
â”œâ”€â”€ interface.js
â””â”€â”€ style
    â”œâ”€â”€ css.js # å¼•å…¥index.css
    â”œâ”€â”€ index.css
    â”œâ”€â”€ index.js
    â””â”€â”€ index.less
</code></pre>
<h2 id="æŒ‰éœ€åŠ è½½">æŒ‰éœ€åŠ è½½</h2>
<p>åœ¨ package.json ä¸­å¢åŠ <code>sideEffects</code>å±æ€§ï¼Œé…åˆ<code>ES module</code>è¾¾åˆ°<code>tree shaking</code>æ•ˆæœï¼ˆå°†æ ·å¼ä¾èµ–æ–‡ä»¶æ ‡æ³¨ä¸º<code>side effects</code>ï¼Œé¿å…è¢«è¯¯åˆ é™¤ï¼‰ã€‚</p>
<pre><code class="language-json">// ...
&quot;sideEffects&quot;: [
  &quot;dist/*&quot;,
  &quot;esm/**/style/*&quot;,
  &quot;lib/**/style/*&quot;,
  &quot;*.less&quot;
],
// ...
</code></pre>
<p>ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¼•å…¥ï¼Œå¯ä»¥åšåˆ°<code>js</code>éƒ¨åˆ†çš„æŒ‰éœ€åŠ è½½ï¼Œä½†éœ€è¦æ‰‹åŠ¨å¼•å…¥æ ·å¼ï¼š</p>
<pre><code class="language-js">import { Alert } from 'happy-ui';
import 'happy-ui/esm/alert/style';
</code></pre>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¼•å…¥ï¼š</p>
<pre><code class="language-js">import Alert from 'happy-ui/esm/alert'; // or import Alert from 'happy-ui/lib/alert';
import 'happy-ui/esm/alert/style'; // or import Alert from 'happy-ui/lib/alert';
</code></pre>
<p>ä»¥ä¸Šå¼•å…¥æ ·å¼æ–‡ä»¶çš„æ–¹å¼ä¸å¤ªä¼˜é›…ï¼Œç›´æ¥å¼•å…¥<strong>å…¨é‡</strong>æ ·å¼æ–‡ä»¶åˆå’ŒæŒ‰éœ€åŠ è½½çš„æœ¬æ„ç›¸å»ç”šè¿œã€‚</p>
<p>ä½¿ç”¨è€…å¯ä»¥å€ŸåŠ©<a href="https://www.npmjs.com/package/babel-plugin-import">babel-plugin-import</a>æ¥è¿›è¡Œè¾…åŠ©ï¼Œå‡å°‘ä»£ç ç¼–å†™é‡ã€‚</p>
<pre><code class="language-js">import { Alert } from 'happy-ui';
</code></pre>
<p>â¬‡ï¸</p>
<pre><code class="language-js">import Alert from 'happy-ui/lib/alert';
import 'happy-ui/lib/alert/style';
</code></pre>
<h2 id="ç”Ÿæˆ-umd">ç”Ÿæˆ umd</h2>
<p>çœŸæ­£æ„ä¹‰ä¸Šçš„â€œæ‰“åŒ…â€ï¼Œç”Ÿæˆå…¨é‡ <code>js</code>æ–‡ä»¶ å’Œ <code>css</code>æ–‡ä»¶ä¾›ä½¿ç”¨è€…å¤–é“¾å¼•å…¥ã€‚æ­¤å¤„é€‰æ‹©<code>rollup</code>è¿›è¡Œæ‰“åŒ…ã€‚</p>
<p>ç•™å‘å¾…å¡«ã€‚</p>
<p>To be Continued...</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å¼€å‘è°ƒè¯•]]></title>
        <id>https://worldzhao.github.io/post/build-your-own-react-ui-library-2/</id>
        <link href="https://worldzhao.github.io/post/build-your-own-react-ui-library-2/">
        </link>
        <updated>2019-12-22T11:05:45.000Z</updated>
        <summary type="html"><![CDATA[<p>MDXï¼Œæ–‡æ¡£ç”ŸèŠ±ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>MDXï¼Œæ–‡æ¡£ç”ŸèŠ±ã€‚</p>
<!-- more -->
<ul>
<li><a href="https://juejin.im/post/5df9a39f6fb9a0165b4cdb26">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å‡†å¤‡å·¥ä½œ</a></li>
<li><a href="https://juejin.im/post/5dfb09b1e51d4558096d5f94">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å¼€å‘è°ƒè¯•</a></li>
<li><a href="https://juejin.im/post/5e030b926fb9a0162c487c7b">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-æ‰“åŒ…è¾“å‡º</a></li>
<li><a href="https://juejin.im/post/5e23e4035188252c6c478665">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å•å…ƒæµ‹è¯•</a></li>
</ul>
<h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h2>
<p>æœ¬æ–‡è§£å†³å¼€å‘ç»„ä»¶æ—¶çš„é¢„è§ˆä»¥åŠè°ƒè¯•é—®é¢˜ï¼Œé¡ºè·¯è§£å†³æ–‡æ¡£ç¼–å†™ã€‚</p>
<p><strong>ç¼–å†™æ—¶å®Œå…¨æ— æ³•è¿›è¡Œé¢„è§ˆè°ƒè¯•</strong></p>
<p>æ­¤å¤„é€‰æ‹©<a href="https://github.com/doczjs/docz">docz</a>æ¥è¾…åŠ©é¢„è§ˆè°ƒè¯•ã€‚</p>
<blockquote>
<p><code>docz</code>åŸºäº<code>MDX</code>ï¼ˆMarkdown + JSXï¼‰ï¼Œå¯ä»¥åœ¨ Markdown ä¸­å¼•å…¥ React ç»„ä»¶ï¼Œä½¿å¾—ä¸€è¾¹ç¼–å†™æ–‡æ¡£ï¼Œä¸€è¾¹é¢„è§ˆè°ƒè¯•æˆä¸ºäº†å¯èƒ½ã€‚è€Œä¸”å¾—ç›Šäº React ç»„ä»¶ç”Ÿæ€ï¼Œæˆ‘ä»¬å¯ä»¥åƒç¼–å†™åº”ç”¨ä¸€èˆ¬ç¼–å†™æ–‡æ¡£ï¼Œä¸ä»…ä»…æ˜¯æ¯ç‡¥çš„æ–‡å­—ã€‚<code>docz</code> ä¹Ÿå†…ç½®äº†ä¸€äº›ç»„ä»¶ï¼Œæ¯”å¦‚<code>&lt;Playground&gt;</code>ã€‚</p>
</blockquote>
<p>æœ¬èŠ‚æ‰€æœ‰ä»£ç å¯åœ¨ä»“åº“<a href="https://github.com/worldzhao/react-ui-library-tutorial/tree/chapter-2/dev-and-doc">chapter-2</a>åˆ†æ”¯ä¸­è·å–ã€‚</p>
<h2 id="å®‰è£…-docz-ä»¥åŠè‡ªå®šä¹‰é…ç½®">å®‰è£… docz ä»¥åŠè‡ªå®šä¹‰é…ç½®</h2>
<pre><code class="language-bash">yarn add docz --dev

yarn add rimraf --dev # æ¸…ç©ºç›®å½•çš„ä¸€ä¸ªè¾…åŠ©åº“
</code></pre>
<p>å¢åŠ  <code>npm scripts</code> è‡³ <code>package.json</code>ã€‚</p>
<pre><code class="language-json">&quot;scripts&quot;: {
  &quot;dev&quot;: &quot;docz dev&quot;, // å¯åŠ¨æœ¬åœ°å¼€å‘ç¯å¢ƒ
  &quot;start&quot;: &quot;npm run dev&quot;, // devå‘½ä»¤åˆ«å
  &quot;build:doc&quot;: &quot;rimraf doc-site &amp;&amp; docz build&quot;, // åç»­ä¼šé…ç½®æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶ç›®å½•åä¸ºdoc-siteï¼Œæ•…æ¯æ¬¡buildå‰åˆ é™¤
  &quot;preview:doc&quot;: &quot;docz serve&quot; // é¢„è§ˆæ–‡æ¡£ç«™ç‚¹
},
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šæœ¬èŠ‚æ‰€æœ‰æ“ä½œéƒ½æ˜¯é’ˆå¯¹ç«™ç‚¹åº”ç”¨ã€‚<code>æ‰“åŒ…</code>æŒ‡ä»£æ–‡æ¡£ç«™ç‚¹æ‰“åŒ…ï¼Œè€Œéç»„ä»¶åº“ã€‚</p>
</blockquote>
<p>æ–°å»º<code>doczrc.js</code>é…ç½®æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<p><strong>doczrc.js</strong></p>
<pre><code class="language-js">export default {
  files: './components/**/*.{md,markdown,mdx}', // è¯†åˆ«çš„æ–‡ä»¶åç¼€
  dest: 'doc-site', // æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶ç›®å½•å
  title: 'happy-ui', // ç«™ç‚¹æ ‡é¢˜
  typescript: true, // ç»„ä»¶æºæ–‡ä»¶æ˜¯é€šè¿‡typescriptå¼€å‘ï¼Œéœ€è¦æ‰“å¼€æ­¤é€‰é¡¹
};
</code></pre>
<p>ç”±äºä½¿ç”¨äº†<code>less</code>ä½œä¸ºæ ·å¼é¢„å¤„ç†å™¨ï¼Œæ•…éœ€è¦å®‰è£… less æ’ä»¶ã€‚</p>
<pre><code class="language-bash">yarn add less gatsby-plugin-less --dev
</code></pre>
<p>æ–°å»º<code>gatsby-config.js</code>ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<p><strong>gatsby-config.js</strong></p>
<pre><code class="language-js">module.exports = {
  plugins: ['gatsby-theme-docz', 'gatsby-plugin-less'],
};
</code></pre>
<h2 id="ç¼–å†™æ–‡æ¡£">ç¼–å†™æ–‡æ¡£</h2>
<p>æ–°å»º<code>components/alert/index.mdx</code>ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-md">---
name: Alert è­¦å‘Šæç¤º
route: /Alert
menu: ç»„ä»¶
---

import { Playground } from 'docz'; import Alert from './alert'; // å¼•å…¥ç»„ä»¶ import './style'; // å¼•å…¥ç»„ä»¶æ ·å¼

# Alert è­¦å‘Šæç¤º

è­¦å‘Šæç¤ºï¼Œå±•ç°éœ€è¦å…³æ³¨çš„ä¿¡æ¯ã€‚

## ä»£ç æ¼”ç¤º

### åŸºæœ¬ç”¨æ³•

&lt;Playground&gt;
  &lt;Alert kind=&quot;warning&quot;&gt;è¿™æ˜¯ä¸€æ¡è­¦å‘Šæç¤º&lt;/Alert&gt;
&lt;/Playground&gt;

## API

| å±æ€§ | è¯´æ˜     | ç±»å‹                                         | é»˜è®¤å€¼ |
| ---- | -------- | -------------------------------------------- | ------ |
| kind | è­¦å‘Šç±»å‹ | 'info'/'positive'/'negative'/'warning'éå¿…å¡« | 'info' |
</code></pre>
<p>æ‰§è¡Œè„šæœ¬å‘½ä»¤ï¼š</p>
<pre><code class="language-bash">yarn start # or yarn dev
</code></pre>
<p>å¯ä»¥åœ¨<code>localhost:3000</code>çœ‹åˆ°å¦‚ä¸‹é¡µé¢ ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1ga1ujda771j31j50u0h06.jpg" alt="æ–‡æ¡£ç«™ç‚¹" loading="lazy"></figure>
<p>ç°åœ¨å¯ä»¥åœ¨<code>index.mdx</code>ä¸­æ„‰å¿«åœ°è¿›è¡Œæ–‡æ¡£ç¼–å†™å’Œè°ƒè¯•äº†ï¼</p>
<p>å€˜è‹¥æœ¬æ–‡åˆ°äº†è¿™é‡Œå°±ç»“æŸï¼ˆå…¶å®ä¹Ÿå¯ä»¥ç»“æŸäº†<code>(_^â–½^_)</code>ï¼‰ï¼Œé‚£æˆ‘åªæ˜¯å®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘å¤è¯»æœºç½¢äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç»§ç»­å‘ä¸‹çœ‹ã€‚</p>
<h2 id="ä¼˜åŒ–æ–‡æ¡£ç¼–å†™">ä¼˜åŒ–æ–‡æ¡£ç¼–å†™</h2>
<p>å¦‚æœ<code>ä»£ç æ¼”ç¤º</code>éƒ¨åˆ†çš„<code>demo</code>è¾ƒå¤šï¼ˆæ¯”å¦‚åŸºæœ¬ç”¨æ³•ã€é«˜çº§ç”¨æ³•ä»¥åŠå„ç§ç”¨æ³•ç­‰ç­‰ï¼‰ï¼Œåœ¨ç»„ä»¶å¤æ‚çš„æƒ…å†µä¸‹ï¼ˆæ¯•ç«Ÿ<code>&lt;Alert/&gt;</code>ç€å®å¤ªç®€å•äº†ï¼‰ï¼Œä¼šå¯¼è‡´æ–‡æ¡£å¾ˆé•¿éš¾ä»¥ç»´æŠ¤ï¼Œä½ åˆ°åº•æ˜¯åœ¨å†™æ–‡æ¡£å‘¢è¿˜æ˜¯åœ¨å†™ä»£ç å‘¢ï¼Ÿ</p>
<p>é‚£å°±æŠ½ç¦»å§ã€‚</p>
<p>åœ¨<code>components/alert/</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>demo</code>æ–‡ä»¶å¤¹ï¼Œå­˜æ”¾æˆ‘ä»¬åœ¨ç¼–å†™æ–‡æ¡£æ—¶éœ€è¦å¼•ç”¨çš„ <code>demo</code>ã€‚</p>
<p><strong>components/alert/demo/1-demo-basic.tsx</strong></p>
<pre><code class="language-jsx">import React from 'react';
import Alert from '../alert';
import '../style';

export default () =&gt; &lt;Alert kind=&quot;warning&quot;&gt;&lt;/Alert&gt;;
</code></pre>
<p><strong>components/alert/index.mdx</strong></p>
<pre><code class="language-diff">- import Alert from './alert'; // å¼•å…¥ç»„ä»¶
- import './style'; // å¼•å…¥ç»„ä»¶æ ·å¼
+ import BasicDemo from './demo/1-demo-basic';

...

&lt;Playground&gt;
- &lt;Alert kind=&quot;warning&quot;&gt;è¿™æ˜¯ä¸€æ¡è­¦å‘Šæç¤º&lt;/Alert&gt;
+ &lt;BasicDemo /&gt;
&lt;/Playground&gt;
</code></pre>
<p>è¿™æ ·æˆ‘ä»¬å°±å°† demo ä¸æ–‡æ¡£è¿›è¡Œäº†åˆ†éš”ã€‚é¢„è§ˆå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1ga1v3li0poj31l80u0wix.jpg" alt="æ–‡æ¡£é‡æ„" loading="lazy"></figure>
<p>ç­‰ç­‰ï¼Œä½ ä¸‹é¢æ˜¾ç¤ºçš„é‚£ä¸ª<code>&lt;BasicDemo /&gt;</code>æœ‰ç‚¹æ’©äººï¼Œè¿™é‡Œåº”è¯¥æ˜¯ç»™ç”¨æˆ·çˆ¸çˆ¸ä»¬<code>copy</code>çš„<code>demo</code>æºç ï¼Œä½ å¼„ä¸€ä¸ªæ ‡ç­¾åœ¨è¿™é‡Œï¼Œç”¨æˆ·çˆ¸çˆ¸è‚¯å®šä¸å¼€å¿ƒ ğŸ™…â€â™€ï¸ã€‚</p>
<p>ç„¶è€Œ<code>&lt;Playground /&gt;</code>ç»„ä»¶æš‚æ—¶æ— æ³•æ”¯æŒä¸Šè¿°å½¢å¼çš„å±•ç¤ºï¼šè‡ªå®šä¹‰ä¸‹æ–¹å±•ç¤ºçš„ä»£ç ï¼Œè€Œé<code>&lt;Playground /&gt;</code>å†…éƒ¨çš„ä»£ç ã€‚ç›¸å…³è®¨è®ºå¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://github.com/doczjs/docz/pull/907">Allow to hide the LiveError overlay #907 </a></li>
<li><a href="https://github.com/doczjs/docz/pull/906">Allow to override the playground's editor's code #906 </a></li>
</ul>
<p>å…¶å®ç¬¬ä¸€æ¡ <code>PR</code> å·²ç»è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯è¢«å…³é—­äº†ï¼Œæ— å¥ˆã€‚</p>
<p>ä¸è¿‡æ—¢ç„¶éƒ½èƒ½å¼•å…¥ React ç»„ä»¶äº†ï¼Œåœ¨<code>MDX</code>çš„ç¯å¢ƒä¸‹è‡ªå®šä¹‰ä¸€ä¸ª<code>Playground</code>ç»„ä»¶åˆæœ‰ä½•éš¾å‘¢ï¼Œæ— éå°±æ˜¯æ¸²æŸ“ç»„ä»¶ï¼ˆMDX è‡ªå¸¦ï¼‰å’Œå±•ç¤ºæºç ï¼Œç®€å•å¼€æ”¾çš„ä¸œè¥¿å¤§å®¶éƒ½æ˜¯å–œé—»ä¹è§çš„ï¼Œå°±å«<code>HappyBox</code>å§ã€‚</p>
<h2 id="ä¼˜åŒ–ä»£ç å±•ç¤º">ä¼˜åŒ–ä»£ç å±•ç¤º</h2>
<h3 id="ç¼–å†™-happybox-ç»„ä»¶">ç¼–å†™ <code>&lt;HappyBox /&gt;</code>ç»„ä»¶</h3>
<p>å®‰è£…ä¾èµ–ï¼š</p>
<pre><code>yarn add react-use antd react-simple-code-editor prismjs react-copy-to-clipboard raw-loader --dev
</code></pre>
<ul>
<li><a href="https://github.com/streamich/react-use">react-use</a> - 2020 å¹´äº†ï¼Œå½“ç„¶è¦ç”¨<code>hooks</code></li>
<li><a href="https://ant.design/">antd</a> - ä½¿ç”¨ä¸€äº›è¾…åŠ©ç»„ä»¶</li>
<li><a href="https://github.com/satya164/react-simple-code-editor">react-simple-code-editor</a> - ä»£ç å±•ç¤ºåŒºåŸŸ</li>
<li><a href="https://github.com/PrismJS/prism">prismjs</a> - ä»£ç é«˜äº®</li>
<li><a href="https://github.com/webpack-contrib/raw-loader">raw-loader</a> - å°†æºç è½¬æˆå­—ç¬¦ä¸²</li>
<li><a href="https://github.com/nkbt/react-copy-to-clipboard">react-copy-to-clipboard</a> - è®©ç”¨æˆ·çˆ¸çˆ¸ä»¬èƒ½å¤Ÿ copy demo ä»£ç </li>
</ul>
<blockquote>
<p>è¿™äº›ä¾èµ–éƒ½æ˜¯æœåŠ¡äºæ–‡æ¡£ç«™ç‚¹åº”ç”¨ï¼Œå’Œç»„ä»¶åº“è‡ªèº«æ¯«æ— å…³è”ã€‚</p>
</blockquote>
<p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1ga1ynynxxlj31dg0u0tde.jpg" alt="æœ€ç»ˆæ•ˆæœ" loading="lazy"></figure>
<p>æ ¹ç›®å½•ä¸‹æ–°å»º<code>doc-comps</code>æ–‡ä»¶å¤¹ï¼Œå­˜æ”¾æ–‡æ¡£ä¸­ä½¿ç”¨çš„ä¸€äº›å·¥å…·ç»„ä»¶ï¼Œæ¯”å¦‚<code>&lt;HappyBox /&gt;</code>ã€‚</p>
<p><strong>doc-comps</strong></p>
<pre><code>â”œâ”€â”€ happy-box
â”‚   â”œâ”€â”€ index.less
â”‚   â””â”€â”€ index.tsx
â””â”€â”€ index.ts
</code></pre>
<p><strong>components/doc-comps/happy-box/index.tsx</strong></p>
<pre><code class="language-jsx">import React from 'react';
import Editor from 'react-simple-code-editor';
import CopyToClipboard from 'react-copy-to-clipboard';
import useToggle from 'react-use/esm/useToggle';
import { Divider, Typography, Icon, Tooltip, message } from 'antd';
import { highlight, languages } from 'prismjs/components/prism-core';

import 'prismjs/components/prism-clike';
import 'prismjs/components/prism-javascript';
import 'prismjs/components/prism-markup';
import './index.less';

require('prismjs/components/prism-jsx');

const { Text } = Typography;
interface Props {
  code: string;
  title?: React.ReactNode;
  desc?: React.ReactNode;
}

const HappyBox: React.FC&lt;Props&gt; = ({ code, title, desc, children }) =&gt; {
  const [isEditVisible, toggleEditVisible] = useToggle(false);

  return (
    &lt;div className=&quot;code-box&quot;&gt;
      &lt;section className=&quot;code-box-demo&quot;&gt; {children}&lt;/section&gt;
      &lt;section className=&quot;code-box-meta&quot;&gt;
        &lt;Divider orientation=&quot;left&quot;&gt;{title || 'ç¤ºä¾‹'}&lt;/Divider&gt;
        &lt;div className=&quot;code-box-description&quot;&gt;
          &lt;Text&gt;{desc || 'æš‚æ— æè¿°'}&lt;/Text&gt;
        &lt;/div&gt;
        &lt;Divider dashed&gt;&lt;/Divider&gt;
        &lt;div className=&quot;code-box-action&quot;&gt;
          &lt;Tooltip placement=&quot;top&quot; title={'å¤åˆ¶ä»£ç '}&gt;
            &lt;CopyToClipboard text={code} onCopy={() =&gt; message.success('å¤åˆ¶æˆåŠŸ')}&gt;
              &lt;Icon type=&quot;copy&quot; /&gt;
            &lt;/CopyToClipboard&gt;
          &lt;/Tooltip&gt;
          &lt;Tooltip placement=&quot;top&quot; title={isEditVisible ? 'æ”¶èµ·ä»£ç ' : 'æ˜¾ç¤ºä»£ç '}&gt;
            &lt;Icon type=&quot;code&quot; onClick={toggleEditVisible} /&gt;
          &lt;/Tooltip&gt;
        &lt;/div&gt;
      &lt;/section&gt;
      {renderEditor()}
    &lt;/div&gt;
  );

  /* ä»£ç å±•ç¤ºåŒºåŸŸ */
  function renderEditor() {
    if (!isEditVisible) return null;
    return (
      &lt;div className=&quot;container_editor_area&quot;&gt;
        &lt;Editor
          readOnly
          value={code}
          onValueChange={() =&gt; {}}
          highlight={code =&gt; highlight(code, languages.jsx)}
          padding={10}
          className=&quot;container__editor&quot;
          style={{
            fontFamily: '&quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace',
            fontSize: 14,
          }}
        /&gt;
      &lt;/div&gt;
    );
  }
};

export default HappyBox;
</code></pre>
<h3 id="ç›¸å…³é…ç½®å˜æ›´">ç›¸å…³é…ç½®å˜æ›´</h3>
<ul>
<li>å¢åŠ  <code>alias</code>åˆ«åï¼Œæºç å±•ç¤ºç›¸å¯¹è·¯å¾„ä¸å¤Ÿå‹å¥½ï¼›</li>
<li>antd æŒ‰éœ€å¼•å…¥ï¼Œå³ä½¿æ˜¯ç«™ç‚¹åº”ç”¨ã€‚</li>
</ul>
<p>æ–°å»º<code>gatsby-node.js</code>ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ä»¥å¼€å¯<code>alias</code>ï¼š</p>
<pre><code class="language-js">const path = require('path');

exports.onCreateWebpackConfig = args =&gt; {
  args.actions.setWebpackConfig({
    resolve: {
      modules: [path.resolve(__dirname, '../src'), 'node_modules'],
      alias: {
        'happy-ui/lib': path.resolve(__dirname, '../components/'),
      },
    },
  });
};
</code></pre>
<p><code>antd</code> æŒ‰éœ€å¼•å…¥ï¼Œå®‰è£…ä¾èµ–ï¼Œå¹¶é…ç½®<code>gatsby-config.js</code>ï¼š</p>
<pre><code class="language-bash">yarn add babel-plugin-import gatsby-plugin-import --dev
</code></pre>
<p><strong>gatsby-config.js</strong></p>
<pre><code class="language-js">module.exports = {
  plugins: [
    'gatsby-theme-docz',
    'gatsby-plugin-less',
    {
      resolve: 'gatsby-plugin-import',
      options: {
        libraryName: 'antd',
        style: 'css',
      },
    },
  ],
};
</code></pre>
<p><code>tsconfig.json</code> å¿½ç•¥<code>demo</code>ï¼Œé¿å…ç»„ä»¶åº“æ‰“åŒ…ç”Ÿæˆ<code>types</code>æ—¶åŒ…å«å…¶ä¸­ï¼š</p>
<p><strong>tsconfig.json</strong></p>
<pre><code class="language-diff">{
  &quot;compilerOptions&quot;: {
    &quot;allowJs&quot;: false,
    &quot;target&quot;: &quot;esnext&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;jsx&quot;: &quot;react&quot;,
    &quot;declaration&quot;: true,
    &quot;outDir&quot;: &quot;types&quot;,
    &quot;strict&quot;: true,
    &quot;moduleResolution&quot;: &quot;node&quot;,
    &quot;allowSyntheticDefaultImports&quot;: true,
    &quot;esModuleInterop&quot;: true
  },
  &quot;include&quot;: [&quot;components&quot;],
+ &quot;exclude&quot;: [&quot;components/**/demo&quot;]
}
</code></pre>
<h3 id="æ”¹é€ ç›¸å…³æ–‡ä»¶">æ”¹é€ ç›¸å…³æ–‡ä»¶</h3>
<p><strong>components/alert/demo/1-demo-basic.tsx</strong></p>
<pre><code class="language-diff">- import Alert from '../alert';
+ import Alert from 'happy-ui/lib/alert';

- import '../style';
+ import 'happy-ui/lib/alert/style';
</code></pre>
<p><strong>components/alert/index.mdx</strong></p>
<pre><code class="language-diff">- import { Playground } from 'docz';
+ import { HappyBox } from '../../doc-comps';

+ import BasicDemoCode from '!raw-loader!./demo/1-demo-basic.tsx';

...

- &lt;Playground&gt;
-   &lt;BasicDemo /&gt;
- &lt;/Playground&gt;

+ &lt;HappyBox code={BasicDemoCode} title=&quot;åŸºæœ¬ç”¨æ³•&quot; desc=&quot;ä½¿ç”¨kindæ§åˆ¶Alertç±»å‹&quot;&gt;
+  &lt;BasicDemo /&gt;
+ &lt;/HappyBox&gt;
</code></pre>
<h3 id="å…¶ä»–">å…¶ä»–</h3>
<p><strong>.eslintignore</strong></p>
<pre><code class="language-diff">+ doc-comps
+ demo
</code></pre>
<p><code>yarn start</code>å¡ä½æ—¶å°è¯•åˆ é™¤æ ¹ç›®å½•<code>.docz</code>æ–‡ä»¶å¤¹ï¼Œè€Œåé‡æ–°æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>æ›´å¤šè¯¦è§<a href="https://github.com/worldzhao/react-ui-library-tutorial/tree/chapter-2/dev-and-doc">ä»“åº“</a>ã€‚</p>
<p>å¼€å‘è°ƒè¯•ä¸æ–‡æ¡£ç¼–å†™ç»“æŸï¼Œæ¬¢è¿æŒ‡ç‚¹äº¤æµã€‚</p>
<p>To be Continued...</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å‡†å¤‡å·¥ä½œ]]></title>
        <id>https://worldzhao.github.io/post/build-your-own-react-ui-library-1/</id>
        <link href="https://worldzhao.github.io/post/build-your-own-react-ui-library-1/">
        </link>
        <updated>2019-12-18T04:12:25.000Z</updated>
        <summary type="html"><![CDATA[<p>å‡¡äº‹é¢„åˆ™ç«‹ä¸é¢„åˆ™åºŸã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å‡¡äº‹é¢„åˆ™ç«‹ä¸é¢„åˆ™åºŸã€‚</p>
<!--more -->
<ul>
<li><a href="https://juejin.im/post/5df9a39f6fb9a0165b4cdb26">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å‡†å¤‡å·¥ä½œ</a></li>
<li><a href="https://juejin.im/post/5dfb09b1e51d4558096d5f94">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å¼€å‘è°ƒè¯•</a></li>
<li><a href="https://juejin.im/post/5e030b926fb9a0162c487c7b">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-æ‰“åŒ…è¾“å‡º</a></li>
<li><a href="https://juejin.im/post/5e23e4035188252c6c478665">React ç»„ä»¶åº“æ­å»ºæŒ‡å—-å•å…ƒæµ‹è¯•</a></li>
</ul>
<h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h2>
<p>æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦æ˜¯å¼€å‘ç»„ä»¶åº“<a href="https://github.com/worldzhao/dora-ui">dora-ui</a>è¿‡ç¨‹ä¸­çš„ä¸€äº›ç»éªŒæ€»ç»“ï¼Œå¤§è‡´åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>prepare: ç»„ä»¶åº“å‰æœŸå¼€å‘å‡†å¤‡å·¥ä½œã€‚<code>eslint</code>/<code>commit lint</code>/<code>typescript</code>ç­‰ç­‰ï¼›</li>
<li>dev: ä½¿ç”¨<a href="https://github.com/doczjs/docz">docz</a>è¿›è¡Œå¼€å‘è°ƒè¯•ä»¥åŠæ–‡æ¡£ç¼–å†™ï¼›</li>
<li>build: <s><code>umd</code></s>/<code>cjs</code>/<code>esm</code>ã€typesã€polyfill ä»¥åŠæŒ‰éœ€åŠ è½½ï¼›</li>
<li>deploy: ä½¿ç”¨<a href="https://zeit.co/home">now</a>éƒ¨ç½²æ–‡æ¡£ç«™ç‚¹ï¼›</li>
<li>publish: å‘å¸ƒç»„ä»¶åº“è‡³<code>npm</code>ï¼›</li>
<li>others: ç»„ä»¶æµ‹è¯•</li>
</ul>
<p>æ³¨æ„ï¼š<code>.gitignore</code>ã€<code>.eslintignore</code>ä»¥åŠ<code>.editorconfig</code>ç­‰æ›´å¤šæ–‡ä»¶å¯åœ¨<a href="https://github.com/worldzhao/react-ui-library-tutorial/tree/chapter-1/before-start">chapter-1</a>ç« èŠ‚ä»£ç ä¸­è·å–ã€‚</p>
<h2 id="åˆå§‹åŒ–é¡¹ç›®">åˆå§‹åŒ–é¡¹ç›®</h2>
<p>æ–°å»ºä¸€ä¸ª<code>happy-ui</code>æ–‡ä»¶å¤¹ï¼Œå¹¶åˆå§‹åŒ–ã€‚</p>
<pre><code class="language-bash">mkdir happy-ui

cd happy-ui

npm init --y

mkdir components &amp;&amp; cd components &amp;&amp; touch index.ts # æ–°å»ºæºç æ–‡ä»¶å¤¹ä»¥åŠå…¥å£æ–‡ä»¶

</code></pre>
<h2 id="ä»£ç è§„èŒƒ">ä»£ç è§„èŒƒ</h2>
<p>æ­¤å¤„ç›´æ¥ä½¿ç”¨<a href="https://github.com/umijs/fabric">@umijs/fabric</a>çš„é…ç½®ã€‚</p>
<pre><code class="language-bash">yarn add @umijs/fabric --dev

yarn add prettier --dev # å› ä¸º@umijs/fabricæ²¡æœ‰å°†prettierä½œä¸ºä¾èµ– æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®‰è£…
</code></pre>
<p><strong>.eslintrc.js</strong></p>
<pre><code class="language-js">module.exports = {
  extends: [require.resolve('@umijs/fabric/dist/eslint')],
};
</code></pre>
<p><strong>.prettierrc.js</strong></p>
<pre><code class="language-js">const fabric = require('@umijs/fabric');

module.exports = {
  ...fabric.prettier,
};
</code></pre>
<p><strong>.stylelintrc.js</strong></p>
<pre><code class="language-js">module.exports = {
  extends: [require.resolve('@umijs/fabric/dist/stylelint')],
};
</code></pre>
<p>æƒ³è‡ªè¡Œé…ç½®çš„åŒå­¦å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://medium.com/@dors718/linting-your-react-typescript-project-with-eslint-and-prettier-2423170c3d42">Linting Your React+Typescript Project with ESLint and Prettier!</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/62401626">ä½¿ç”¨ ESLint+Prettier è§„èŒƒ React+Typescript é¡¹ç›® </a></li>
</ul>
<h2 id="commit-lint">Commit Lint</h2>
<p>è¿›è¡Œ<code>pre-commit</code>ä»£ç è§„èŒƒæ£€æµ‹ã€‚</p>
<pre><code class="language-bash">yarn add husky lint-staged --dev
</code></pre>
<p><strong>package.json</strong></p>
<pre><code class="language-json">&quot;lint-staged&quot;: {
  &quot;components/**/*.ts?(x)&quot;: [
    &quot;prettier --write&quot;,
    &quot;eslint --fix&quot;,
    &quot;git add&quot;
  ],
  &quot;components/**/*.less&quot;: [
    &quot;stylelint --syntax less --fix&quot;,
    &quot;git add&quot;
  ]
},
&quot;husky&quot;: {
  &quot;hooks&quot;: {
    &quot;pre-commit&quot;: &quot;lint-staged&quot;
  }
}
</code></pre>
<p>è¿›è¡Œ Commit Message æ£€æµ‹ã€‚</p>
<pre><code class="language-bash">yarn add @commitlint/cli @commitlint/config-conventional commitizen cz-conventional-changelog --dev
</code></pre>
<p>æ–°å¢<code>.commitlintrc.js</code>å†™å…¥ä»¥ä¸‹å†…å®¹</p>
<pre><code class="language-js">module.exports = { extends: ['@commitlint/config-conventional'] };
</code></pre>
<p>package.json å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-json">// ...
&quot;scripts&quot;: {
  &quot;commit&quot;: &quot;git-cz&quot;,
}
// ...
&quot;husky&quot;: {
  &quot;hooks&quot;: {
    &quot;commit-msg&quot;: &quot;commitlint -E HUSKY_GIT_PARAMS&quot;,
    &quot;pre-commit&quot;: &quot;lint-staged&quot;
  }
},
&quot;config&quot;: {
  &quot;commitizen&quot;: {
    &quot;path&quot;: &quot;cz-conventional-changelog&quot;
  }
}
</code></pre>
<p>åç»­ä½¿ç”¨ <code>yarn commit</code> æ›¿ä»£ <code>git commit</code>ç”Ÿæˆè§„èŒƒçš„ Commit Messageï¼Œå½“ç„¶ä¸ºäº†æ•ˆç‡ä½ å¯ä»¥é€‰æ‹©æ‰‹å†™ï¼Œä½†æ˜¯è¦ç¬¦åˆè§„èŒƒã€‚</p>
<h2 id="typescript">TypeScript</h2>
<pre><code class="language-bash">yarn add typescript --dev
</code></pre>
<p>æ–°å»º<code>tsconfig.json</code>å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹</p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;allowJs&quot;: false,
    &quot;target&quot;: &quot;esnext&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;jsx&quot;: &quot;react&quot;,
    &quot;declaration&quot;: true,
    &quot;outDir&quot;: &quot;types&quot;,
    &quot;strict&quot;: true,
    &quot;moduleResolution&quot;: &quot;node&quot;,
    &quot;allowSyntheticDefaultImports&quot;: true,
    &quot;esModuleInterop&quot;: true
  },
  &quot;include&quot;: [&quot;components&quot;]
}
</code></pre>
<h2 id="æµ‹è¯•">æµ‹è¯•</h2>
<p>åœ¨<code>components</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>alert</code>æ–‡ä»¶å¤¹ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code>alert
    â”œâ”€â”€ alert.tsx           # æºæ–‡ä»¶
    â”œâ”€â”€ index.ts            # å…¥å£æ–‡ä»¶
    â”œâ”€â”€ interface.ts        # ç±»å‹å£°æ˜æ–‡ä»¶
    â””â”€â”€ style
        â”œâ”€â”€ index.less      # æ ·å¼æ–‡ä»¶
        â””â”€â”€ index.ts        # æ ·å¼æ–‡ä»¶é‡Œä¸ºä»€ä¹ˆå­˜åœ¨ä¸€ä¸ªindex.ts - æŒ‰éœ€åŠ è½½æ ·å¼ ç®¡ç†æ ·å¼ä¾èµ– åé¢ç« èŠ‚ä¼šæåˆ°
</code></pre>
<p>å®‰è£…<code>React</code>ç›¸å…³ä¾èµ–ï¼š</p>
<pre><code class="language-bash">yarn add react react-dom @types/react @types/react-dom --dev # å¼€å‘æ—¶ä¾èµ–ï¼Œå®¿ä¸»ç¯å¢ƒä¸€å®šå­˜åœ¨

yarn add prop-types            # è¿è¡Œæ—¶ä¾èµ–ï¼Œå®¿ä¸»ç¯å¢ƒå¯èƒ½ä¸å­˜åœ¨ å®‰è£…æœ¬ç»„ä»¶åº“æ—¶ä¸€èµ·å®‰è£…
</code></pre>
<blockquote>
<p>æ­¤å¤„ä¾æ—§å®‰è£…äº†<code>prop-types</code>è¿™ä¸ªåº“ï¼Œå› ä¸ºæ— æ³•ä¿è¯å®¿ä¸»ç¯å¢ƒä¹Ÿä½¿ç”¨<code>typescript</code>ï¼Œä»è€Œèƒ½å¤Ÿè¿›è¡Œé™æ€æ£€æŸ¥ï¼Œæ•…ä½¿ç”¨<code>prop-types</code>ä¿è¯<code>javascript</code>ç”¨æˆ·ä¹Ÿèƒ½å¾—åˆ°å‹å¥½çš„è¿è¡Œæ—¶æŠ¥é”™ä¿¡æ¯ã€‚</p>
</blockquote>
<p><strong>components/alert/interface.ts</strong></p>
<pre><code class="language-js">export type Kind = 'info' | 'positive' | 'negative' | 'warning';
export type KindMap = Record&lt;Kind, string&gt;;

export interface AlertProps {
  /**
   * Set this to change alert kind
   * @default info
   */
  kind?: 'info' | 'positive' | 'negative' | 'warning';
}
</code></pre>
<p><strong>components/alert/alter.tsx</strong></p>
<pre><code class="language-jsx">import React from 'react';
import t from 'prop-types';

import { AlertProps, KindMap } from './interface';

const prefixCls = 'happy-alert';

const kinds: KindMap = {
  info: '#5352ED',
  positive: '#2ED573',
  negative: '#FF4757',
  warning: '#FFA502',
};

const Alert: React.FC&lt;AlertProps&gt; = ({ children, kind = 'info', ...rest }) =&gt; (
  &lt;div
    className={prefixCls}
    style={{
      background: kinds[kind],
    }}
    {...rest}
  &gt;
    {children}
  &lt;/div&gt;
);

Alert.propTypes = {
  kind: t.oneOf(['info', 'positive', 'negative', 'warning']),
};

export default Alert;
</code></pre>
<p><strong>components/alert/index.ts</strong></p>
<pre><code class="language-js">import Alert from './alert';

export default Alert;

export * from './interface';
</code></pre>
<p><strong>components/alert/style/index.less</strong></p>
<pre><code class="language-less">@popupPrefix: happy-alert;

.@{popupPrefix} {
  padding: 20px;
  background: white;
  border-radius: 3;
  color: white;
}
</code></pre>
<p><strong>components/alert/style/index.ts</strong></p>
<pre><code class="language-js">import './index.less';
</code></pre>
<p><strong>components/index.ts</strong></p>
<pre><code class="language-js">export { default as Alert } from './alert';
</code></pre>
<blockquote>
<p>æ­¤å¤„ç»„ä»¶å‚è€ƒçš„<code>docz</code>é¡¹ç›®<code>typescript</code>ä»¥åŠ<code>less</code>ç¤ºä¾‹ã€‚</p>
</blockquote>
<p>git ä¸€æŠŠæ¢­ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°å·²ç»è¿›è¡Œé’©å­æ£€æµ‹äº†ã€‚</p>
<pre><code class="language-bash">git add .

yarn commit  # æˆ– git commit -m'feat: chapter-1 å‡†å¤‡å·¥ä½œ'

git push
</code></pre>
<p>å‡†å¤‡å·¥ä½œç»“æŸï¼Œæ¬¢è¿æŒ‡ç‚¹äº¤æµã€‚</p>
<p>To be Continued...</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç»„ä»¶ï¼ˆåº“ï¼‰å¼€å‘ç›¸å…³æ€»ç»“]]></title>
        <id>https://worldzhao.github.io/post/thinking-in-ui-library/</id>
        <link href="https://worldzhao.github.io/post/thinking-in-ui-library/">
        </link>
        <updated>2019-10-13T16:00:00.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>æœ¬æ–‡é¦–å‘äº 2019-06-02<br><br>
æ›´æ–°äº 2019-10-14</p>
</blockquote>
<h1 id="ç»„ä»¶åº“å¼€å‘ç›¸å…³æ€»ç»“">ç»„ä»¶ï¼ˆåº“ï¼‰å¼€å‘ç›¸å…³æ€»ç»“</h1>
<h2 id="ç°çŠ¶">ç°çŠ¶</h2>
<p>æ²¡æœ‰ç»Ÿä¸€ç»„ä»¶åº“ï¼Œå…·ä½“é—®é¢˜è¡¨ç°åœ¨ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>æ•°é‡ï¼šå¯å¤ç”¨ç»„ä»¶å°‘ï¼Œç»å¸¸éœ€è¦é€ è½®å­ï¼Œå¹¶ä¸”é€ å®Œæ²¡æœ‰æŠ½å‡ºæ¥ä»¥ä¾›å…¶ä»–é¡¹ç›®å¤ç”¨ï¼›</li>
<li>æ–‡æ¡£ï¼šæ–‡æ¡£ç¼ºå¤±ï¼Œæ›´æ¢å¼€å‘è€…å¤§æ¦‚ç‡éœ€è¦æ‘¸ççœ‹æºç ï¼Œè€Œä¸”å¾ˆå¯èƒ½ A é¡¹ç›®å·²ç»å­˜åœ¨äº†è§£å†³æ–¹æ¡ˆï¼ŒB é¡¹ç›®çš„å¼€å‘è€…å¹¶ä¸çŸ¥é“ï¼ˆæˆ–è€…çŸ¥é“äº†å´æ ¹æœ¬æ— ä»ä¸‹æ‰‹æ‹·è´ï¼‰ï¼Œé‡å¤é€ è½®å­ï¼›</li>
<li>ç»´æŠ¤ï¼š1 ä¸­çš„è½®å­å¤ç”¨ä¾é å¤åˆ¶ç²˜è´´ï¼Œå¯ç»´æŠ¤æ€§å·®ï¼Œå‡ºç°é—®é¢˜å¤šæ–¹åŒæ­¥ä¿®æ”¹ã€‚</li>
</ol>
<h2 id="å¯å¤ç”¨ç»„ä»¶ç±»å‹">å¯å¤ç”¨ç»„ä»¶ç±»å‹</h2>
<ol start="4">
<li>UI ç»„ä»¶ï¼šè­¬å¦‚å¼¹å±‚ï¼ˆMask,SlideUpï¼‰ã€è½»æç¤º(Toast)ä»¥åŠè¾“å…¥æ¡†ï¼ˆInputï¼‰ç­‰ç»„ä»¶ï¼ˆå¾€å¾€è¿˜å­˜åœ¨ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼‰ï¼›</li>
<li>ä¸šåŠ¡ç»„ä»¶ï¼šç›¸åŒä¸šåŠ¡ç±»å‹å¯å¤ç”¨çš„ç»„ä»¶ï¼Œè­¬å¦‚æŠ½å¥–è½¬ç›˜ç»„ä»¶ï¼›</li>
<li>é€»è¾‘ç»„ä»¶ï¼šè­¬å¦‚ä¼ é€é—¨ï¼ˆPortalï¼‰ã€åˆ‡æ¢å™¨ï¼ˆTogglerï¼‰ä»¥åŠæ ¡éªŒå™¨ï¼ˆValidatorï¼‰ç­‰å¯ä»¥ç”¨æ¥ä¼˜åŒ–ä»£ç ç»“æ„å¹¶å‡å°‘é‡å¤ä»£ç ç­‰æ— å½¢æ€ç»„ä»¶ã€‚</li>
</ol>
<h2 id="ä¸ªäººæ€è€ƒ">ä¸ªäººæ€è€ƒ</h2>
<p>TO C ä¸šåŠ¡å›ºç„¶åƒå¥‡ç™¾æ€ªï¼Œä½†æ€»æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œå¦‚ä½•ä¸ä¸šåŠ¡ç»“åˆï¼Œåˆ†ç¦»å¯å˜ä¸ä¸å¯å˜ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œæ­£æ˜¯å·¥ç¨‹å¸ˆå­˜åœ¨çš„æ„ä¹‰ï¼ˆå½“ç„¶ä¹Ÿéœ€è¦äº§å“ã€ä¸šåŠ¡æŠ½è±¡ã€‘ä»¥åŠè®¾è®¡ã€ui è§„èŒƒã€‘åŒå­¦çš„å…±åŒå‚ä¸ï¼‰ã€‚</p>
<p>å¦‚æœä¸åŒé¡¹ç›®è®¾è®¡é£æ ¼å®åœ¨å·®å¼‚è¾ƒå¤§ï¼Œä¹Ÿèƒ½å¤Ÿé€šè¿‡æ”¹æ”¹æ ·å¼å¤ç”¨ï¼Œè€Œéé‡å†™ä¸€éé€»è¾‘ä»¥åŠå…¼å®¹æ€§å¤„ç†ã€‚</p>
<p>æ—¢è¦æœ‰é€ è½®å­çš„èƒ½åŠ›ï¼ˆä¸ªäººï¼‰ï¼Œä¹Ÿè¦æœ‰ä¸é€ è½®å­çš„è§‰æ‚Ÿï¼ˆå›¢é˜Ÿï¼‰ã€‚</p>
<h2 id="å¼€å‘ç›¸å…³">å¼€å‘ç›¸å…³</h2>
<h3 id="æ¨¡å—å¤„ç†">æ¨¡å—å¤„ç†</h3>
<p>é€šå¸¸æˆ‘ä»¬ä¸€èˆ¬ä¼šæä¾›ä¸‰ç§å½¢å¼çš„æ¨¡å—ï¼š</p>
<ul>
<li>commonjsï¼Œç®€ç§° cjsã€‚</li>
<li>es moduleï¼Œç®€ç§° esmã€‚ä¾¿äºåº”ç”¨æ‰“åŒ…æ—¶è¿›è¡Œ tree-shakingã€‚</li>
<li>umdã€‚ä¾›ä½¿ç”¨æ–¹å¤–é“¾ä½¿ç”¨ï¼Œå…¼å®¹ cjs ä»¥åŠ amdã€‚</li>
</ul>
<p>æƒ³è¦æ·±å…¥å¯ä»¥çœ‹<a href="https://github.com/ShowJoy-com/showjoy-blog/issues/39" title="importã€requireã€exportã€module.exports æ··åˆè¯¦è§£">importã€requireã€exportã€module.exports æ··åˆè¯¦è§£</a>è¿™ç¯‡æ–‡ç« ï¼Œæ­¤å¤„åªéœ€è¦çŸ¥é“æä¾›ä½•ç§å½¢å¼çš„æ¨¡å—ä»¥åŠä½•æä¾›å®ƒä»¬å³å¯ã€‚</p>
<h3 id="è¯­æ³•è½¬è¯‘">è¯­æ³•è½¬è¯‘</h3>
<p>åº”ç”¨å¼€å‘è€…é€šå¸¸ä¼šåœ¨ babel-loader ä¸­ exclude æ‰ node_modulesï¼Œæ‰€ä»¥æˆ‘ä»¬å‘å‡ºçš„åŒ…éœ€è¦è½¬æˆ es5 è¯­æ³•ï¼Œé¿å…åœ¨ä½ç‰ˆæœ¬æµè§ˆå™¨ä¸Šä¸å…¼å®¹ï¼Œå¯ä»¥ä½¿ç”¨ babel ä»¥åŠ tsc è¿›è¡Œå¤„ç†ï¼Œç°åœ¨ babel ä¹Ÿæ”¯æŒ typescriptï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨ babelï¼Œè¿˜å¯ä»¥è¿›è¡Œç›¸å…³æ’ä»¶é…ç½®ã€‚</p>
<p>åœ¨è½¬è¯‘æ—¶ï¼Œä¼šå­˜åœ¨ä¸€äº›è¾…åŠ©å‡½æ•°ï¼ˆhelpersï¼‰ï¼Œè¿™äº›å‡½æ•°å¼ä¼šåœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ç”Ÿæˆï¼Œå»ºè®®ä½¿ç”¨<a href="https://www.babeljs.cn/docs/babel-plugin-transform-runtime" title="`@babel/plugin-transform-runtime`"><code>@babel/plugin-transform-runtime</code></a>ä»¥åŠ<code>@babel/runtime</code>å°†è¾…åŠ©å‡½æ•°æŠ½ç¦»ï¼Œå¯ä»¥å‡å°æ‰“åŒ…ä½“ç§¯çš„å¤§å°ä¸”å¯ä»¥å¤ç”¨å®¿ä¸»é¡¹ç›®çš„<code>@babel/runtime</code>ã€‚</p>
<h3 id="polyfill">Polyfill</h3>
<ol>
<li>ä¸å‡†ä½¿ç”¨<code>@babel/polyfill</code>æ±¡æŸ“å®¿ä¸»ç¯å¢ƒï¼›</li>
<li>å¯ä»¥ä½¿ç”¨<code>@babel/plugin-transform-runtime</code>ç»“åˆ<code>@babel/runtime-corejs3</code>ï¼Œé¿å…æ±¡æŸ“å…¨å±€ã€‚<s>å­˜åœ¨&quot;foobar&quot;.includes(&quot;foo&quot;) çš„ä»£ç çš„è¯ä¹Ÿæ˜¯æ— èƒ½ä¸ºåŠ›</s>(NOTE: Instance methods such as &quot;foobar&quot;.includes(&quot;foo&quot;) will only work when using corejs: 3.)ï¼›</li>
<li>å»ºè®®å‘ŠçŸ¥ä½¿ç”¨æ–¹ä¾èµ–äº†å“ªäº›éœ€è¦ polyfill çš„ APIï¼Œäº¤ç”±ä½¿ç”¨æ–¹è‡ªè¡Œé…ç½® polyfillï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´é‡å¤ä¾èµ–æˆ–ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å†²çªã€‚</li>
</ol>
<p>å¦‚æœå®¿ä¸»åº”ç”¨ç›´æ¥ä¸€ä¸ª<code>import '@babel/polyfill'</code>ï¼Œæˆ‘ä»¬åŸºæœ¬èººç€å°±å¥½ã€‚</p>
<blockquote>
<p>å…¶å®å…³äºè¯­æ³•è½¬è¯‘è¿˜æœ‰ polyfill æœ‰ä¸€ç§åä¸º<code>åç¼–è¯‘</code>çš„æ“ä½œã€‚åç¼–è¯‘ï¼šæŒ‡çš„æ˜¯åº”ç”¨ä¾èµ–çš„ NPM åŒ…å¹¶ä¸éœ€è¦åœ¨å‘å¸ƒå‰ç¼–è¯‘ï¼Œè€Œæ˜¯éšç€åº”ç”¨ç¼–è¯‘æ‰“åŒ…çš„æ—¶å€™ä¸€å—ç¼–è¯‘ã€‚æ˜¯ä¸€ç§æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µï¼Œæ›´å¤šå¯å‚è§<a href="https://juejin.im/post/59dc57f2f265da431d3ba2ef" title="webpack åº”ç”¨ç¼–è¯‘ä¼˜åŒ–ä¹‹è·¯">webpack åº”ç”¨ç¼–è¯‘ä¼˜åŒ–ä¹‹è·¯</a>ã€‚</p>
</blockquote>
<h3 id="æ ·å¼å¤„ç†">æ ·å¼å¤„ç†</h3>
<p>å…ˆè°ˆè°ˆå•ç»„ä»¶å¼€å‘ï¼Œç±»ä¼¼<code>react-slick</code>è¿™ç§åŒ…å«æ ·å¼çš„å…¸å‹ç»„ä»¶ã€‚</p>
<p>å•ç»„ä»¶æ ·å¼å¤„ç†å’Œå¹³æ—¶å¼€å‘çš„åº”ç”¨æ ·å¼å¤„ç†è¾ƒä¸ºç±»ä¼¼ï¼Œç›´æ¥æ‰“åŒ…å‡ºä¸€ä»½ css æ ·å¼æ–‡ä»¶ï¼Œäº¤ç”±ä½¿ç”¨æ–¹å¼•å…¥å³å¯ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å°† css æ‰“å…¥ js æ–‡ä»¶ï¼Œä½¿ç”¨æ–¹æ— éœ€å¼•å…¥ã€‚</p>
<p>ç»„ä»¶åº“ï¼ˆå¦‚ antdï¼‰åˆ™è¾ƒä¸ºéº»çƒ¦ï¼Œå› ä¸ºè¦è¾¾åˆ°æ ·å¼<strong>æŒ‰éœ€å¼•å…¥</strong>çš„æ•ˆæœã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬ç»„ä»¶åº“çš„æ¨¡å—å¤„ç†æ–¹å¼æœ‰ä»¥ä¸‹ 3 ç§ï¼š</p>
<ul>
<li>cjs ä¸ esmï¼šåªç¼–è¯‘ä¸æ‰“åŒ…ï¼ˆä¸ºäº†æŒ‰éœ€å¼•å…¥ï¼‰ã€ä¾èµ–å¤–ç½®</li>
<li>umdï¼šæ—¢ç¼–è¯‘ä¹Ÿæ‰“åŒ…ã€éƒ¨åˆ†ä¾èµ–å¤–ç½®ï¼Œéƒ¨åˆ†ä¾èµ–éœ€è¦ä¸€åŒæ‰“åŒ…</li>
</ul>
<p>å¦‚æœæ˜¯ umd å½¢å¼ï¼Œå¾ˆæ˜æ˜¾å’ŒæŒ‰éœ€å¼•å…¥æ— ç¼˜ï¼Œåªéœ€è¦é€šè¿‡<code>rollup</code>ç›´æ¥æ‰“åŒ…æŠ½ç¦» css æ–‡ä»¶ï¼Œäº¤ç”±ä½¿ç”¨æ–¹å¤–é“¾å¼•å…¥ã€‚</p>
<p>è€Œ cjs ä»¥åŠ esm çš„å½¢å¼ï¼Œè¦å®ç°æ ·å¼çš„æŒ‰éœ€å¼•å…¥ï¼Œåˆ™æœ‰ä»¥ä¸‹ 4 ç§æ–¹å¼ï¼š</p>
<ol>
<li>
<p>ä½¿ç”¨ sass/less/stylus ç­‰é¢„å¤„ç†å™¨å¼€å‘ï¼Œç›¸åº”ç»„ä»¶å†…éƒ¨ç›´æ¥ import ç›¸åº”(.scss/.less/.styl)æ–‡ä»¶ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼š1. ä½¿ç”¨é¢„å¤„ç†å™¨ï¼Œå¼€å‘ä½“éªŒä½³ï¼›2. ä½¿ç”¨æ–¹æ— éœ€æ‰‹åŠ¨å¼•å…¥æ ·å¼æ–‡ä»¶ã€‚</li>
<li>ç¼ºç‚¹ï¼š1. ä½¿ç”¨æ–¹éœ€è¦å…³æ³¨é¢„å¤„ç†å™¨é€‚é…é—®é¢˜ã€‚</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨ css å¼€å‘ï¼Œç›¸åº”ç»„ä»¶å†…éƒ¨ç›´æ¥ import æ ·å¼æ–‡ä»¶ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼š1. ä½¿ç”¨æ–¹ä¸éœ€è¦å…³æ³¨é¢„å¤„ç†å™¨é€‚é…é—®é¢˜ï¼ˆcss-loader è¿˜æ˜¯è¦çš„ï¼‰ï¼›2. ä½¿ç”¨æ–¹æ— éœ€å•ç‹¬å¼•å…¥æ ·å¼æ–‡ä»¶ã€‚</li>
<li>ç¼ºç‚¹ï¼š1. å¼€å‘ä½“éªŒè¾ƒå·®ã€‚</li>
</ul>
</li>
<li>
<p>antd å¤„ç†æ–¹æ¡ˆã€‚ä½¿ç”¨ sass/less/stylus ç­‰é¢„å¤„ç†å™¨å¼€å‘ï¼Œç›¸åº”ç»„ä»¶ä¸ import æ ·å¼æ–‡ä»¶ï¼Œç¼–å†™ style/index.js ç®¡ç†ç»„ä»¶é—´çš„æ ·å¼ä¾èµ–ï¼ˆsass/less/stylusï¼‰ï¼Œç”Ÿæˆ style/css.js ç®¡ç†ç»„ä»¶é—´æ ·å¼ä¾èµ–ï¼ˆcssï¼‰ï¼Œä½¿ç”¨æ–¹æ ¹æ®å®¿ä¸»é¡¹ç›®é¢„å¤„ç†å™¨é€‰æ‹©å¼•å…¥ style/index.js æˆ– style/css.jsã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼š1. ä½¿ç”¨é¢„å¤„ç†å™¨å¼€å‘ä½“éªŒä½³ï¼›2. ä½¿ç”¨æ–¹å¯ä»¥é€‰æ‹©å¼•å…¥ css.js æ ·å¼ï¼Œä¸ç”¨å…³å¿ƒé¢„å¤„ç†å™¨é€‚é…é—®é¢˜ã€‚</li>
<li>ç¼ºç‚¹ï¼š1. ä½¿ç”¨æ–¹éœ€è¦å•ç‹¬å¼•å…¥ style/index.js æˆ– style/css.jsï¼ˆè¿™ä¸€ç‚¹å¯ç”¨ babel æ’ä»¶è§£å†³ï¼‰ï¼›2. å¼€å‘æ—¶éœ€è¦ç¼–å†™ä¸€ä»½ style/index.js ç”¨äºç»´æŠ¤ç»„ä»¶é—´çš„æ ·å¼ä¾èµ–ï¼›3. æ‰“åŒ…æ—¶éœ€è¦ä½¿ç”¨æ¯”è¾ƒ tricky çš„æ–¹å¼ç”Ÿæˆä¸€ä»½ style/css.jsã€‚</li>
</ul>
</li>
<li>
<p>css in js æ–¹æ¡ˆã€‚ä½¿ç”¨ styled-componentsï¼Œ<a href="https://zhuanlan.zhihu.com/p/26878157" title="ç›¸å…³æ–‡ç« ï¼šç²¾è¯»ã€Šè¯·åœæ­¢ css-in-js çš„è¡Œä¸ºã€‹">ç›¸å…³æ–‡ç« ï¼šç²¾è¯»ã€Šè¯·åœæ­¢ css-in-js çš„è¡Œä¸ºã€‹</a>ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼š1. å¼€å‘ä½“éªŒè¾ƒå¥½ï¼›2. ä½¿ç”¨æ–¹æ— éœ€å•ç‹¬å¼•å…¥æ ·å¼æ–‡ä»¶ï¼›3. ä½¿ç”¨æ–¹æ— éœ€å…³æ³¨é¢„å¤„ç†å™¨é€‚é…é—®é¢˜ã€‚</li>
<li>ç¼ºç‚¹ï¼šæœªæˆä½“ç³»ä½¿ç”¨è¿‡ï¼Œä¸äº†è§£ã€‚</li>
</ul>
</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<ol>
<li>ä¸è®ºæ˜¯ç»„ä»¶è¿˜æ˜¯ç»„ä»¶åº“ï¼Œæœ€å¥½æä¾› cjs/esm/umd ç­‰ä¸‰ç§å½¢å¼çš„æ¨¡å—ä¾›ä¸åŒä½¿ç”¨æƒ…æ™¯ä½¿ç”¨ï¼›</li>
<li>ç»„ä»¶åº“ esm/cjs çš„å½¢å¼éœ€è¦è¾¾åˆ°æŒ‰éœ€å¼•å…¥ï¼Œ æ¨èä½¿ç”¨ gulp ç»“åˆ typescript æˆ– babelï¼Œåªç¼–è¯‘ä¸æ‰“åŒ…ï¼Œå•ç‹¬ä½¿ç”¨ tsc æˆ– babel ä¹Ÿå¯ä»¥ï¼Œä½†è€ƒè™‘åˆ°éœ€è¦å¤„ç†æ ·å¼ï¼Œæœ€å¥½ç»“åˆä¸€ä¸ªå·¥å…·å°†æµç¨‹ä¸²èµ·æ¥ã€‚umd å½¢å¼åˆ™ç›´æ¥ä½¿ç”¨ rollup æ‰“åŒ…ï¼›</li>
<li>ç»„ä»¶åº“æ ·å¼æŒ‰éœ€å¼•å…¥æœ‰ä¸Šæ–‡å››ç§æ–¹æ¡ˆï¼Œæ ¹æ®ä¸šåŠ¡å½¢å¼è¿›è¡Œé€‰æ‹©ï¼Œéœ€è¦è¿›è¡Œæƒè¡¡å–èˆï¼›</li>
<li>å•ç»„ä»¶ä¸å­˜åœ¨æŒ‰éœ€å¼•å…¥ï¼Œç›´æ¥ä½¿ç”¨ rollup æ‰“åŒ…å‡º esm/cjs/umd ä¸‰ç§å½¢å¼æ¨¡å—å³å¯ã€‚</li>
</ol>
<h3 id="é™„å½•">é™„å½•ï¼š</h3>
<pre><code>- [dora-ui](https://github.com/worldzhao/dora-ui &quot;dora-ui&quot;)
- [react-component-template](https://github.com/worldzhao/react-componet-template &quot;react-component-template&quot;)
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åŸºäºReactçš„æƒé™ç³»ç»Ÿè®¾è®¡]]></title>
        <id>https://worldzhao.github.io/post/authorization-with-react-NSConflict-æµ·ç§‹-mac10.15.3/</id>
        <link href="https://worldzhao.github.io/post/authorization-with-react-NSConflict-æµ·ç§‹-mac10.15.3/">
        </link>
        <updated>2019-09-25T11:52:53.000Z</updated>
        <summary type="html"><![CDATA[<p>å‰ç«¯è¿›è¡Œæƒé™æ§åˆ¶åªæ˜¯ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œå¯¹åº”çš„è§’è‰²æ¸²æŸ“å¯¹åº”çš„è§†å›¾ï¼ŒçœŸæ­£çš„å®‰å…¨ä¿éšœåœ¨åç«¯ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å‰ç«¯è¿›è¡Œæƒé™æ§åˆ¶åªæ˜¯ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œå¯¹åº”çš„è§’è‰²æ¸²æŸ“å¯¹åº”çš„è§†å›¾ï¼ŒçœŸæ­£çš„å®‰å…¨ä¿éšœåœ¨åç«¯ã€‚</p>
<!-- more -->
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æ¯•ä¸šä¹‹åˆï¼Œå·¥ä½œçš„ä¸»è¦å†…å®¹ä¾¿æ˜¯å¼€å‘ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿï¼Œå½“æ—¶å­˜åœ¨çš„ä¸€ä¸ªç°è±¡æ˜¯ï¼š</p>
<p><strong>ç”¨æˆ·è‹¥è®°ä½äº†æŸä¸ª urlï¼Œç›´æ¥æµè§ˆå™¨è¾“å…¥ï¼Œä¸è®ºè¯¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®è¯¥é¡µé¢çš„æƒé™ï¼Œå‡èƒ½è¿›å…¥é¡µé¢ã€‚</strong></p>
<p>è‹¥é¡µé¢åˆå§‹åŒ–æ—¶ï¼ˆ<code>componentDidMount</code>ï¼‰è¿›è¡Œæ¥å£è¯·æ±‚ï¼Œåç«¯ä¼šè¿”å› 403 çš„ HTTP çŠ¶æ€ç ï¼ŒåŒæ—¶å‰ç«¯å°è£…çš„<code>request.js</code>ä¼šå¯¹éä¸šåŠ¡å¼‚å¸¸è¿›è¡Œç›¸å…³å¤„ç†ï¼Œé‡è§ 403ï¼Œå°±é‡å®šå‘åˆ°æ— æƒé™é¡µé¢ã€‚</p>
<p>è‹¥æ˜¯é¡µé¢åˆå§‹åŒ–æ—¶ä¸å­˜åœ¨å‰åç«¯äº¤äº’ï¼Œé‚£å°±è¦ç­‰ç”¨æˆ·è§¦å‘æŸäº›æ“ä½œï¼ˆæ¯”å¦‚è¡¨å•æäº¤ï¼‰åæ‰ä¼šè§¦å‘ä¸Šè¿°æµç¨‹ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®‰å…¨ä¿éšœæ˜¯åç«¯å…œåº•çš„ï¼Œé‚£å‰ç«¯èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ol>
<li>æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œé¿å…ç”¨æˆ·è¯¯ä»¥ä¸ºè‡ªå·±æ‹¥æœ‰è¯¥æƒé™è€Œè¿›è¡Œæ“ä½œï¼ˆå³ä½¿æ— æ³•æ“ä½œæˆåŠŸï¼‰ï¼Œç›´æ¥è·³è½¬è‡³æ— æƒé™é¡µé¢ï¼›</li>
<li>æ‹¦æˆªæ˜ç¡®æ— æƒçš„è¯·æ±‚ï¼Œæ¯”å¦‚æŸäº›éœ€è¦æƒé™æ‰èƒ½è¿›è¡Œçš„æ“ä½œå…¥å£ï¼ˆæŒ‰é’® or å¯¼èˆªç­‰ï¼‰ä¸å¯¹æ— æƒç”¨æˆ·å±•ç¤ºï¼Œå…¶å®æœ¬ç‚¹åŒ…å«ä¸Šä¸€ç‚¹ã€‚</li>
</ol>
<p>æœ€è¿‘ä¹Ÿåœ¨çœ‹<code>Ant Design Pro</code>çš„æƒé™ç›¸å…³å¤„ç†ï¼Œæœ‰å¿…è¦è¿›è¡Œä¸€æ¬¡æ€»ç»“ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬æ–‡è™½ç„¶åŸºäº<code>Ant Design Pro</code>çš„æƒé™è®¾è®¡æ€è·¯ï¼Œä½†å¹¶ä¸æ˜¯å®Œå…¨å¯¹å…¶æºç çš„è§£è¯»ï¼ˆå¯èƒ½æ›´åå‘äº v1 çš„æ¶‰åŠæ€è·¯ï¼Œä¸æ¶‰åŠ umiï¼‰ã€‚</p>
<p>å¦‚æœæœ‰é”™è¯¯ä»¥åŠç†è§£åå·®è¯·è½»æ¶å¹¶æŒ‡æ­£ï¼Œè°¢è°¢ã€‚</p>
<h2 id="æ¨¡å—çº§åˆ«çš„æƒé™å¤„ç†">æ¨¡å—çº§åˆ«çš„æƒé™å¤„ç†</h2>
<p>å‡è®¾å­˜åœ¨ä»¥ä¸‹å…³ç³»ï¼š</p>
<table>
<thead>
<tr>
<th>è§’è‰² role</th>
<th>æƒé™æšä¸¾å€¼ authority</th>
<th>é€»è¾‘</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ™®é€šç”¨æˆ·</td>
<td>user</td>
<td>ä¸å±•ç¤º</td>
</tr>
<tr>
<td>ç®¡ç†å‘˜</td>
<td>admin</td>
<td>å±•ç¤ºâ€œè¿›å…¥ç®¡ç†åå°â€æŒ‰é’®</td>
</tr>
</tbody>
</table>
<p>æŸé¡µé¢ä¸Šå­˜åœ¨ä¸€ä¸ªæ–‡æ¡ˆä¸ºâ€œè¿›å…¥ç®¡ç†åå°â€çš„æŒ‰é’®ï¼Œåªå¯¹ç®¡ç†å‘˜å±•ç¤ºï¼Œè®©æˆ‘ä»¬å®ç°ä¸€ä¸‹ã€‚</p>
<h3 id="ç®€å•å®ç°">ç®€å•å®ç°</h3>
<pre><code class="language-jsx">// currentAuthority ä¸ºå½“å‰ç”¨æˆ·æƒé™æšä¸¾å€¼

const AdminBtn = ({ currentAuthority }) =&gt; {
  if (&quot;admin&quot; === currentAuthority) {
    return &lt;button&gt;è¿›å…¥ç®¡ç†åå°&lt;/button&gt;;
  }
  return null;
};
</code></pre>
<p>å¥½å§ï¼Œç®€å•è‡³æã€‚</p>
<p>æƒé™æ§åˆ¶å°±æ˜¯<code>if else</code>ï¼Œå®ç°åŠŸèƒ½å¹¶ä¸å¤æ‚ï¼Œå¤§ä¸äº†æ¯ä¸ªé¡µé¢|æ¨¡å—|æŒ‰é’®æ¶‰åŠåˆ°çš„å¤„ç†éƒ½å†™ä¸€éåˆ¤æ–­å°±æ˜¯äº†ï¼Œæ€»èƒ½å®ç°éœ€æ±‚çš„ã€‚</p>
<p>ä¸è¿‡ï¼Œç°åœ¨åªæ˜¯ä¸€ä¸ªé¡µé¢ä¸­çš„ä¸€ä¸ªæŒ‰é’®è€Œå·²ï¼Œæˆ‘ä»¬è¿˜ä¼šç¢°åˆ°è®¸å¤šâ€œæŸï¼ˆå‡ ï¼‰ä¸ªé¡µé¢å­˜åœ¨æŸä¸ª xxxï¼Œåªå¯¹ xxxï¼ˆæˆ–/ä»¥åŠ xxxï¼‰ å±•ç¤ºâ€çš„åœºæ™¯ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿˜èƒ½åšçš„æ›´å¥½ä¸€äº›ã€‚</p>
<p>ä¸‹é¢æ¥å°è£…ä¸€ä¸ªæœ€åŸºæœ¬çš„æƒé™ç®¡ç†ç»„ä»¶<code>Authorized</code>ã€‚</p>
<h3 id="ç»„ä»¶å°è£…-authorized">ç»„ä»¶å°è£…-Authorized</h3>
<p>æœŸæœ›è°ƒç”¨å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">&lt;Authorized
  currentAuthority={currentAuthority}
  authority={&quot;admin&quot;}
  noMatch={null}
&gt;
  &lt;button&gt;è¿›å…¥ç®¡ç†åå°&lt;/button&gt;
&lt;/Authorized&gt;
</code></pre>
<p>api å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ç±»å‹</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>children</td>
<td>æ­£å¸¸æ¸²æŸ“çš„å…ƒç´ ï¼Œæƒé™åˆ¤æ–­é€šè¿‡æ—¶å±•ç¤º</td>
<td></td>
<td>ReactNode</td>
</tr>
<tr>
<td>currentAuthority</td>
<td>å½“å‰æƒé™</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>authority</td>
<td>å‡†å…¥æƒé™</td>
<td>string/string[]</td>
<td></td>
</tr>
<tr>
<td>noMatch</td>
<td>æœªé€šè¿‡æƒé™åˆ¤æ–­æ—¶å±•ç¤º</td>
<td>ReactNode</td>
<td></td>
</tr>
</tbody>
</table>
<p><code>currentAuthority</code>è¿™ä¸ªå±æ€§æ²¡æœ‰å¿…è¦æ¯æ¬¡è°ƒç”¨éƒ½æ‰‹åŠ¨ä¼ é€’ä¸€éï¼Œæ­¤å¤„å‡è®¾ç”¨æˆ·ä¿¡æ¯æ˜¯é€šè¿‡ <code>redux</code> è·å–å¹¶å­˜æ”¾åœ¨å…¨å±€ <code>store</code> ä¸­ã€‚</p>
<p><em>æ³¨æ„ï¼šæˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯æŒ‚åœ¨ <code>window</code> ä¸‹æˆ–è€… <code>localStorage</code> ä¸­ï¼Œä½†å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œç»å¤§éƒ¨åˆ†åœºæ™¯æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡æ¥å£å¼‚æ­¥è·å–çš„æ•°æ®ï¼Œè¿™ç‚¹è‡³å…³é‡è¦ã€‚å¦‚æœæ˜¯ <code>html</code> æ‰˜ç®¡åœ¨åç«¯æˆ–æ˜¯ <code>ssr</code>çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯ç›´æ¥æ³¨å…¥äº†ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£çœŸæ˜¯å†å¥½ä¸è¿‡äº†ã€‚</em></p>
<p>æ–°å»º<code>src/components/Authorized/Authorized.jsx</code>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import { connect } from &quot;react-redux&quot;;

function Authorized(props) {
  const { children, userInfo, authority, noMatch } = props;
  const { currentAuthority } = userInfo || {};
  if (!authority) return children;
  const _authority = Array.isArray(authority) ? authority : [authority];
  if (_authority.includes(currentAuthority)) return children;
  return noMatch;
}

export default connect(store =&gt; ({ userInfo: store.common.userInfo }))(
  Authorized
);
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬æ— éœ€æ‰‹åŠ¨ä¼ é€’<code>currentAuthority</code>ï¼š</p>
<pre><code class="language-jsx">&lt;Authorized authority={&quot;admin&quot;} noMatch={null}&gt;
  &lt;button&gt;è¿›å…¥ç®¡ç†åå°&lt;/button&gt;
&lt;/Authorized&gt;
</code></pre>
<p>âœ¨ å¾ˆå¥½ï¼Œæˆ‘ä»¬ç°åœ¨è¿ˆå‡ºäº†ç¬¬ä¸€æ­¥ã€‚</p>
<blockquote>
<p>åœ¨<code>Ant Design Pro</code>ä¸­ï¼Œå¯¹äº<code>currentAuthority</code>ï¼ˆå½“å‰æƒé™ï¼‰ä¸<code>authority</code>ï¼ˆå‡†å…¥æƒé™ï¼‰çš„åŒ¹é…åŠŸèƒ½ï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>checkPermissions</code>æ–¹æ³•ï¼Œæä¾›äº†å„ç§å½¢å¼çš„åŒ¹é…ï¼Œæœ¬æ–‡åªè®¨è®º<code>authority</code>ä¸ºæ•°ç»„ï¼ˆå¤šä¸ªå‡†å…¥æƒé™ï¼‰æˆ–å­—ç¬¦ä¸²ï¼ˆå•ä¸ªå‡†å…¥æƒé™ï¼‰ï¼Œ<code>currentAuthority</code>ä¸ºå­—ç¬¦ä¸²ï¼ˆå½“å‰è§’è‰²åªæœ‰ä¸€ç§æƒé™ï¼‰çš„æƒ…å†µã€‚</p>
</blockquote>
<h2 id="é¡µé¢çº§åˆ«çš„æƒé™å¤„ç†">é¡µé¢çº§åˆ«çš„æƒé™å¤„ç†</h2>
<p><strong>é¡µé¢å°±æ˜¯æ”¾åœ¨<code>Route</code>ç»„ä»¶ä¸‹çš„æ¨¡å—ã€‚</strong></p>
<p>çŸ¥é“è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬å¾ˆè½»æ¾çš„å¯ä»¥å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š</p>
<p>æ–°å»º<code>src/router/index.jsx</code>ï¼Œå½“ç”¨æˆ·è§’è‰²ä¸è·¯ç”±ä¸åŒ¹é…æ—¶ï¼Œæ¸²æŸ“<code>Redirect</code>ç»„ä»¶ç”¨äºé‡å®šå‘ã€‚</p>
<pre><code class="language-jsx">import React from &quot;react&quot;;
import { BrowserRouter, Route, Switch } from &quot;react-router-dom&quot;;
import NormalPage from &quot;@/views/NormalPage&quot;; /* å…¬å¼€é¡µé¢ */
import UserPage from &quot;@/views/UserPage&quot;; /* æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜å‡å¯è®¿é—®çš„é¡µé¢*/
import AdminPage from &quot;@/views/AdminPage&quot;; /* ç®¡ç†å‘˜æ‰å¯è®¿é—®çš„é¡µé¢*/
import Authorized from &quot;@/components/Authorized&quot;;

// Layoutå°±æ˜¯ä¸€ä¸ªå¸ƒå±€ç»„ä»¶ï¼Œå†™ä¸€äº›å…¬ç”¨å¤´éƒ¨åº•éƒ¨å•¥çš„

function Router() {
  &lt;BrowserRouter&gt;
    &lt;Layout&gt;
      &lt;Switch&gt;
        &lt;Route exact path=&quot;/&quot; component={NormalPage} /&gt;

        &lt;Authorized
          authority={[&quot;admin&quot;, &quot;user&quot;]}
          noMatch={
            &lt;Route
              path=&quot;/user-page&quot;
              render={() =&gt; &lt;Redirect to={{ pathname: &quot;/login&quot; }} /&gt;}
            /&gt;
          }
        &gt;
          &lt;Route path=&quot;/user-page&quot; component={UserPage} /&gt;
        &lt;/Authorized&gt;

        &lt;Authorized
          authority={&quot;admin&quot;}
          noMatch={
            &lt;Route
              path=&quot;/admin-page&quot;
              render={() =&gt; &lt;Redirect to={{ pathname: &quot;/403&quot; }} /&gt;}
            /&gt;
          }
        &gt;
          &lt;Route path=&quot;/admin-page&quot; component={AdminPage} /&gt;
        &lt;/Authorized&gt;
      &lt;/Switch&gt;
    &lt;/Layout&gt;
  &lt;/BrowserRouter&gt;;
}

export default Router;
</code></pre>
<p>è¿™æ®µä»£ç æ˜¯ä¸ work çš„ï¼Œå› ä¸ºå½“å‰æƒé™ä¿¡æ¯æ˜¯é€šè¿‡æ¥å£å¼‚æ­¥è·å–çš„ï¼Œæ­¤æ—¶<code>Authorized</code>ç»„ä»¶è·å–ä¸åˆ°å½“å‰æƒé™ï¼ˆ<code>currentAuthority</code>ï¼‰ï¼Œå€˜è‹¥ç›´æ¥é€šè¿‡ url è®¿é—®<code>/user-page</code>æˆ–<code>/admin-page</code>ï¼Œä¸è®ºç”¨æˆ·èº«ä»½æ˜¯å¦ç¬¦åˆï¼Œè¯·æ±‚ç»“æœæœªå›æ¥ï¼Œéƒ½ä¼šè¢«é‡å®šå‘åˆ°<code>/login</code>æˆ–<code>/403</code>ï¼Œè¿™ä¸ªé—®é¢˜åé¢å†è°ˆã€‚</p>
<p>å…ˆä¼˜åŒ–ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ã€‚</p>
<h3 id="æŠ½ç¦»è·¯ç”±é…ç½®">æŠ½ç¦»è·¯ç”±é…ç½®</h3>
<p>è·¯ç”±é…ç½®ç›¸å…³ jsx å†…å®¹å¤ªå¤šäº†ï¼Œé¡µé¢æ•°é‡è¿‡å¤šå°±ä¸å¥½ç»´æŠ¤äº†ï¼Œå¯è¯»æ€§ä¹Ÿå¤§å¤§é™ä½ï¼Œæˆ‘ä»¬å¯ä»¥å°†è·¯ç”±é…ç½®æŠ½ç¦»å‡ºæ¥ã€‚</p>
<p>æ–°å»º<code>src/router/router.config.js</code>ï¼Œä¸“é—¨ç”¨äºå­˜æ”¾è·¯ç”±ç›¸å…³é…ç½®ä¿¡æ¯ã€‚</p>
<pre><code class="language-jsx">import NormalPage from &quot;@/views/NormalPage&quot;;
import UserPage from &quot;@/views/UserPage&quot;;
import AdminPage from &quot;@/views/AdminPage&quot;;

export default [
  {
    exact: true,
    path: &quot;/&quot;,
    component: NormalPage
  },
  {
    path: &quot;/user-page&quot;,
    component: UserPage,
    authority: [&quot;user&quot;, &quot;admin&quot;],
    redirectPath: &quot;/login&quot;
  },
  {
    path: &quot;/admin-page&quot;,
    component: AdminPage,
    authority: [&quot;admin&quot;],
    redirectPath: &quot;/403&quot;
  }
];
</code></pre>
<h3 id="ç»„ä»¶å°è£…-authorizedroute">ç»„ä»¶å°è£…-AuthorizedRoute</h3>
<p>æ¥ä¸‹æ¥åŸºäº<code>Authorized</code>ç»„ä»¶å¯¹<code>Route</code>ç»„ä»¶è¿›è¡ŒäºŒæ¬¡å°è£…ã€‚</p>
<p>æ–°å»º<code>src/components/Authorized/AuthorizedRoute.jsx</code>ã€‚</p>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import React from &quot;react&quot;;
import { Route } from &quot;react-router-dom&quot;;
import Authorized from &quot;./Authorized&quot;;

function AuthorizedRoute({
  component: Component,
  render,
  authority,
  redirectPath,
  ...rest
}) {
  return (
    &lt;Authorized
      authority={authority}
      noMatch={
        &lt;Route
          {...rest}
          render={() =&gt; &lt;Redirect to={{ pathname: redirectPath }} /&gt;}
        /&gt;
      }
    &gt;
      &lt;Route
        {...rest}
        render={props =&gt; (Component ? &lt;Component {...props} /&gt; : render(props))}
      /&gt;
    &lt;/Authorized&gt;
  );
}

export default AuthorizedRoute;
</code></pre>
<h3 id="ä¼˜åŒ–å">ä¼˜åŒ–å</h3>
<p>ç°åœ¨é‡å†™æˆ‘ä»¬çš„ Router ç»„ä»¶ã€‚</p>
<pre><code class="language-jsx">import React from &quot;react&quot;;
import { BrowserRouter, Route, Switch } from &quot;react-router-dom&quot;;
import AuthorizedRoute from &quot;@/components/AuthorizedRoute&quot;;
import routeConfig from &quot;./router.config.js&quot;;

function Router() {
  &lt;BrowserRouter&gt;
    &lt;Layout&gt;
      &lt;Switch&gt;
        {routeConfig.map(rc =&gt; {
          const { path, component, authority, redirectPath, ...rest } = rc;
          return (
            &lt;AuthorizedRoute
              key={path}
              path={path}
              component={component}
              authority={authority}
              redirectPath={redirectPath}
              {...rest}
            /&gt;
          );
        })}
      &lt;/Switch&gt;
    &lt;/Layout&gt;
  &lt;/BrowserRouter&gt;;
}

export default Router;
</code></pre>
<p>å¿ƒæƒ…èˆ’ç•…äº†è®¸å¤šã€‚</p>
<p>å¯æ˜¯è¿˜ç•™ç€ä¸€ä¸ªé—®é¢˜å‘¢â€”â€”ç”±äºç”¨æˆ·æƒé™ä¿¡æ¯æ˜¯å¼‚æ­¥è·å–çš„ï¼Œåœ¨æƒé™ä¿¡æ¯æ•°æ®è¿”å›ä¹‹å‰ï¼Œ<code>AuthorizedRoute</code>ç»„ä»¶å°±å°†ç”¨æˆ·æ¨åˆ°äº†<code>redirectPath</code>ã€‚</p>
<blockquote>
<p>å…¶å®<code>Ant Design Pro</code> v4 ç‰ˆæœ¬å°±æœ‰å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œç›¸è¾ƒäº v2 çš„<code>@/pages/Authorized</code>ç»„ä»¶ä»<code>localStorage</code>ä¸­è·å–æƒé™ä¿¡æ¯ï¼Œv4 æ”¹ä¸ºä» redux ä¸­è·å–ï¼ˆredux ä¸­çš„æ•°æ®åˆ™æ˜¯é€šè¿‡æ¥å£è·å–ï¼‰ï¼Œå’Œæœ¬æ–‡æ¯”è¾ƒç±»ä¼¼ã€‚å…·ä½“å¯è§<a href="https://github.com/ant-design/ant-design-pro/pull/5088">æ­¤æ¬¡ PR</a>ã€‚</p>
</blockquote>
<h3 id="å¼‚æ­¥è·å–æƒé™">å¼‚æ­¥è·å–æƒé™</h3>
<p>è§£å†³æ€è·¯å¾ˆç®€å•ï¼šä¿è¯ç›¸å…³æƒé™ç»„ä»¶æŒ‚è½½æ—¶ï¼Œredux ä¸­å·²ç»å­˜åœ¨ç”¨æˆ·æƒé™ä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œæ¥å£æ•°æ®è¿”å›åï¼Œå†è¿›è¡Œç›¸å…³æ¸²æŸ“ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ Layout ä¸­è¿›è¡Œç”¨æˆ·ä¿¡æ¯çš„è·å–ï¼Œæ•°æ®è·å–å®Œæ¯•åæ¸²æŸ“<code>children</code>ã€‚</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p><code>Ant Design Pro</code>ä» v2 å¼€å§‹åº•å±‚åŸºäº <code>umi</code>å®ç°ï¼Œé€šè¿‡è·¯ç”±é…ç½®çš„ <code>Routes</code> å±æ€§ï¼Œç»“åˆ<code>@/pages/Authorized</code>ç»„ä»¶ï¼ˆè¯¥ç»„ä»¶åŸºäº<code>@/utils/Authorized</code>ç»„ä»¶â€”â€”<code>@/components/Authorized</code>çš„äºŒæ¬¡å°è£…ï¼Œæ³¨å…¥<code>currentAuthority</code>ï¼ˆå½“å‰æƒé™ï¼‰ï¼‰å®ç°ä¸»è¦æµç¨‹ã€‚ åŒæ—¶ï¼Œæƒé™ä¿¡æ¯å­˜æ”¾äº<code>localStorage</code>ï¼Œé€šè¿‡<code>@/utils/authority.js</code>æä¾›çš„å·¥å…·æ–¹æ³•è¿›è¡Œæƒé™ <code>get</code> ä»¥åŠ <code>set</code>ã€‚</p>
<p>ä»”ç»†çœ‹äº†ä¸‹<code>@/components/Authorized</code>æ–‡ä»¶ä¸‹çš„å†…å®¹ï¼Œå‘ç°è¿˜æä¾›äº†<code>AuthorizedRoute</code>ç»„ä»¶ï¼Œä½†æ˜¯å¹¶æœªåœ¨ä»£ç ä¸­ä½¿ç”¨ï¼ˆå–è€Œä»£ä¹‹çš„æ˜¯<code>@/pages/Authorized</code>ç»„ä»¶ï¼‰ï¼Œç¿»äº† issue æ‰äº†è§£åˆ°ï¼Œv1 æ²¡æœ‰åŸºäº<code>umi</code>çš„æ—¶å€™ï¼Œæ˜¯åŸºäº<code>AuthorizedRoute</code>è¿›è¡Œè·¯ç”±æƒé™ç®¡ç†çš„ï¼Œå‡çº§äº†ä¹‹åï¼Œ<code>AuthorizedRoute</code>åˆ™å¹¶æ²¡æœ‰ç”¨äºè·¯ç”±æƒé™ç®¡ç†ã€‚</p>
<p>æ¶‰åŠåˆ°çš„ç›¸å…³æ–‡ä»¶æ¯”è¾ƒå¤šï¼ˆcomponents/pages/utilsï¼‰ï¼Œv4 çš„æ–‡æ¡£åˆæœ‰äº›ç¼ºå¤±ï¼Œçœ‹æºç çš„è¯ï¼Œè‹¥æ²¡æœ‰ç†æ¸…ç‰ˆæœ¬ä¹‹é—´å·®å¼‚ï¼Œç€å®ä¼šæœ‰äº›è´¹åŠ›ã€‚</p>
<p>æœ¬æ–‡åœ¨æƒé™ä¿¡æ¯è·å–ä¸Šï¼Œé€šè¿‡æ¥å£å¼‚æ­¥è·å–ï¼Œå­˜æ”¾è‡³ reduxï¼ˆå’Œ v4 ç‰ˆæœ¬æœ‰äº›ç±»ä¼¼ï¼Œè§<code>@/pages/Authorized</code>ä»¥åŠ<code>@/layouts/SecurityLayout</code>ï¼‰ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åŸºäºReactçš„æƒé™ç³»ç»Ÿè®¾è®¡]]></title>
        <id>https://worldzhao.github.io/post/authorization-with-react/</id>
        <link href="https://worldzhao.github.io/post/authorization-with-react/">
        </link>
        <updated>2019-09-25T11:52:53.000Z</updated>
        <summary type="html"><![CDATA[<p>å‰ç«¯è¿›è¡Œæƒé™æ§åˆ¶åªæ˜¯ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œå¯¹åº”çš„è§’è‰²æ¸²æŸ“å¯¹åº”çš„è§†å›¾ï¼ŒçœŸæ­£çš„å®‰å…¨ä¿éšœåœ¨åç«¯ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å‰ç«¯è¿›è¡Œæƒé™æ§åˆ¶åªæ˜¯ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œå¯¹åº”çš„è§’è‰²æ¸²æŸ“å¯¹åº”çš„è§†å›¾ï¼ŒçœŸæ­£çš„å®‰å…¨ä¿éšœåœ¨åç«¯ã€‚</p>
<!-- more -->
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æ¯•ä¸šä¹‹åˆï¼Œå·¥ä½œçš„ä¸»è¦å†…å®¹ä¾¿æ˜¯å¼€å‘ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿï¼Œå½“æ—¶å­˜åœ¨çš„ä¸€ä¸ªç°è±¡æ˜¯ï¼š</p>
<p><strong>ç”¨æˆ·è‹¥è®°ä½äº†æŸä¸ª urlï¼Œç›´æ¥æµè§ˆå™¨è¾“å…¥ï¼Œä¸è®ºè¯¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®è¯¥é¡µé¢çš„æƒé™ï¼Œå‡èƒ½è¿›å…¥é¡µé¢ã€‚</strong></p>
<p>è‹¥é¡µé¢åˆå§‹åŒ–æ—¶ï¼ˆ<code>componentDidMount</code>ï¼‰è¿›è¡Œæ¥å£è¯·æ±‚ï¼Œåç«¯ä¼šè¿”å› 403 çš„ HTTP çŠ¶æ€ç ï¼ŒåŒæ—¶å‰ç«¯å°è£…çš„<code>request.js</code>ä¼šå¯¹éä¸šåŠ¡å¼‚å¸¸è¿›è¡Œç›¸å…³å¤„ç†ï¼Œé‡è§ 403ï¼Œå°±é‡å®šå‘åˆ°æ— æƒé™é¡µé¢ã€‚</p>
<p>è‹¥æ˜¯é¡µé¢åˆå§‹åŒ–æ—¶ä¸å­˜åœ¨å‰åç«¯äº¤äº’ï¼Œé‚£å°±è¦ç­‰ç”¨æˆ·è§¦å‘æŸäº›æ“ä½œï¼ˆæ¯”å¦‚è¡¨å•æäº¤ï¼‰åæ‰ä¼šè§¦å‘ä¸Šè¿°æµç¨‹ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®‰å…¨ä¿éšœæ˜¯åç«¯å…œåº•çš„ï¼Œé‚£å‰ç«¯èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ol>
<li>æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œé¿å…ç”¨æˆ·è¯¯ä»¥ä¸ºè‡ªå·±æ‹¥æœ‰è¯¥æƒé™è€Œè¿›è¡Œæ“ä½œï¼ˆå³ä½¿æ— æ³•æ“ä½œæˆåŠŸï¼‰ï¼Œç›´æ¥è·³è½¬è‡³æ— æƒé™é¡µé¢ï¼›</li>
<li>æ‹¦æˆªæ˜ç¡®æ— æƒçš„è¯·æ±‚ï¼Œæ¯”å¦‚æŸäº›éœ€è¦æƒé™æ‰èƒ½è¿›è¡Œçš„æ“ä½œå…¥å£ï¼ˆæŒ‰é’® or å¯¼èˆªç­‰ï¼‰ä¸å¯¹æ— æƒç”¨æˆ·å±•ç¤ºï¼Œå…¶å®æœ¬ç‚¹åŒ…å«ä¸Šä¸€ç‚¹ã€‚</li>
</ol>
<p>æœ€è¿‘ä¹Ÿåœ¨çœ‹<code>Ant Design Pro</code>çš„æƒé™ç›¸å…³å¤„ç†ï¼Œæœ‰å¿…è¦è¿›è¡Œä¸€æ¬¡æ€»ç»“ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬æ–‡è™½ç„¶åŸºäº<code>Ant Design Pro</code>çš„æƒé™è®¾è®¡æ€è·¯ï¼Œä½†å¹¶ä¸æ˜¯å®Œå…¨å¯¹å…¶æºç çš„è§£è¯»ï¼ˆå¯èƒ½æ›´åå‘äº v1 çš„æ¶‰åŠæ€è·¯ï¼Œä¸æ¶‰åŠ umiï¼‰ã€‚</p>
<p>å¦‚æœæœ‰é”™è¯¯ä»¥åŠç†è§£åå·®è¯·è½»æ¶å¹¶æŒ‡æ­£ï¼Œè°¢è°¢ã€‚</p>
<h2 id="æ¨¡å—çº§åˆ«çš„æƒé™å¤„ç†">æ¨¡å—çº§åˆ«çš„æƒé™å¤„ç†</h2>
<p>å‡è®¾å­˜åœ¨ä»¥ä¸‹å…³ç³»ï¼š</p>
<table>
<thead>
<tr>
<th>è§’è‰² role</th>
<th>æƒé™æšä¸¾å€¼ authority</th>
<th>é€»è¾‘</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ™®é€šç”¨æˆ·</td>
<td>user</td>
<td>ä¸å±•ç¤º</td>
</tr>
<tr>
<td>ç®¡ç†å‘˜</td>
<td>admin</td>
<td>å±•ç¤ºâ€œè¿›å…¥ç®¡ç†åå°â€æŒ‰é’®</td>
</tr>
</tbody>
</table>
<p>æŸé¡µé¢ä¸Šå­˜åœ¨ä¸€ä¸ªæ–‡æ¡ˆä¸ºâ€œè¿›å…¥ç®¡ç†åå°â€çš„æŒ‰é’®ï¼Œåªå¯¹ç®¡ç†å‘˜å±•ç¤ºï¼Œè®©æˆ‘ä»¬å®ç°ä¸€ä¸‹ã€‚</p>
<h3 id="ç®€å•å®ç°">ç®€å•å®ç°</h3>
<pre><code class="language-jsx">// currentAuthority ä¸ºå½“å‰ç”¨æˆ·æƒé™æšä¸¾å€¼

const AdminBtn = ({ currentAuthority }) =&gt; {
  if ('admin' === currentAuthority) {
    return &lt;button&gt;è¿›å…¥ç®¡ç†åå°&lt;/button&gt;;
  }
  return null;
};
</code></pre>
<p>å¥½å§ï¼Œç®€å•è‡³æã€‚</p>
<p>æƒé™æ§åˆ¶å°±æ˜¯<code>if else</code>ï¼Œå®ç°åŠŸèƒ½å¹¶ä¸å¤æ‚ï¼Œå¤§ä¸äº†æ¯ä¸ªé¡µé¢|æ¨¡å—|æŒ‰é’®æ¶‰åŠåˆ°çš„å¤„ç†éƒ½å†™ä¸€éåˆ¤æ–­å°±æ˜¯äº†ï¼Œæ€»èƒ½å®ç°éœ€æ±‚çš„ã€‚</p>
<p>ä¸è¿‡ï¼Œç°åœ¨åªæ˜¯ä¸€ä¸ªé¡µé¢ä¸­çš„ä¸€ä¸ªæŒ‰é’®è€Œå·²ï¼Œæˆ‘ä»¬è¿˜ä¼šç¢°åˆ°è®¸å¤šâ€œæŸï¼ˆå‡ ï¼‰ä¸ªé¡µé¢å­˜åœ¨æŸä¸ª xxxï¼Œåªå¯¹ xxxï¼ˆæˆ–/ä»¥åŠ xxxï¼‰ å±•ç¤ºâ€çš„åœºæ™¯ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿˜èƒ½åšçš„æ›´å¥½ä¸€äº›ã€‚</p>
<p>ä¸‹é¢æ¥å°è£…ä¸€ä¸ªæœ€åŸºæœ¬çš„æƒé™ç®¡ç†ç»„ä»¶<code>Authorized</code>ã€‚</p>
<h3 id="ç»„ä»¶å°è£…-authorized">ç»„ä»¶å°è£…-Authorized</h3>
<p>æœŸæœ›è°ƒç”¨å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">&lt;Authorized currentAuthority={currentAuthority} authority={'admin'} noMatch={null}&gt;
  &lt;button&gt;è¿›å…¥ç®¡ç†åå°&lt;/button&gt;
&lt;/Authorized&gt;
</code></pre>
<p>api å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ç±»å‹</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>children</td>
<td>æ­£å¸¸æ¸²æŸ“çš„å…ƒç´ ï¼Œæƒé™åˆ¤æ–­é€šè¿‡æ—¶å±•ç¤º</td>
<td></td>
<td>ReactNode</td>
</tr>
<tr>
<td>currentAuthority</td>
<td>å½“å‰æƒé™</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>authority</td>
<td>å‡†å…¥æƒé™</td>
<td>string/string[]</td>
<td></td>
</tr>
<tr>
<td>noMatch</td>
<td>æœªé€šè¿‡æƒé™åˆ¤æ–­æ—¶å±•ç¤º</td>
<td>ReactNode</td>
<td></td>
</tr>
</tbody>
</table>
<p><code>currentAuthority</code>è¿™ä¸ªå±æ€§æ²¡æœ‰å¿…è¦æ¯æ¬¡è°ƒç”¨éƒ½æ‰‹åŠ¨ä¼ é€’ä¸€éï¼Œæ­¤å¤„å‡è®¾ç”¨æˆ·ä¿¡æ¯æ˜¯é€šè¿‡ <code>redux</code> è·å–å¹¶å­˜æ”¾åœ¨å…¨å±€ <code>store</code> ä¸­ã€‚</p>
<p><em>æ³¨æ„ï¼šæˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯æŒ‚åœ¨ <code>window</code> ä¸‹æˆ–è€… <code>localStorage</code> ä¸­ï¼Œä½†å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œç»å¤§éƒ¨åˆ†åœºæ™¯æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡æ¥å£å¼‚æ­¥è·å–çš„æ•°æ®ï¼Œè¿™ç‚¹è‡³å…³é‡è¦ã€‚å¦‚æœæ˜¯ <code>html</code> æ‰˜ç®¡åœ¨åç«¯æˆ–æ˜¯ <code>ssr</code>çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯ç›´æ¥æ³¨å…¥äº†ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£çœŸæ˜¯å†å¥½ä¸è¿‡äº†ã€‚</em></p>
<p>æ–°å»º<code>src/components/Authorized/Authorized.jsx</code>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import { connect } from 'react-redux';

function Authorized(props) {
  const { children, userInfo, authority, noMatch } = props;
  const { currentAuthority } = userInfo || {};
  if (!authority) return children;
  const _authority = Array.isArray(authority) ? authority : [authority];
  if (_authority.includes(currentAuthority)) return children;
  return noMatch;
}

export default connect(store =&gt; ({ userInfo: store.common.userInfo }))(Authorized);
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬æ— éœ€æ‰‹åŠ¨ä¼ é€’<code>currentAuthority</code>ï¼š</p>
<pre><code class="language-jsx">&lt;Authorized authority={'admin'} noMatch={null}&gt;
  &lt;button&gt;è¿›å…¥ç®¡ç†åå°&lt;/button&gt;
&lt;/Authorized&gt;
</code></pre>
<p>âœ¨ å¾ˆå¥½ï¼Œæˆ‘ä»¬ç°åœ¨è¿ˆå‡ºäº†ç¬¬ä¸€æ­¥ã€‚</p>
<blockquote>
<p>åœ¨<code>Ant Design Pro</code>ä¸­ï¼Œå¯¹äº<code>currentAuthority</code>ï¼ˆå½“å‰æƒé™ï¼‰ä¸<code>authority</code>ï¼ˆå‡†å…¥æƒé™ï¼‰çš„åŒ¹é…åŠŸèƒ½ï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>checkPermissions</code>æ–¹æ³•ï¼Œæä¾›äº†å„ç§å½¢å¼çš„åŒ¹é…ï¼Œæœ¬æ–‡åªè®¨è®º<code>authority</code>ä¸ºæ•°ç»„ï¼ˆå¤šä¸ªå‡†å…¥æƒé™ï¼‰æˆ–å­—ç¬¦ä¸²ï¼ˆå•ä¸ªå‡†å…¥æƒé™ï¼‰ï¼Œ<code>currentAuthority</code>ä¸ºå­—ç¬¦ä¸²ï¼ˆå½“å‰è§’è‰²åªæœ‰ä¸€ç§æƒé™ï¼‰çš„æƒ…å†µã€‚</p>
</blockquote>
<h2 id="é¡µé¢çº§åˆ«çš„æƒé™å¤„ç†">é¡µé¢çº§åˆ«çš„æƒé™å¤„ç†</h2>
<p><strong>é¡µé¢å°±æ˜¯æ”¾åœ¨<code>Route</code>ç»„ä»¶ä¸‹çš„æ¨¡å—ã€‚</strong></p>
<p>çŸ¥é“è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬å¾ˆè½»æ¾çš„å¯ä»¥å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š</p>
<p>æ–°å»º<code>src/router/index.jsx</code>ï¼Œå½“ç”¨æˆ·è§’è‰²ä¸è·¯ç”±ä¸åŒ¹é…æ—¶ï¼Œæ¸²æŸ“<code>Redirect</code>ç»„ä»¶ç”¨äºé‡å®šå‘ã€‚</p>
<pre><code class="language-jsx">import React from 'react';
import { BrowserRouter, Route, Switch } from 'react-router-dom';
import NormalPage from '@/views/NormalPage'; /* å…¬å¼€é¡µé¢ */
import UserPage from '@/views/UserPage'; /* æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜å‡å¯è®¿é—®çš„é¡µé¢*/
import AdminPage from '@/views/AdminPage'; /* ç®¡ç†å‘˜æ‰å¯è®¿é—®çš„é¡µé¢*/
import Authorized from '@/components/Authorized';

// Layoutå°±æ˜¯ä¸€ä¸ªå¸ƒå±€ç»„ä»¶ï¼Œå†™ä¸€äº›å…¬ç”¨å¤´éƒ¨åº•éƒ¨å•¥çš„

function Router() {
  return (
    &lt;BrowserRouter&gt;
      &lt;Layout&gt;
        &lt;Switch&gt;
          &lt;Route exact path='/' component={NormalPage} /&gt;

          &lt;Authorized
            authority={['admin', 'user']}
            noMatch={
              &lt;Route path='/user-page' render={() =&gt; &lt;Redirect to={{ pathname: '/login' }} /&gt;} /&gt;
            }
          &gt;
            &lt;Route path='/user-page' component={UserPage} /&gt;
          &lt;/Authorized&gt;

          &lt;Authorized
            authority={'admin'}
            noMatch={
              &lt;Route path='/admin-page' render={() =&gt; &lt;Redirect to={{ pathname: '/403' }} /&gt;} /&gt;
            }
          &gt;
            &lt;Route path='/admin-page' component={AdminPage} /&gt;
          &lt;/Authorized&gt;
        &lt;/Switch&gt;
      &lt;/Layout&gt;
    &lt;/BrowserRouter&gt;
  );
}

export default Router;
</code></pre>
<p>è¿™æ®µä»£ç æ˜¯ä¸ work çš„ï¼Œå› ä¸ºå½“å‰æƒé™ä¿¡æ¯æ˜¯é€šè¿‡æ¥å£å¼‚æ­¥è·å–çš„ï¼Œæ­¤æ—¶<code>Authorized</code>ç»„ä»¶è·å–ä¸åˆ°å½“å‰æƒé™ï¼ˆ<code>currentAuthority</code>ï¼‰ï¼Œå€˜è‹¥ç›´æ¥é€šè¿‡ url è®¿é—®<code>/user-page</code>æˆ–<code>/admin-page</code>ï¼Œä¸è®ºç”¨æˆ·èº«ä»½æ˜¯å¦ç¬¦åˆï¼Œè¯·æ±‚ç»“æœæœªå›æ¥ï¼Œéƒ½ä¼šè¢«é‡å®šå‘åˆ°<code>/login</code>æˆ–<code>/403</code>ï¼Œè¿™ä¸ªé—®é¢˜åé¢å†è°ˆã€‚</p>
<p>å…ˆä¼˜åŒ–ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ã€‚</p>
<h3 id="æŠ½ç¦»è·¯ç”±é…ç½®">æŠ½ç¦»è·¯ç”±é…ç½®</h3>
<p>è·¯ç”±é…ç½®ç›¸å…³ jsx å†…å®¹å¤ªå¤šäº†ï¼Œé¡µé¢æ•°é‡è¿‡å¤šå°±ä¸å¥½ç»´æŠ¤äº†ï¼Œå¯è¯»æ€§ä¹Ÿå¤§å¤§é™ä½ï¼Œæˆ‘ä»¬å¯ä»¥å°†è·¯ç”±é…ç½®æŠ½ç¦»å‡ºæ¥ã€‚</p>
<p>æ–°å»º<code>src/router/router.config.js</code>ï¼Œä¸“é—¨ç”¨äºå­˜æ”¾è·¯ç”±ç›¸å…³é…ç½®ä¿¡æ¯ã€‚</p>
<pre><code class="language-jsx">import NormalPage from '@/views/NormalPage';
import UserPage from '@/views/UserPage';
import AdminPage from '@/views/AdminPage';

export default [
  {
    exact: true,
    path: '/',
    component: NormalPage,
  },
  {
    path: '/user-page',
    component: UserPage,
    authority: ['user', 'admin'],
    redirectPath: '/login',
  },
  {
    path: '/admin-page',
    component: AdminPage,
    authority: ['admin'],
    redirectPath: '/403',
  },
];
</code></pre>
<h3 id="ç»„ä»¶å°è£…-authorizedroute">ç»„ä»¶å°è£…-AuthorizedRoute</h3>
<p>æ¥ä¸‹æ¥åŸºäº<code>Authorized</code>ç»„ä»¶å¯¹<code>Route</code>ç»„ä»¶è¿›è¡ŒäºŒæ¬¡å°è£…ã€‚</p>
<p>æ–°å»º<code>src/components/Authorized/AuthorizedRoute.jsx</code>ã€‚</p>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import React from 'react';
import { Route } from 'react-router-dom';
import Authorized from './Authorized';

function AuthorizedRoute({ component: Component, render, authority, redirectPath, ...rest }) {
  return (
    &lt;Authorized
      authority={authority}
      noMatch={&lt;Route {...rest} render={() =&gt; &lt;Redirect to={{ pathname: redirectPath }} /&gt;} /&gt;}
    &gt;
      &lt;Route {...rest} render={props =&gt; (Component ? &lt;Component {...props} /&gt; : render(props))} /&gt;
    &lt;/Authorized&gt;
  );
}

export default AuthorizedRoute;
</code></pre>
<h3 id="ä¼˜åŒ–å">ä¼˜åŒ–å</h3>
<p>ç°åœ¨é‡å†™æˆ‘ä»¬çš„ Router ç»„ä»¶ã€‚</p>
<pre><code class="language-jsx">import React from 'react';
import { BrowserRouter, Route, Switch } from 'react-router-dom';
import AuthorizedRoute from '@/components/AuthorizedRoute';
import routeConfig from './router.config.js';

function Router() {
  return (
    &lt;BrowserRouter&gt;
      &lt;Layout&gt;
        &lt;Switch&gt;
          {routeConfig.map(rc =&gt; {
            const { path, component, authority, redirectPath, ...rest } = rc;
            return (
              &lt;AuthorizedRoute
                key={path}
                path={path}
                component={component}
                authority={authority}
                redirectPath={redirectPath}
                {...rest}
              /&gt;
            );
          })}
        &lt;/Switch&gt;
      &lt;/Layout&gt;
    &lt;/BrowserRouter&gt;
  );
}

export default Router;
</code></pre>
<p>å¿ƒæƒ…èˆ’ç•…äº†è®¸å¤šã€‚</p>
<p>å¯æ˜¯è¿˜ç•™ç€ä¸€ä¸ªé—®é¢˜å‘¢â€”â€”ç”±äºç”¨æˆ·æƒé™ä¿¡æ¯æ˜¯å¼‚æ­¥è·å–çš„ï¼Œåœ¨æƒé™ä¿¡æ¯æ•°æ®è¿”å›ä¹‹å‰ï¼Œ<code>AuthorizedRoute</code>ç»„ä»¶å°±å°†ç”¨æˆ·æ¨åˆ°äº†<code>redirectPath</code>ã€‚</p>
<blockquote>
<p>å…¶å®<code>Ant Design Pro</code> v4 ç‰ˆæœ¬å°±æœ‰å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œç›¸è¾ƒäº v2 çš„<code>@/pages/Authorized</code>ç»„ä»¶ä»<code>localStorage</code>ä¸­è·å–æƒé™ä¿¡æ¯ï¼Œv4 æ”¹ä¸ºä» redux ä¸­è·å–ï¼ˆredux ä¸­çš„æ•°æ®åˆ™æ˜¯é€šè¿‡æ¥å£è·å–ï¼‰ï¼Œå’Œæœ¬æ–‡æ¯”è¾ƒç±»ä¼¼ã€‚å…·ä½“å¯è§<a href="https://github.com/ant-design/ant-design-pro/pull/5088">æ­¤æ¬¡ PR</a>ã€‚</p>
</blockquote>
<h3 id="å¼‚æ­¥è·å–æƒé™">å¼‚æ­¥è·å–æƒé™</h3>
<p>è§£å†³æ€è·¯å¾ˆç®€å•ï¼šä¿è¯ç›¸å…³æƒé™ç»„ä»¶æŒ‚è½½æ—¶ï¼Œredux ä¸­å·²ç»å­˜åœ¨ç”¨æˆ·æƒé™ä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œæ¥å£æ•°æ®è¿”å›åï¼Œå†è¿›è¡Œç›¸å…³æ¸²æŸ“ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ Layout ä¸­è¿›è¡Œç”¨æˆ·ä¿¡æ¯çš„è·å–ï¼Œæ•°æ®è·å–å®Œæ¯•åæ¸²æŸ“<code>children</code>ã€‚</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p><code>Ant Design Pro</code>ä» v2 å¼€å§‹åº•å±‚åŸºäº <code>umi</code>å®ç°ï¼Œé€šè¿‡è·¯ç”±é…ç½®çš„ <code>Routes</code> å±æ€§ï¼Œç»“åˆ<code>@/pages/Authorized</code>ç»„ä»¶ï¼ˆè¯¥ç»„ä»¶åŸºäº<code>@/utils/Authorized</code>ç»„ä»¶â€”â€”<code>@/components/Authorized</code>çš„äºŒæ¬¡å°è£…ï¼Œæ³¨å…¥<code>currentAuthority</code>ï¼ˆå½“å‰æƒé™ï¼‰ï¼‰å®ç°ä¸»è¦æµç¨‹ã€‚ åŒæ—¶ï¼Œæƒé™ä¿¡æ¯å­˜æ”¾äº<code>localStorage</code>ï¼Œé€šè¿‡<code>@/utils/authority.js</code>æä¾›çš„å·¥å…·æ–¹æ³•è¿›è¡Œæƒé™ <code>get</code> ä»¥åŠ <code>set</code>ã€‚</p>
<p>ä»”ç»†çœ‹äº†ä¸‹<code>@/components/Authorized</code>æ–‡ä»¶ä¸‹çš„å†…å®¹ï¼Œå‘ç°è¿˜æä¾›äº†<code>AuthorizedRoute</code>ç»„ä»¶ï¼Œä½†æ˜¯å¹¶æœªåœ¨ä»£ç ä¸­ä½¿ç”¨ï¼ˆå–è€Œä»£ä¹‹çš„æ˜¯<code>@/pages/Authorized</code>ç»„ä»¶ï¼‰ï¼Œç¿»äº† issue æ‰äº†è§£åˆ°ï¼Œv1 æ²¡æœ‰åŸºäº<code>umi</code>çš„æ—¶å€™ï¼Œæ˜¯åŸºäº<code>AuthorizedRoute</code>è¿›è¡Œè·¯ç”±æƒé™ç®¡ç†çš„ï¼Œå‡çº§äº†ä¹‹åï¼Œ<code>AuthorizedRoute</code>åˆ™å¹¶æ²¡æœ‰ç”¨äºè·¯ç”±æƒé™ç®¡ç†ã€‚</p>
<p>æ¶‰åŠåˆ°çš„ç›¸å…³æ–‡ä»¶æ¯”è¾ƒå¤šï¼ˆcomponents/pages/utilsï¼‰ï¼Œv4 çš„æ–‡æ¡£åˆæœ‰äº›ç¼ºå¤±ï¼Œçœ‹æºç çš„è¯ï¼Œè‹¥æ²¡æœ‰ç†æ¸…ç‰ˆæœ¬ä¹‹é—´å·®å¼‚ï¼Œç€å®ä¼šæœ‰äº›è´¹åŠ›ã€‚</p>
<p>æœ¬æ–‡åœ¨æƒé™ä¿¡æ¯è·å–ä¸Šï¼Œé€šè¿‡æ¥å£å¼‚æ­¥è·å–ï¼Œå­˜æ”¾è‡³ reduxï¼ˆå’Œ v4 ç‰ˆæœ¬æœ‰äº›ç±»ä¼¼ï¼Œè§<code>@/pages/Authorized</code>ä»¥åŠ<code>@/layouts/SecurityLayout</code>ï¼‰ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å…³äºå‰ç«¯é¡¹ç›®éƒ¨ç½²å‘å¸ƒçš„ç›¸å…³æ€è€ƒ]]></title>
        <id>https://worldzhao.github.io/post/thinking-in-deploy/</id>
        <link href="https://worldzhao.github.io/post/thinking-in-deploy/">
        </link>
        <updated>2019-07-20T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ä¹ æƒ¯äº†å‰åç«¯å®Œå…¨åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼Œä¸€æ—¶éš¾ä»¥æ¥å—å‰ç«¯ html æ‰˜ç®¡åœ¨åç«¯è¿™ç§æ“ä½œã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä¹ æƒ¯äº†å‰åç«¯å®Œå…¨åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼Œä¸€æ—¶éš¾ä»¥æ¥å—å‰ç«¯ html æ‰˜ç®¡åœ¨åç«¯è¿™ç§æ“ä½œã€‚</p>
<!-- more -->
<h2 id="å…¬å¸å‰ç«¯é¡¹ç›®éƒ¨ç½²ç°çŠ¶">å…¬å¸å‰ç«¯é¡¹ç›®éƒ¨ç½²ç°çŠ¶</h2>
<p>å°† html æ‰˜ç®¡ç»™åç«¯ï¼Œå‰ç«¯åªå‘é™æ€èµ„æºï¼ˆ<code>index.js</code>/<code>index.css</code>ï¼‰ï¼Œç„¶åé€šè¿‡æŸç§æ–¹å¼å»åˆ· html çš„é™æ€èµ„æºç‰ˆæœ¬å·ï¼ˆ?version=æ—¶é—´æˆ³æˆ–é€’å¢æ•°å­—ï¼‰ã€‚</p>
<p>åŸå› ï¼šHTML æ–‡ä»¶ä¸èƒ½æ”¾åœ¨ CDN ä¸Šï¼Œä¼šè¢«ç¼“å­˜ã€‚</p>
<h2 id="æ¯”è¾ƒå¥½çš„å®è·µ">æ¯”è¾ƒå¥½çš„å®è·µ</h2>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å‰ç«¯é¡¹ç›®éƒ¨ç½²çš„æ¯”è¾ƒå¥½å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å‡ºå¤„ï¼š<a href="https://www.zhihu.com/question/20790576/answer/32602154">å¤§å…¬å¸é‡Œæ€æ ·å¼€å‘å’Œéƒ¨ç½²å‰ç«¯ä»£ç ï¼Ÿ</a></p>
<p>å¯ä»¥æ€»ç»“å‡ºä»¥ä¸‹å››ç‚¹ï¼š</p>
<blockquote>
<ol>
<li>é…ç½®è¶…é•¿æ—¶é—´çš„æœ¬åœ°ç¼“å­˜ â€”â€” èŠ‚çœå¸¦å®½ï¼Œæé«˜æ€§èƒ½</li>
<li>é‡‡ç”¨å†…å®¹æ‘˜è¦ä½œä¸ºç¼“å­˜æ›´æ–°ä¾æ® â€”â€” ç²¾ç¡®çš„ç¼“å­˜æ§åˆ¶</li>
<li>é™æ€èµ„æº CDN éƒ¨ç½² â€”â€” ä¼˜åŒ–ç½‘ç»œè¯·æ±‚</li>
<li>å˜æ›´èµ„æºå‘å¸ƒè·¯å¾„å®ç°éè¦†ç›–å¼å‘å¸ƒ â€”â€” å¹³æ»‘å‡çº§</li>
</ol>
</blockquote>
<p>ä¸Šé¢æ–‡ç« å¯æ˜¯æœ¬æ–‡çš„åŸºçŸ³ï¼Œè™½ç„¶å·²ç»è¿‡å»äº† 5 å¹´ã€‚</p>
<h2 id="å…¬å¸éƒ¨ç½²æ–¹æ¡ˆä¼˜ç¼ºç‚¹">å…¬å¸éƒ¨ç½²æ–¹æ¡ˆä¼˜ç¼ºç‚¹</h2>
<p>å‰ç«¯åªå‘å¸ƒé™æ€èµ„æºï¼Œåªè¦ html å¼•ç”¨çš„èµ„æºä¸åˆ·ç‰ˆæœ¬å·ï¼Œè¯·æ±‚çš„éƒ½æ˜¯ CDN ä¸Šç¼“å­˜çš„èµ„æºï¼ˆå¦‚æœ CDN æœ‰ç¼“å­˜çš„è¯ï¼‰ã€‚</p>
<p><strong>ï¼ˆå¼ºè¡Œï¼‰ä¼˜ç‚¹</strong></p>
<ol>
<li>è¦†ç›–å‘å¸ƒã€‚æœåŠ¡å™¨ä¸ä¼šæœ‰å¤§é‡é™æ€èµ„æºæ–‡ä»¶ç§¯ç´¯ï¼›</li>
<li>åç«¯å¯ä»¥å‘ HTML å†…æ³¨å…¥ä¸€äº›å†…å®¹ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€‚</li>
</ol>
<p><strong>ç¼ºç‚¹</strong></p>
<ol>
<li>ç²—ç²’åº¦çš„ç‰ˆæœ¬å·åˆ·æ–°ç­–ç•¥ï¼Œå¯¼è‡´æ ¹æ®æ–‡ä»¶å†…å®¹å˜åŒ–é€‰æ‹©æ€§æ›´æ–°ç¼“å­˜ï¼ˆå¯¹åº”å®è·µ 2ï¼‰æ— æ³•å®æ–½ï¼›</li>
<li>html æ‰˜ç®¡åœ¨åç«¯ï¼Œå¯¼è‡´ä¸€å®šç¨‹åº¦çš„å‰åç«¯æœªåˆ†ç¦»ï¼ˆè­¬å¦‚æ‰“åŒ…ç­–ç•¥å˜æ›´éœ€è¦åç«¯é…åˆæ›´æ”¹ htmlï¼‰ã€‚</li>
</ol>
<h2 id="ç…§çŒ«ç”»è™">ç…§çŒ«ç”»è™</h2>
<p>é‚£ä¹ˆæŒ‰ç…§ä¸Šé¢çš„å®è·µï¼Œå¦‚ä½•å¤„ç†æ¯”è¾ƒå¥½å‘¢ï¼Ÿ</p>
<ol>
<li>å‰ç«¯æ¯æ¬¡åŸºäº content hashï¼ˆä¾èµ–å†…å®¹æ‘˜è¦ç®—æ³•ï¼‰ æ‰“åŒ…ç”Ÿæˆé™æ€èµ„æºæ–‡ä»¶å(ä¾‹å¦‚ <code>aaa.[contenthash].js</code> ä¸ <code>bbb.[contenthash].css</code>)ï¼Œæ–‡ä»¶åæ˜¯å¦å˜åŒ–å–å†³äºæ–‡ä»¶å†…å®¹æ˜¯å¦å˜åŒ–ï¼›</li>
<li>ä½¿ç”¨å‰ç«¯çš„ htmlï¼Œå‰ç«¯å¯åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­è‡ªåŠ¨æ³¨å…¥é™æ€èµ„æºæ–‡ä»¶åœ°å€ï¼›</li>
<li>é™æ€èµ„æºå…ˆå‘å¸ƒï¼Œhtml åå‘å¸ƒã€‚</li>
</ol>
<p>å†æ¥çœ‹çœ‹ä¸Šé¢çš„ç¼ºç‚¹æ˜¯å¦è¢«è§£å†³äº†ï¼Ÿ</p>
<p><em><code>1. ç²—ç²’åº¦çš„ç‰ˆæœ¬å·åˆ·æ–°ç­–ç•¥ï¼Œå¯¼è‡´æ ¹æ®æ–‡ä»¶å†…å®¹å˜åŒ–é€‰æ‹©æ€§æ›´æ–°ç¼“å­˜ï¼ˆå¯¹åº”å®è·µ 2ï¼‰æ— æ³•å®æ–½</code></em></p>
<p><strong>æ–‡ä»¶åæ˜¯åŸºäº content hashï¼ˆä¾èµ–å†…å®¹æ‘˜è¦ç®—æ³•ï¼‰ç”Ÿæˆï¼Œåœ¨å‘å¸ƒæ–°çš„ html åï¼Œè‹¥æ–‡ä»¶å†…å®¹æœªå‘ç”Ÿå˜åŒ–ï¼Œæ–‡ä»¶åä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä¾æ—§ä½¿ç”¨æœ¬åœ°å¼ºç¼“å­˜ï¼Œè‹¥æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œæ–‡ä»¶åä¼šå‘ç”Ÿæ”¹å˜ï¼Œä¼šè¯·æ±‚æ–°çš„é™æ€èµ„æºï¼Œè¾¾åˆ°äº†é€‰æ‹©æ€§æ›´æ–°ç¼“å­˜çš„æ•ˆæœã€‚</strong></p>
<p><em><code>2. è¦†ç›–å‘å¸ƒã€‚åœ¨ html åˆ·æ–°ç‰ˆæœ¬å·å‰ï¼Œæ–°ç”¨æˆ·å’Œè€ç”¨æˆ·å¯èƒ½çœ‹åˆ°çš„é¡µé¢ç‰ˆæœ¬ï¼ˆåŠŸèƒ½ï¼‰ä¸åŒ</code></em></p>
<p><strong>éè¦†ç›–å¼å‘å¸ƒï¼Œæ–‡ä»¶å[contenthash]ä¸åŒä¸ä¼šè¦†ç›–ï¼Œæ—§çš„é™æ€èµ„æºæ–‡ä»¶ä¾æ—§å­˜åœ¨ã€‚</strong></p>
<p><strong>æ–°çš„é™æ€èµ„æºå‘å¸ƒåï¼Œæ–°çš„ html æœªå‘å¸ƒå‰è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œè€ç”¨æˆ·è¯·æ±‚åˆ°æ—§çš„ htmlï¼Œè¯·æ±‚çš„æ˜¯æ—§çš„é™æ€èµ„æºï¼Œæ–‡ä»¶å(æˆ–è€…è¯´æ–‡ä»¶è·¯å¾„)æœªå˜åŒ–ï¼Œä¾æ—§ä½¿ç”¨æœ¬åœ°å¼ºç¼“å­˜ï¼Œæ–°ç”¨æˆ·è¯·æ±‚åˆ°æ—§çš„ htmlï¼Œæ²¡æœ‰æœ¬åœ°ç¼“å­˜ï¼Œä½†æ—§çš„é™æ€èµ„æºæœªè¢«è¦†ç›–ï¼Œä¾æ—§å¯ä»¥è¯·æ±‚åˆ°ï¼Œæ­¤æ—¶çœ‹åˆ°çš„éƒ½æ˜¯æ—§ç‰ˆæœ¬å†…å®¹ã€‚</strong></p>
<p><strong>æ–°çš„ html å‘å¸ƒåï¼Œè€ç”¨æˆ·æµè§ˆå™¨ä¼šé€‰æ‹©æ€§æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œæ–°ç”¨æˆ·ç›´æ¥è¯·æ±‚æ–°çš„é™æ€èµ„æºï¼Œçœ‹åˆ°çš„éƒ½æ˜¯æ–°ç‰ˆæœ¬å†…å®¹ã€‚</strong></p>
<p><em><code>3. html æ‰˜ç®¡åœ¨åç«¯ï¼Œå¯¼è‡´ä¸€å®šç¨‹åº¦çš„å‰åç«¯æœªåˆ†ç¦»ï¼ˆè­¬å¦‚æ‰“åŒ…ç­–ç•¥å˜æ›´éœ€è¦åç«¯é…åˆæ›´æ”¹ htmlï¼‰</code></em></p>
<p><strong>html å®Œå…¨ç”±å‰ç«¯æ§åˆ¶ï¼Œåç«¯åªéœ€è¦æä¾› API å³å¯ï¼Œå‰åç«¯çœŸæ­£æ„ä¹‰ä¸Šçš„å®Œå…¨åˆ†ç¦»ã€‚</strong></p>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶ hash å€¼ä¸åŒï¼Œéè¦†ç›–å‘å¸ƒï¼Œå¯èƒ½é€ æˆæœåŠ¡å™¨ä¸Šæ— ç”¨çš„é™æ€èµ„æºè¶Šæ¥è¶Šå¤šï¼Œä½†è¿™æ˜¯å¯ä»¥è§£å†³çš„</li>
<li>åç«¯ä¸èƒ½å¾€ html æ³¨å…¥ä¸€äº›å†…å®¹</li>
</ul>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>é¡¹ç›®ä¸Šçº¿éœ€è¦é…ç½® Nginx ï¼Œæµç¨‹ä¸Šè¿˜æœ‰å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åŒæœˆè°ˆ-è¯•ç”¨æœŸæ€è€ƒ]]></title>
        <id>https://worldzhao.github.io/post/probation-period-in-xmly/</id>
        <link href="https://worldzhao.github.io/post/probation-period-in-xmly/">
        </link>
        <updated>2019-07-06T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>åˆ°æ–°å…¬å¸æ¥è¿‘ 2 ä¸ªæœˆäº†ï¼ˆ4.29-7.07ï¼‰ï¼Œè¿™ä¸¤ä¸ªæœˆé‡Œä¹Ÿè®¸æ˜¯æˆ‘æ¯•ä¸šä¸€å¹´æ€è€ƒæœ€å¤šçš„ä¸¤ä¸ªæœˆï¼Œçš„ç¡®æ˜¯æœ‰å¿…è¦è¿›è¡Œæ€»ç»“ã€‚å½“ç„¶ï¼Œçº¯å±ä¸ªäººçœ‹æ³•ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åˆ°æ–°å…¬å¸æ¥è¿‘ 2 ä¸ªæœˆäº†ï¼ˆ4.29-7.07ï¼‰ï¼Œè¿™ä¸¤ä¸ªæœˆé‡Œä¹Ÿè®¸æ˜¯æˆ‘æ¯•ä¸šä¸€å¹´æ€è€ƒæœ€å¤šçš„ä¸¤ä¸ªæœˆï¼Œçš„ç¡®æ˜¯æœ‰å¿…è¦è¿›è¡Œæ€»ç»“ã€‚å½“ç„¶ï¼Œçº¯å±ä¸ªäººçœ‹æ³•ã€‚</p>
<!-- more -->
<h2 id="ç»„ç»‡ç»“æ„">ç»„ç»‡ç»“æ„</h2>
<h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>
<p>æˆ‘æ‰€åœ¨çš„äº‹ä¸šéƒ¨æˆç«‹äºå»å¹´å…«æœˆï¼Œå±äºå‰å°äº‹ä¸šéƒ¨ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œåˆ›ä¸šéƒ¨é—¨â€ï¼Œæå°‘åŒäº‹æŠ½è°ƒäºå…¶ä»–å›¢é˜Ÿï¼Œå¤§éƒ¨åˆ†ä¸ºæ–°äººï¼Œæœ€é•¿ä»»èŒæ—¶é—´ä¸åˆ°ä¸€å¹´ï¼ˆæ­¤å¤„åªè°ˆæŠ€æœ¯ç›¸å…³ï¼‰ï¼Œä»¥ä¸‹â€œä¸šåŠ¡å›¢é˜Ÿâ€å­—æ ·æŒ‡ä»£æˆ‘æ‰€åœ¨çš„éƒ¨é—¨ï¼Œå› ä¸ºæˆ‘å¹¶ä¸äº†è§£å…¶ä»–éƒ¨é—¨ã€‚</p>
<p>éƒ¨é—¨è€å¤§ä¹Ÿå°±æ˜¯æŠ€æœ¯è€å¤§ï¼Œä¸‹é¢æœ‰è‹¥å¹²å‰ç«¯ä¸åç«¯åˆ’åˆ†åœ¨ä¸åŒçš„é¡¹ç›®ï¼Œä½†æ²¡æœ‰åä¹‰ä¸Šçš„å‰ç«¯è´Ÿè´£äººä¸åç«¯è´Ÿè´£äººï¼Œå³ä½¿èŒç§°ä¸ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸€çº¿å¼€å‘ã€‚</p>
<p>å…¬å¸å†…éƒ¨æ˜¯æœ‰å‰ç«¯æ¶æ„å›¢é˜Ÿçš„ï¼Œæä¾›ä¸€äº›åŸºç¡€ç±»åº“ä»¥åŠç›¸å…³æœåŠ¡ï¼Œè­¬å¦‚ jssdkã€åŸ‹ç‚¹ã€è„šæ‰‹æ¶ä»¥åŠå‘å¸ƒå·¥å…·ã€‚</p>
<h3 id="é—®é¢˜">é—®é¢˜</h3>
<p>è¿™æ ·çš„ç»„ç»‡æ¶æ„ä¸å°‘è§ï¼Œä¸Šå®¶å…¬å¸ä¹Ÿæ˜¯åŸºæœ¬å¦‚æ­¤ï¼Œä½†å­˜åœ¨ 2 ç‚¹å·®å¼‚ï¼š</p>
<ol>
<li>å¾—ç›Šäºè€ä¸œå®¶è§„æ¨¡ä»¥åŠä¸šåŠ¡ç±»å‹ï¼Œæ¶æ„ç»„èƒ½å¤Ÿè¾ƒä¸ºå®¹æ˜“çš„æ¨è¡Œå†…éƒ¨å·¥å…·ï¼›</li>
<li>ä¸šåŠ¡çº¿å‰åç«¯æ˜¯æœ‰è´Ÿè´£äººåœ¨çš„ï¼Œå¯ä»¥ç†è§£ä¸ºå°ç»„é•¿ï¼Œæœ‰ä¸€å®šçš„è¯è¯­æƒã€‚</li>
</ol>
<p>è¿™ 2 ç‚¹å·®å¼‚å¯¼è‡´äº† 3 ç‚¹é—®é¢˜ï¼š</p>
<ol>
<li>é€‰å‹ä¸ç»Ÿä¸€ï¼Œå·²æœ‰é¡¹ç›®ç»éªŒéš¾å¤ç”¨ã€‚å…¬å¸è§„æ¨¡å¤§ï¼Œæ¶æ„ç»„å¯¹ä¸šåŠ¡å›¢é˜ŸåŸºæœ¬æ²¡æœ‰çº¦æŸåŠ›ï¼Œå¯¼è‡´ä¸šåŠ¡å›¢é˜Ÿé™¤äº†ä¸€äº›å…¬å…±åŸºç¡€æœåŠ¡å¿…é¡»ä½¿ç”¨å†…éƒ¨å·¥å…·ï¼Œå…¶ä»–æŠ€æœ¯é€‰å‹å–å†³äºå…·ä½“é¡¹ç›®çš„ç¬¬ä¸€ä¸ªå¼€å‘è€…ï¼ˆå¤§éƒ¨åˆ†æ—¶å€™ä¸€è¨€éš¾å°½ï¼‰ï¼Œæ¢ä¸€ä¸ªé¡¹ç›®å¯èƒ½è¦èŠ±ä¸€ç‚¹æ—¶é—´é€‚åº”ä¸€ä¸‹ï¼Œbackup å›°éš¾ï¼›</li>
<li>ç¼ºå°‘è§„èŒƒï¼Œåä½œå›°éš¾ã€‚é¡¹ç›®å†…æ²¡æœ‰ä»£ç è§„èŒƒï¼Œeslint å­˜åœ¨æ„Ÿæä½ï¼Œç¼©è¿›ã€ç©ºæ ¼æ··ä¹±ä¸”æ²¡æœ‰<code>precommit lint</code>ã€‚è¯´æœæ‰€æœ‰äººå¾ˆéš¾ï¼Œè€Œåä½œæ˜¯å¯èƒ½ä¸æ‰€æœ‰äººå‘ç”Ÿçš„ã€‚ï¼ˆâ€œæ¯ä¸ªäººé£æ ¼ä¸ä¸€æ ·ï¼Œå¾ˆéš¾ç»Ÿä¸€çš„â€ï¼Œæˆ‘çœŸçš„å¾ˆè®¨åŒè¿™å¥è¯ï¼Œé‚£è¦å›¢é˜Ÿåšä»€ä¹ˆï¼Ÿè§„èŒƒå°±æ˜¯è®© <code>1+1&gt;2</code> çš„ï¼‰ã€‚</li>
<li>ä¸€äº›å¥½çš„å®è·µéš¾ä»¥æ¨åŠ¨ã€‚æƒ³æ¨ typescriptï¼Ÿçœ‹ä½ æœ‰æ²¡æœ‰æœºä¼šæˆä¸ºæŸä¸€ä¸ªæ–°é¡¹ç›®çš„ç¬¬ä¸€ä¸ªå¼€å‘è€…å§ï¼Œå¹¶ä¸”è¯´æœä¸ä½ åä½œçš„åŒäº‹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</li>
</ol>
<h3 id="æ€è€ƒ">æ€è€ƒ</h3>
<p>å¯èƒ½ç»„ç»‡ç»“æ„é—´æ¥å¯¼è‡´äº†ä¸‹é¢æˆ‘è¦è°ˆçš„å¾ˆå¤šé—®é¢˜å§ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘èµ„å†å°šæµ…ï¼Œå¯èƒ½æœ‰æ›´æ·±çš„è€ƒé‡æ˜¯æˆ‘æ‰€ä¸çŸ¥æ™“çš„ã€‚å¯èƒ½æˆ‘æ‰€åœ¨çš„éƒ¨é—¨å°±æ˜¯ä¸è¿½æ±‚è¿™äº›ä¸œè¥¿ï¼ŒæŠ“ç´§æ—¶é—´å®Œæˆéœ€æ±‚å°±å¥½äº†ï¼Œè¿™äº›å¹¶ä¸é‡è¦ï¼Œå…¶ä»–éƒ¨é—¨å¹¶ä¸å­˜åœ¨è¿™äº›é—®é¢˜ï¼ˆæ„Ÿè§‰å¯èƒ½æ€§ä¸å¤§ï¼‰ï¼Œä½†æ˜¯éƒ¨é—¨è€å¤§ç»å¸¸å¼ºè°ƒè´¨é‡ï¼Œæˆ‘è®¤ä¸ºè¿˜æ˜¯è½åœ°æ–¹é¢æœ‰äº›é—®é¢˜ã€‚</p>
<h2 id="ç»„ä»¶åº“">ç»„ä»¶åº“</h2>
<h3 id="ç°çŠ¶">ç°çŠ¶</h3>
<p>æ²¡æœ‰ç»Ÿä¸€ç»„ä»¶åº“ï¼Œå…·ä½“é—®é¢˜è¡¨ç°åœ¨ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>æ•°é‡ï¼šå¯å¤ç”¨ç»„ä»¶å°‘ï¼Œç»å¸¸éœ€è¦é€ è½®å­ï¼Œå¹¶ä¸”é€ å®Œæ²¡æœ‰æŠ½å‡ºæ¥ä»¥ä¾›å…¶ä»–é¡¹ç›®å¤ç”¨ï¼›</li>
<li>æ–‡æ¡£ï¼šæ–‡æ¡£ç¼ºå¤±ï¼Œæ›´æ¢å¼€å‘è€…å¤§æ¦‚ç‡éœ€è¦æ‘¸ççœ‹æºç ï¼Œè€Œä¸”å¾ˆå¯èƒ½ A é¡¹ç›®å·²ç»å­˜åœ¨äº†è§£å†³æ–¹æ¡ˆï¼ŒB é¡¹ç›®çš„å¼€å‘è€…å¹¶ä¸çŸ¥é“ï¼ˆæˆ–è€…çŸ¥é“äº†å´æ ¹æœ¬æ— ä»ä¸‹æ‰‹æ‹·è´ï¼‰ï¼Œé‡å¤é€ è½®å­ï¼›</li>
<li>ç»´æŠ¤ï¼š1 ä¸­çš„è½®å­å¤ç”¨ä¾é å¤åˆ¶ç²˜è´´ï¼Œå¯ç»´æŠ¤æ€§å·®ï¼Œå‡ºç°é—®é¢˜å¤šæ–¹åŒæ­¥ä¿®æ”¹ã€‚</li>
</ol>
<p>å¯å¤ç”¨ç»„ä»¶ç±»å‹ï¼š</p>
<ul>
<li>UI ç»„ä»¶ï¼šè­¬å¦‚å¼¹å±‚ï¼ˆPopupï¼‰ã€è½»æç¤º(Toast)ä»¥åŠè¾“å…¥æ¡†ï¼ˆInputï¼‰ç­‰ç»„ä»¶ï¼ˆå¾€å¾€è¿˜å­˜åœ¨ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼‰ï¼›</li>
<li>ä¸šåŠ¡ç»„ä»¶ï¼šç›¸åŒä¸šåŠ¡ç±»å‹å¯å¤ç”¨çš„ç»„ä»¶ï¼Œè­¬å¦‚æŠ½å¥–è½¬ç›˜ç»„ä»¶ï¼›</li>
<li>é€»è¾‘ç»„ä»¶ï¼šè­¬å¦‚ä¼ é€é—¨ï¼ˆPortalï¼‰ã€åˆ‡æ¢å™¨ï¼ˆTogglerï¼‰ä»¥åŠæ ¡éªŒå™¨ï¼ˆValidatorï¼‰ç­‰å¯ä»¥ç”¨æ¥ä¼˜åŒ–ä»£ç ç»“æ„å¹¶å‡å°‘é‡å¤ä»£ç ç­‰æ— å½¢æ€ç»„ä»¶ã€‚</li>
</ul>
<h3 id="æ€è€ƒ-2">æ€è€ƒ</h3>
<p>æ´»åŠ¨é¡µå›ºç„¶åƒå¥‡ç™¾æ€ªï¼Œä½†æ€»æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œå¦‚ä½•ä¸ä¸šåŠ¡ç»“åˆï¼Œåˆ†ç¦»å¯å˜ä¸ä¸å¯å˜ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œæ­£æ˜¯å·¥ç¨‹å¸ˆå­˜åœ¨çš„æ„ä¹‰ï¼ˆå½“ç„¶ä¹Ÿéœ€è¦äº§å“ã€ä¸šåŠ¡æŠ½è±¡ã€‘ä»¥åŠè®¾è®¡ã€ui è§„èŒƒã€‘åŒå­¦çš„å…±åŒå‚ä¸ï¼‰ã€‚</p>
<p>å¦‚æœä¸åŒé¡¹ç›®è®¾è®¡é£æ ¼å®åœ¨å·®å¼‚è¾ƒå¤§ï¼Œä¹Ÿèƒ½å¤Ÿé€šè¿‡æ”¹æ”¹æ ·å¼å¤ç”¨ï¼Œè€Œéé‡å†™ä¸€éé€»è¾‘ä»¥åŠå…¼å®¹æ€§å¤„ç†ã€‚</p>
<p>æ—¢è¦æœ‰é€ è½®å­çš„èƒ½åŠ›ï¼ˆä¸ªäººï¼‰ï¼Œä¹Ÿè¦æœ‰ä¸é€ è½®å­çš„è§‰æ‚Ÿï¼ˆå›¢é˜Ÿï¼‰ã€‚</p>
<p>ç”»å¤–éŸ³åæ§½ï¼šä¸ºä»€ä¹ˆæŠŠä¸€ä¸ªç»„ä»¶æ–‡ä»¶å¤¹åœ¨ä¸åŒé¡¹ç›®ä¸­æ‹·æ¥æ‹·å»ï¼Ÿæ–‡æ¡£ä¹Ÿæ²¡æœ‰ï¼Œæˆ‘æ€ä¹ˆç”¨ï¼Œä»£ç è´¨é‡å°±ä¸è¯´äº†ï¼Œæ²¡çœ¼çœ‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªäººç”¨çš„ä¸€æ¬¡æ€§ä»£ç ã€‚</p>
<h3 id="è¡ŒåŠ¨">è¡ŒåŠ¨</h3>
<p>å†™äº†ä¸ª dora-uiï¼Œç›®å‰æœ‰ä»¥ä¸‹ç»„ä»¶ï¼š</p>
<ul>
<li>Countdown å€’è®¡æ—¶</li>
<li>Popup å¼¹å±‚</li>
<li>Portal ä¼ é€é—¨</li>
<li>Toast è½»æç¤º</li>
<li>Toggler åˆ‡æ¢å™¨</li>
</ul>
<p>æ„Ÿè§‰å¯ä»¥ç›´æ¥ä½¿ç”¨å¼€æºçš„ç»„ä»¶åº“ï¼Œä¸ºä»€ä¹ˆè¦è‡ªå·±å†™å‘¢ï¼Ÿ</p>
<ul>
<li>åæ­£æ²¡å•¥äººç”¨......(æ‰å¿ƒäº†è€é“</li>
<li>åç»­ä¼šä»¥ä¸šåŠ¡ç»„ä»¶ä¸ºä¸»</li>
<li>ä¹Ÿå­˜åœ¨ä¸€ç‚¹ç§å¿ƒå§ï¼Œé”»ç‚¼è‡ªå·±ï¼Œåæ­£ä¹Ÿæ”¯æŒæŒ‰éœ€åŠ è½½ï¼Œæƒ³å’Œå•¥ä¸€èµ·ç”¨å°±å’Œå•¥ä¸€èµ·ç”¨</li>
<li>æˆ‘ä¼šç”¨å¿ƒå†™å¥½æ–‡æ¡£å’Œå•å…ƒæµ‹è¯•çš„</li>
</ul>
<h2 id="è„šæ‰‹æ¶æ¨¡æ¿">è„šæ‰‹æ¶ï¼ˆæ¨¡æ¿ï¼‰</h2>
<h3 id="ç°çŠ¶-2">ç°çŠ¶</h3>
<p>ç›®å‰å›¢é˜Ÿå†…æ–°å»ºé¡¹ç›®éƒ½æ˜¯ç”¨ CRA æˆ–è€… DVAï¼ˆä¸ºå•¥ä¸ç”¨ Umiï¼‰æ”¹ä¸€æ”¹ï¼Œæˆ‘è¿˜æ²¡æœ‰æœºä¼šè‡ªå·±å»æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œä½†æˆ‘è§‰ç€è¿™ä¹Ÿå¤ªéº»çƒ¦äº†å§ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸ç”¨å…¬å¸å†…éƒ¨çš„è„šæ‰‹æ¶ï¼ˆæ¡†æ¶ï¼‰ï¼Ÿæˆ‘ä¹Ÿä¸æƒ³çœ‹ç€äº”èŠ±å…«é—¨çš„é¡¹ç›®ç»“æ„å‘€ã€‚</p>
<ul>
<li>æˆ‘è§‰å¾—å¯ä»¥ç”¨ï¼Œä½†æ˜¯å›¢é˜Ÿå†…éƒ¨æ²¡å•¥äººç”¨ï¼Œæ¶æ„ç»„ä¸å¼ºæ¨ï¼Œä¹Ÿæ²¡æœ‰å‰ç«¯è´Ÿè´£äººï¼ˆè¯è¯­æƒï¼‰...å¾ˆéš¾æ¨å‘€ï¼›</li>
<li>æ—§ç‰ˆæœ¬çš„ Bugã€‚æ¥çš„ä¸€ä¸ªæ—§é¡¹ç›®æ˜¯ç”¨å†…éƒ¨è„šæ‰‹æ¶æ—§ç‰ˆæœ¬æ­çš„ï¼Œå¤ªå¤šå‘äº†ï¼Œåªèƒ½è¯´å‹‰å¼ºèƒ½ç”¨ï¼Œå›¢é˜Ÿå…¶ä»–äººå“æ€•äº†ï¼Œä¸è¿‡ç°åœ¨éƒ½ä¿®å¥½äº†ï¼›</li>
<li>å…¬å¸å†…éƒ¨çš„æ¡†æ¶åŸºæœ¬ä¸Šéƒ½é›†æˆäº†æˆ‘ä¸Šé¢æ‰€è¯´çš„å†…å®¹ã€‚ä½†æ¡†æ¶å®šä½æ˜¯åŒæ„æ¸²æŸ“ï¼Œæˆ‘ä»¬å›¢é˜ŸåŸºæœ¬æ˜¯çº¯å‰ç«¯é¡¹ç›®ï¼Œå¼•å…¥çš„å¾ˆå¤šæ¦‚å¿µæ¦‚å¿µé…ç½®å¢åŠ äº†å¿ƒæ™ºè´Ÿæ‹…ã€‚å»ºè®®æŠŠæ–‡æ¡£åˆ†å¼€ï¼Œç»™ä¸€ä¸ªçº¯å‰ç«¯é¡¹ç›®çš„æœ€å°çŸ¥è¯†é›†å°±å¥½ï¼›</li>
</ul>
<p>ç”¨ DVA æ­å»ºé¡¹ç›®å…¶å®è¿˜å¥½ï¼Œæœ¬æ¥å°±æ˜¯æœ€ä½³å®è·µäº†ï¼Œåªéœ€è¦è‡ªå·±é…äº›ç¯å¢ƒå˜é‡æ§åˆ¶ä¸‹<code>publicPath</code>ä»¥åŠå¢åŠ <code>precommit lint</code>å°±å¥½ï¼Œä½†æ˜¯ç”¨<code>CRA</code>å°±å¾ˆéº»çƒ¦äº†ï¼Œè¦è‡ªå·±æ”¹å¾ˆå¤šå†…å®¹ã€‚</p>
<h3 id="é—®é¢˜-2">é—®é¢˜</h3>
<p>çœ‹é¡¹ç›®å†…éƒ¨æ¶å­ï¼ˆåŸºäº CRAï¼‰ï¼Œæœ€æƒ³åæ§½çš„æœ‰ 3 ç‚¹ï¼š</p>
<ul>
<li>ä»£ç é£æ ¼ã€‚å‰é¢è¯´è¿‡ã€‚</li>
<li>æ•°æ® Mockã€‚ä¸ºå•¥è¦åœ¨ src é‡Œé¢æ ¹æ®ç¯å¢ƒå˜é‡å¼•å…¥ mock æ–‡ä»¶ï¼Œè¿™ä¸æ˜¯å¼€å‘æ—¶ä¾èµ–å—ï¼Ÿ</li>
<li>æ¥å£è½¬å‘ Proxyã€‚å…¶å®è¿™ä¸ªä¸ç®—æ¶å­çš„é—®é¢˜ã€‚åŸºæœ¬æ‰€æœ‰çš„æ¶å­éƒ½å†…ç½® Proxy çš„ï¼Œä½†æ˜¯ä¸€äº›æ¥å£éœ€è¦æˆæƒè®¿é—®ï¼Œè¿™å°±éœ€è¦é‰´æƒï¼Œæˆ‘ä»¬åå°æœåŠ¡å¹¶æ²¡æœ‰æä¾›ç»™æˆ‘ä»¬å¼€å‘é‰´æƒçš„å½¢å¼ï¼Œç°åœ¨çš„è§£å†³æ–¹æ¡ˆæ¯”è¾ƒéº»çƒ¦ï¼šæ¯”å¦‚æµ‹è¯•ç¯å¢ƒåŸŸåä¸º<code>m.test.zzzzz.com</code>ï¼Œä½¿ç”¨<code>SwitchHosts</code>å°†æœ¬åœ° ip æ˜ å°„ä¸º<code>m.dev.zzzzz.com</code>ï¼Œå‰é¢<code>m.dev</code>å¯ä»¥è‡ªå®šä¹‰ï¼Œåé¢ä¿è¯ä¸€è‡´ï¼Œç„¶åå» test ç¯å¢ƒç™»å½•ï¼Œè¿™æ ·å°±ç»™æµè§ˆå™¨æ³¨å…¥ cookie äº†ï¼Œç„¶åæˆ‘ä»¬ Proxy è½¬å‘å°±èƒ½å¸¦ç€ cookie è½¬å‘äº†ã€‚å¯æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå†…ç½‘ ip ä¼šå˜åŒ–ï¼ŒæŠŠç”µè„‘å¸¦å›å®¶å†å¸¦åˆ°å…¬å¸ï¼Œå°±è¦é‡æ–°æ”¹ hostï¼Œä¸çŸ¥é“è¿˜æœ‰ä»€ä¹ˆå¥½æ–¹æ¡ˆè§£å†³ï¼Œæ„Ÿè§‰åç«¯æ”¯æŒæ‰æ˜¯ç‹é“ï¼Œä¹Ÿæåˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æ¨ä¸åŠ¨ã€‚</li>
</ul>
<h3 id="æ€è€ƒ-3">æ€è€ƒ</h3>
<p>æˆ‘è§‰å¾—å›¢é˜Ÿå†…éƒ¨åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼Œæ¨¡æ¿å¿…é¡»é›†æˆä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>eslint/editorconfigï¼ˆå¿…é¡»ï¼‰</li>
<li>precommit lintï¼ˆå¿…é¡»ï¼‰</li>
<li>mockï¼ˆå¿…é¡»ï¼‰</li>
<li>proxyï¼ˆå¿…é¡»ï¼‰</li>
<li>è‡ªå®šä¹‰ webpack é…ç½®ï¼ˆå¿…é¡»ï¼‰</li>
<li>é›†æˆ reduxï¼ˆå¯é€‰ï¼‰</li>
<li>commitlintï¼ˆå¯é€‰ï¼‰</li>
<li>typescriptï¼ˆå¯é€‰ï¼‰</li>
</ul>
<p>å½“ç„¶æœ‰å¾ˆå¤šåŒå­¦å¯èƒ½ä¼šè¯´é€‰å‹å¾ˆå¤šæ—¶å€™è¦è€ƒè™‘å›¢é˜Ÿæˆå‘˜çš„èƒ½åŠ›ã€‚</p>
<p>ä½†æ˜¯èƒ½åŠ›æ˜¯æœ‰åŠæ ¼çº¿çš„å‘€ï¼èƒ½è¢«å·¥ä¸šåŒ–å¤§è§„æ¨¡ä½¿ç”¨çš„å·¥å…·ä¼šå¾ˆéš¾å—ï¼Ÿè¿™ä¸ªå¤ªé‡é‚£ä¸ªå¤ªå¤æ‚ï¼Œåˆä¸æ˜¯å¼•å…¥<code>angular</code> or <code>rxjs</code>ï¼Œç”¨æŸä½å¤§ä½¬çš„è¯å°±æ˜¯â€œä½ è„‘è¢‹åªæœ‰å‡  kb å—ï¼Ÿâ€ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦é€‰æ‹©<code>redux-thunk</code>ï¼Œæ˜¯<code>dva</code>ä¸å¥½çœ‹è¿˜æ˜¯<code>rematch</code>ä¸å¥½å¬ï¼Ÿ</p>
<p>å¯èƒ½ä»…ä»…æ˜¯å› ä¸ºç¬¬ä¸€ä¸ªåˆå§‹åŒ–é¡¹ç›®çš„äººåªçŸ¥é“<code>redux-thunk</code>ç½¢äº†ï¼ˆå½“ç„¶å¦‚æœåªæ˜¯ä¸€ä¸ªäººå¼€å‘ï¼Œéšä¾¿æ€ä¹ˆç©ï¼‰ï¼Œä½†å¦‚æœæ˜¯åä½œé¡¹ç›®ï¼Œå»ºè®®ç”±ä¸€ä¸ªçœŸæ­£æ·±å…¥è¿‡æ€è€ƒçš„äººå»è¿›è¡ŒæŠ€æœ¯é€‰å‹ï¼‰ã€‚</p>
<p>æ‰€ä»¥è¯´è„šæ‰‹æ¶å¾ˆé‡è¦ï¼Œä½†æ˜¯ emmm...æ¶æ„ç»„çš„è„šæ‰‹æ¶å¯èƒ½ä¸é€‚åˆæ‰€æœ‰ä¸šåŠ¡åœºæ™¯ï¼ˆä»¥åŠçº¦æŸåŠ›å› ç´ ï¼‰ï¼Œå›¢é˜Ÿå†…éƒ¨ emmm...å¤§æ¦‚ç‡æ¨ä¸åŠ¨ï¼ˆæˆ‘æ­£åœ¨å†™ï¼‰ï¼Œè¯´èµ·æ¥éƒ½æ˜¯æ³ªã€‚</p>
<h3 id="è¡ŒåŠ¨-2">è¡ŒåŠ¨</h3>
<p>æ­£åœ¨å†™ä¸€ä¸ªé€‚åˆå›¢é˜Ÿå†…éƒ¨ä½¿ç”¨çš„è„šæ‰‹æ¶ï¼Œä¼šé›†æˆä¸Šè¿°å†…å®¹ã€‚</p>
<p>å°¤å…¶æ˜¯é¢„ç½®ä»£ç è§„èŒƒä»¥åŠé£æ ¼ï¼Œä½†æ˜¯è¢«å…³æ‰æˆ–è€…ä¿®æ”¹å°±æ²¡åŠæ³•äº†å‘€ï¼Œæœ‰äº›åŒäº‹å°±æ˜¯ä¸å–œæ¬¢ç”¨æ’ä»¶æ ¼å¼åŒ–ä»£ç ï¼Œè‡ªå·±å†™çš„åˆè¾¾ä¸åˆ°ä»£ç æ ‡å‡†ï¼ŒçœŸçš„å¥½éš¾ã€‚</p>
<h2 id="å‰åç«¯åˆ†ç¦»">å‰åç«¯åˆ†ç¦»</h2>
<p>æƒŠä¸æƒŠå–œï¼Œæ„ä¸æ„å¤–ã€‚</p>
<h3 id="ç°çŠ¶-3">ç°çŠ¶</h3>
<p>å‰ç«¯é¡¹ç›®å¦‚æœåˆæ¬¡å‘å¸ƒï¼Œéœ€è¦æŠŠ<code>index.html</code>æ‰˜ç®¡åˆ°åç«¯é‚£é‡Œï¼Œæˆ‘ä»¬è™½ç„¶æŠŠ html/js/css éƒ½ä¸Šä¼ åˆ°äº†é™æ€èµ„æºæœåŠ¡å™¨ï¼Œä½† html ç”¨çš„æ˜¯åç«¯æ‰˜ç®¡çš„ï¼Œæ‰“åŒ…å‡ºæ¥çš„å†…å®¹ä¸èƒ½æœ‰ hashï¼Œå¦‚æœèµ„æºåœ°å€å˜åŒ–ï¼Œéœ€è¦åç«¯é…åˆä¿®æ”¹ htmlï¼Œæ¯æ¬¡ä¸Šçº¿è¦åç«¯åˆ·ç‰ˆæœ¬å·ï¼ˆå°±æ˜¯åŠ ä¸ªæ—¶é—´æˆ³ï¼‰ï¼Œé¿å…è¯·æ±‚åˆ°äº†ç¼“å­˜çš„ htmlã€‚</p>
<p>æ›´å¤šåˆ†æå¯ä»¥çœ‹æˆ‘å¦å¤–ä¸€ç¯‡æ–‡ç« â€”â€”å…³äºå‰ç«¯é¡¹ç›®éƒ¨ç½²å‘å¸ƒçš„ç›¸å…³æ€è€ƒã€‚</p>
<h3 id="æ€è€ƒ-4">æ€è€ƒ</h3>
<p>Nginx é…ç½®ä»£ç†åº”å½“æ˜¯æœ€ä¼˜çš„ï¼Œä¸ç„¶æ›´æ”¹æ‰“åŒ…ç­–ç•¥è¿˜éœ€è¦åç«¯é…åˆï¼Œç€å®æ— å¥ˆï¼Œå¯èƒ½çš„åŸå› å°±æ˜¯é…ç½® Nginx éœ€è¦æ‰¾äººæ‰¾äººæ‰¾äººï¼Œä½†æ˜¯åç«¯ä¸Šçº¿éš¾é“å°±ä¸æ‰¾äººäº†å—ï¼Œè¿™é‡Œä¸æ˜¯å¾ˆç†è§£ï¼Œå¬è¯´æœ‰åœ¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½è¿™ç§æ“ä½œèƒŒåæœ‰ä»€ä¹ˆå†å²åŸå› å§ï¼Œä½†æ”¾åˆ°ä»Šå¤©ï¼Œå®åœ¨æ˜¯å¾ˆéš¾æ¥å—ã€‚</p>
<p>æ˜¨å¤©åœ¨æ–°ç”ŸæŠ€æœ¯åŸ¹è®­ä¸Šå‘å‰ç«¯è€å¤§æäº†è¿™ä¸ªé—®é¢˜ï¼Œå¬è¯´æ¶æ„ç»„æ˜¯æœ‰è§„åˆ’è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œåé¢å†çœ‹å§ã€‚</p>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<h3 id="å…³äºä¸Šçº¿æµç¨‹">å…³äºä¸Šçº¿æµç¨‹</h3>
<p>ç›®å‰æ˜¯æ²¡æœ‰ä¸Šçº¿æµç¨‹çš„ï¼Œå¯¹ï¼Œæ²¡æœ‰ï¼</p>
<ul>
<li>å¼€å‘å®Œåä¸€å—“å­ä¸Šçº¿ï¼Œæœ‰äº›éœ€æ±‚å°‘çš„ã€å…³è”æ€§ä¸å¼ºçš„å¼€å‘äººå‘˜éƒ½ä¸çŸ¥é“å•¥æ—¶å€™ä¸Šçº¿ï¼Œä¸Šçº¿çš„æ—¶å€™äººä¸åœ¨ç»“æœæ²¡å‘ï¼›</li>
<li>å¯¹çº¿ä¸Šå‘å¸ƒæ²¡æœ‰æ•¬ç•ä¹‹å¿ƒï¼Œä¸€å¤©å¯ä»¥å‘å‡ æ¬¡ã€‚</li>
</ul>
<p>ä¸Šå‘¨å¼€äº†ä¸ªä¼šæƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸Œæœ›èƒ½è½åœ°ã€‚</p>
<p>æ— éå°±æ˜¯å›ºå®šä¸Šçº¿æ—¥æœŸä»¥åŠå‘å¸ƒæ¬¡æ•°ï¼Œé€šè¿‡é‚®ä»¶ä»¥åŠæ–‡æ¡£ç­‰è¿›è¡Œéœ€æ±‚ç”Ÿå‘½å‘¨æœŸè·Ÿè¸ªã€‚</p>
<pre><code>éœ€æ±‚ =&gt; è§†è§‰ =&gt; å¼€å‘ =&gt; æµ‹è¯• =&gt; é¢„å‘ =&gt; æ­£å¼ä¸Šçº¿ã€‚
</code></pre>
<p>ä¸è¿‡ä¸Šçº¿æµç¨‹åœ¨æˆ‘çœ‹æ¥åº”è¯¥æ˜¯å…¬å¸ç»Ÿä¸€çš„å§ï¼Œä¸ç„¶æ–°å›¢é˜Ÿè¿˜è¦é‡æ–°å»ºç«‹è¿™äº›æµç¨‹è§„èŒƒï¼Œä¸€ä¸å°å¿ƒå°±èµ°åäº†ï¼Œæ‚è„¸å“­ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯å…¬å¸å†…éƒ¨æ²¡æœ‰ä½¿ç”¨é‚®ä»¶çš„ä¹ æƒ¯ï¼Œè§ä»è§æ™ºå§ï¼Œæˆ‘è§‰å¾—æ¯”è¾ƒç¥å¥‡ã€‚</p>
<h3 id="å…³äºæµ‹è¯•ç¯å¢ƒ">å…³äºæµ‹è¯•ç¯å¢ƒ</h3>
<p>æˆ‘ä»æœªè§è¿‡å¦‚æ­¤ä¸ç¨³å®šçš„æµ‹è¯•ç¯å¢ƒã€‚</p>
<h3 id="å…³äºä»£ç é‡æ„">å…³äºä»£ç é‡æ„</h3>
<p>éšç€é¡¹ç›®è¿­ä»£ï¼Œæ²¡æœ‰æ„ä¹‰çš„ä»£ç è¦åŠæ—¶åˆ é™¤æˆ–æ³¨é‡Šï¼Œå¦åˆ™å‡ ç»è½¬æ‰‹ï¼Œæ²¡æœ‰äººçŸ¥é“è¿™äº›ä»£ç åˆ°åº•æœ‰æ²¡æœ‰ç”¨ï¼Œåè€Œè¿˜è¦åœ¨è¿™äº›ç»“æ„ä¸Šè¿›è¡Œæ–°éœ€æ±‚è¿­ä»£ï¼Œåªä¼šè¶Šæ¥è¶Šä¹±ï¼Œå¼€å‘äººå‘˜è¦æœ‰åŠæ—¶æç²ªå‘çš„å†³å¿ƒä¸å‹‡æ°”ï¼ˆå †æˆå±å±±å°±å®Œäº†- -!!ï¼‰ï¼Œæ¥è¿‡æ¥çš„é¡¹ç›®å¦‚æœå¯å¤ç”¨ç¨‹åº¦ä¸å¤§ï¼Œä¸å¦‚é‡åšï¼Œå½“å‰é¡¹ç›®æ¶æ„ä¸æ»¡è¶³æ–°éœ€æ±‚æ—¶ï¼Œåº”è€ƒè™‘åŠæ—¶æ‰©å±•ã€‚</p>
<h3 id="å…³äºäº§å“èŠ‚å¥">å…³äºäº§å“èŠ‚å¥</h3>
<p>äº§å“èŠ‚å¥å¾ˆè¿·ï¼Œä¸€ä¸ªéœ€æ±‚ææµ‹åä¼šæœ‰æ¥è¿‘ä¸¤å‘¨çš„ç©ºæ¡£ï¼Œæ‰€ä»¥å¾ˆæ„Ÿè°¢ç°åœ¨çš„é¡¹ç›®ï¼Œæ—¢è®©æˆ‘äº†è§£åˆ°äº†ä¸€ä¸ªé¡¹ç›®èƒ½æœ‰å¤šå‘ï¼Œåˆç»™æˆ‘äº†å¦‚æ­¤å¤šçš„æ—¶é—´å»å‘ç°é—®é¢˜ï¼Œä¿®å¤ç¼ºé™·ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬å…¬å¸åŸºæœ¬ä¸å’‹åŠ ç­ï¼Œä½†æ˜¯è¿™ä¸ªèŠ‚å¥ç€å®è®©æˆ‘æœ‰ç‚¹ä¸å¤ªå¥½æ„æ€ã€‚æŠ€æœ¯äººå‘˜å½“ç„¶éœ€è¦æ—¶é—´å»å¤ç›˜æ€»ç»“ï¼Œå­¦ä¹ æ–°çŸ¥è¯†ï¼Œä½†å›¢é˜Ÿå†…éƒ¨å…¶ä»–é¡¹ç›®è´¼å¿™ï¼Œå¯¹æ¯”èµ·æ¥å¥½æƒ­æ„§ã€‚</p>
<p>ä½†æ˜¯å¿ƒé‡Œé¢è¿˜æ˜¯æœ‰äº›è®¸åŠ¨æ‘‡ï¼Œè™½ç„¶è¯´æˆé•¿é è‡ªå·±ï¼ˆç°åœ¨æœ‰æ—¶é—´å»å­¦ä¹ æˆé•¿ï¼‰ï¼Œä½†æˆ‘è¿˜æ˜¯æƒ³æœ‰ä¸€ä¸ªæ›´ä¸ºä¼˜ç§€çš„å›¢é˜Ÿä»¥åŠå¹³å°ï¼Œèƒ½å¤Ÿå»è½åœ°ä¸€äº›äº‹æƒ…ã€‚è€Œç°åœ¨å›¢é˜Ÿå†…éƒ¨ï¼Œæœ‰æä¸ªåˆ«æˆå‘˜å³ä½¿æœ‰è®¸å¤šæ—¶é—´ï¼Œä½†ä¹Ÿä¸è§æœ‰ä½•äº§å‡ºï¼Œä¸€è¨€éš¾å°½ï¼Œè™½ç„¶æˆ‘ç°åœ¨æœ‰çƒ­æƒ…ï¼Œä½†æ˜¯æˆ‘å®³æ€•æœ‰ä¸€å¤©ä¹Ÿä¼šè¿™æ ·ï¼Œå¯èƒ½å°±æ˜¯è´±å§ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ä»¥ä¸Šå°±æ˜¯ä¸€äº›æ€è€ƒä»¥åŠåæ§½ï¼Œè¿™ä¸¤ä¸ªæœˆæˆé•¿çš„å¤ªå¤šå¤ªå¤šï¼Œåœ¨ä¸Šä¸€å®¶å…¬å¸å’Œä¸€ä¸ªäººè´Ÿè´£é¡¹ç›®ï¼Œæ¥è¿™è¾¹ä¸‰ä¸ªäººä¸€èµ·è´Ÿè´£ä¸€ä¸ªé¡¹ç›®ï¼ˆæ„Ÿè§‰æœ‰èµ„æºè¿‡å‰©ï¼‰ï¼Œé‡åˆ°äº†ç§ç§é—®é¢˜ï¼Œæœ‰çš„é—®é¢˜è§£å†³äº†ï¼Œæœ‰çš„é—®é¢˜äººè¨€å¾®è½»ï¼Œå½±å“ä¸å¤§ã€‚</p>
<p>ä¹Ÿæœ‰äº† 3 ç‚¹æ„Ÿæ‚Ÿï¼Œå“ˆå“ˆã€‚</p>
<ol>
<li>åŠæ³•æ€»æ¯”é—®é¢˜å¤šï¼›</li>
<li>æ˜¯é—®é¢˜è¿˜æ˜¯ç»©æ•ˆå–å†³äºè‡ªå·±ï¼›</li>
<li>æ°¸è¿œä¿æŒå¥½å¥‡å¿ƒã€‚</li>
</ol>
<p>ä¸€ç‰‡è’èŠœã€‚</p>
<p>ä½†å¤§æœ‰å¯ä¸ºã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç¼–å†™å¹²å‡€çš„ä»£ç ]]></title>
        <id>https://worldzhao.github.io/post/write-clean-code-in-react/</id>
        <link href="https://worldzhao.github.io/post/write-clean-code-in-react/">
        </link>
        <updated>2019-05-14T16:00:00.000Z</updated>
        <content type="html"><![CDATA[<h2 id="é¡¹ç›®åŸºç¡€é…ç½®">é¡¹ç›®åŸºç¡€é…ç½®</h2>
<p>å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œä¸€ä¸ªå¥½çš„é¡¹ç›®æ¶å­ï¼ˆç›®å½•ç»“æ„ä»¥åŠä»£ç é£æ ¼ï¼Œå³è§„èŒƒï¼‰å°±æ˜¯ä¸€å¥—æ•™ç¨‹ã€‚</p>
<p>è§„èŒƒæ˜¯ä¸ºäº†ä½¿å¾—å›¢é˜Ÿæˆå‘˜<strong>åä½œ</strong>æ›´ä¸ºè½»æ¾è€Œå­˜åœ¨çš„ï¼Œåº”å½“åœ¨ä¸ªäººä¹ æƒ¯ä»¥åŠå›¢é˜Ÿåä½œä¹‹é—´å–å¾—å¹³è¡¡ï¼Œæœ‰çº¢çº¿ã€ä¹Ÿæœ‰é‡‘çº¿ã€‚</p>
<p>ç»Ÿä¸€çš„è§„èŒƒä¹Ÿæ˜¯ä½¿å¾—å›¢é˜Ÿå‘æŒ¥å‡º <code>1 + 1 &gt; 2</code> èƒ½åŠ›çš„åŸºç¡€ã€‚</p>
<p>å¿…é¡»éµå¾ªä¸¤ä¸ªåŸºæœ¬åŸåˆ™ï¼š</p>
<ol>
<li>å°‘æ•°æœä»å¤šæ•°ï¼ˆåå•†è®¨è®ºï¼‰ï¼›</li>
<li>ç”¨å·¥å…·ç»Ÿä¸€é£æ ¼ï¼ˆlint å·¥å…·ï¼‰ã€‚</li>
</ol>
<p>å¸¸ç”¨å·¥å…·ï¼š</p>
<ul>
<li>eslint</li>
<li>editorconfig</li>
<li>husky[pre-commit]</li>
<li>vscode plugins</li>
<li>è´¯å½»æ‰§è¡Œ</li>
</ul>
<blockquote>
<p><a href="https://juejin.im/entry/5b911ff9e51d450e65482870">æ¨èé˜…è¯»-å¦‚ä½•ä¿éšœå‰ç«¯é¡¹ç›®çš„ä»£ç è´¨é‡-æ˜é‡‘</a></p>
</blockquote>
<h2 id="ä»£ç ç›¸å…³">ä»£ç ç›¸å…³</h2>
<blockquote>
<p>å…³é”®å­—ï¼šç®€å•ã€å¯è¯»ã€å¥½ç»´æŠ¤</p>
</blockquote>
<p>ä¸€åˆ‡ä¸ºäº†ç®€å•ã€å¯è¯»ï¼Œå¥½ç»´æŠ¤ã€‚</p>
<h3 id="ç­–ç•¥æ¨¡å¼">ç­–ç•¥æ¨¡å¼</h3>
<p>ä½¿ç”¨ç­–ç•¥æ¨¡å¼ä¼˜åŒ– if-elseï¼Œæ¢æ±¤(switch)ä¸æ¢è¯(if)ï¼Œç­–ç•¥(map)æ›´æœ‰æ•ˆ</p>
<pre><code class="language-js">// bad
const { channel } = this.state;
let chal = &quot;&quot;;
switch (channel) {
  case &quot;weixin&quot;:
    chal = 1;
    break;
  case &quot;weixinGroup&quot;:
    chal = 2;
    break;
  case &quot;qq&quot;:
    chal = 3;
    break;
  case &quot;qrCode&quot;:
    chal = 4;
    break;
}
</code></pre>
<pre><code class="language-js">// good
const { channel } = this.state;
const channelCodeMap = {
  weixin: 1,
  weixinGroup: 2,
  qq: 3,
  chal: 4,
};
const chal = channelCodeMap[channel] || &quot;&quot;;
</code></pre>
<p>æ­¤å¤„æ˜¯æ ¹æ® channel æ‹¿å–å¯¹åº” codeï¼Œå¦‚æœæ˜¯æ ¹æ®åç«¯ code æ˜¾ç¤ºæ–‡æ¡ˆåŒç†ï¼Œå¦‚æœæ˜¯æ ¹æ®åç«¯ code è¿›è¡Œä¸åŒæ“ä½œä¹Ÿæ˜¯åŒç†ï¼Œåªä¸è¿‡å°†é”®å€¼å¯¹çš„å€¼æ›´æ¢ä¸ºæˆ‘ä»¬æŠ½è±¡çš„æ–¹æ³•è€Œå·²ï¼Œå°†ä¸åŒç­–ç•¥æŠ½å–å‡ºå»ï¼Œç­–ç•¥å¯¹è±¡åªè´Ÿè´£é€‰å–ç­–ç•¥ï¼Œåˆ†ç¦»å¯å˜ä¸ä¸å¯å˜ï¼Œå³ä¸ºç­–ç•¥æ¨¡å¼ã€‚</p>
<p>æƒ³è¦æ·±å…¥æˆ³æ­¤å¤„ï¼š</p>
<blockquote>
<p><a href="https://juejin.im/post/5bdfef86e51d453bf8051bf8">æ¨èé˜…è¯»-JavaScript å¤æ‚åˆ¤æ–­çš„æ›´ä¼˜é›…å†™æ³•-æ˜é‡‘</a> &gt; <a href="https://worldzhao.github.io/2018/11/23/design-pattern-strategy/">æ¨èé˜…è¯»-è®¾è®¡æ¨¡å¼-ç­–ç•¥æ¨¡å¼-æˆ‘çš„åšå®¢</a></p>
</blockquote>
<h3 id="å®šä¹‰å¸¸é‡">å®šä¹‰å¸¸é‡</h3>
<p>å€˜è‹¥ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ˜¯ä¸€ä¸ªæ•°å­—åœ¨é¡¹ç›®ä¸­åå¤è¢«ä½¿ç”¨ï¼ˆå•ä¸ªæ–‡ä»¶é™¤å¤–ï¼‰ï¼Œå°±åº”å½“æŠ½ç¦»å‡ºé…ç½®æ–‡ä»¶ï¼Œè€Œéåœ¨ä¸šåŠ¡ä»£ç ä¸­å†™æ»¡æ„ä¹‰ä¸æ˜çš„ number ä¸ string</p>
<pre><code class="language-js">// bad
const { channel } = this.state;
const channelCodeMap = {
  weixin: 1,
  weixinGroup: 2,
  qq: 3,
  chal: 4,
};
const chal = channelCodeMap[channel] || &quot;&quot;;
</code></pre>
<pre><code class="language-js">// good
// constants.js
export const CHANNEL_CODES = {
  WEIXIN: 1,
  WEIXIN_GROUP: 2,
  QQ: 3,
  CHAL: 4,
};

// index.js
import { CHANNEL_CODES } from &quot;path2config/constants&quot;;
const { channel } = this.state;
const channelCodeMap = {
  weixin: CHANNEL_CODES.WEIXIN,
  weixinGroup: CHANNEL_CODES.WEIXIN_GROUP,
  qq: CHANNEL_CODES.WEIXIN_QQ,
  chal: CHANNEL_CODES.WEIXIN_CHAL,
};
const chal = channelCodeMap[channel] || &quot;&quot;;
</code></pre>
<h3 id="ä½¿ç”¨-asyncawait">ä½¿ç”¨ async/await</h3>
<p>é™¤å¼€æå…¶å¤æ‚çš„å¼‚æ­¥æµç¨‹ï¼ˆæå°‘æƒ…å†µï¼Œæˆ‘æ²¡ç¢°åˆ°è¿‡ï¼‰éœ€è¦ä½¿ç”¨ Promiseï¼Œç»å¤§å¤šæ•°æƒ…å†µ async/await å°±å¯ä»¥ hold ä½ï¼Œå¹¶ä¸”å°‘äº†æ‹¬å·åµŒå¥—ï¼Œå¯è¯»æ€§æä½³ã€‚</p>
<pre><code class="language-js">// bad
/* è·å–ç”¨æˆ·ä¿¡æ¯åè·å–ç”¨æˆ·æç°ä¿¡æ¯ */
getWithdrawInfo = () =&gt; {
  getUserInfo()
    .then((res) =&gt; {
      return getWithdrawInfo(res.userId);
    })
    .then((withdrawInfo) =&gt; {
      this.setState({
        withdrawInfo,
      });
    })
    .catch((err) =&gt; {
      console.log(err);
    });
};
</code></pre>
<pre><code class="language-js">// good
/* è·å–ç”¨æˆ·ä¿¡æ¯åè·å–ç”¨æˆ·æç°ä¿¡æ¯ */
getWithdrawInfo = async () =&gt; {
  const userInfo = await getUserInfo();
  const withdrawInfo = await getWithdrawInfo(userInfo.userId);
  this.setState({
    withdrawInfo,
  });
};
</code></pre>
<blockquote>
<p><a href="https://worldzhao.github.io/2019/01/23/pig/">æ¨èé˜…è¯»-ä» callback åˆ° async-æˆ‘çš„åšå®¢</a></p>
</blockquote>
<h3 id="å•ä¸€èŒè´£">å•ä¸€èŒè´£</h3>
<p>ä¸€ä¸ªæ–¹æ³•åšä¸€ä»¶äº‹ï¼Œç”Ÿå‘½å‘¨æœŸå‡½æ•°åŠ›æ±‚æ¸…æ™°ç®€å•ï¼Œå†…éƒ¨ä¸è¦æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œç®€å•è°ƒç”¨ä¸šåŠ¡æ–¹æ³•å³å¯ã€‚</p>
<p>bad patter å°±æ˜¯åœ¨ç”Ÿå‘½å‘¨æœŸå†…å†™ä¸€å¤§å †ä¸šåŠ¡é€»è¾‘ï¼Œçœ‹å¾—å¤´çš®å‘éº»ï¼Œæ­¤å¤„ä¸åšç¤ºä¾‹ã€‚</p>
<pre><code class="language-js">// good
componentDidMount() {
    // è·å–è´¦æˆ·ä¿¡æ¯
    this.getAccountInfo();
    // è·å–æç°é…ç½®ä¿¡æ¯
    this.getWithdrawConfig();
    // è·å–æ”¶å¬æ—¶é•¿
    this.getListenData();
}
</code></pre>
<h3 id="ç±»åæ‹¼æ¥">ç±»åæ‹¼æ¥</h3>
<p>ä½¿ç”¨ classnames åº“ï¼ˆå£°æ˜å¼ï¼‰æ‹¼æ¥å¤æ‚ç±»åï¼Œè€Œéå„ç§æ‹¼æ¥å­—ç¬¦ä¸²ï¼ˆè¿‡ç¨‹å¼ï¼‰ã€‚</p>
<pre><code class="language-js">// bad
// è¿™ä¸ªä¾‹å­å†™çš„å¤ªç´¯äº†ã€‚ã€‚ã€‚
const Button = (props) =&gt; {
  const { size, type, openPrefixCl, prefixCl } = props;
  let btnCls = &quot;test-btn&quot;;
  if (size === &quot;large&quot;) {
    btnCls += &quot; test-btn__large&quot;;
  } else if (size === &quot;medium&quot;) {
    btnCls += &quot; test-btn__medium&quot;;
  } else {
    btnCls += &quot; test-btn__small&quot;;
  }

  if (type === &quot;primary&quot;) {
    btnCls += &quot; test-btn__primary&quot;;
  } else if (type === &quot;warning&quot;) {
    btnCls += &quot; test-btn__warning&quot;;
  } else if (type === &quot;danger&quot;) {
    btnCls += &quot; test-btn__danger&quot;;
  } else {
    btnCls += &quot; test-btn__default&quot;;
  }

  if (openPrefixCl === 1) {
    // è¿™ä¸ªä¾‹å­æ”¾åœ¨è¿™é‡Œä¸åˆç† åªæ˜¯ä¸ºäº†è¯´æ˜classnamesçš„å¥½å¤„
    btnCls += ` ${prefixCl}`;
  }
  return &lt;button className={btnCls}&gt;ç‚¹æˆ‘&lt;/button&gt;;
};
</code></pre>
<pre><code class="language-js">// good
import cx from &quot;classnames&quot;;

const sizeClsMap = {
  small: &quot;test-btn__large&quot;,
  medium: &quot;test-btn__medium&quot;,
  large: &quot;test-btn__small&quot;,
};

const typeClsMap = {
  primary: &quot;test-btn__primary&quot;,
  warning: &quot;test-btn__warning&quot;,
  danger: &quot;test-btn__danger&quot;,
};

const Button = (props) =&gt; {
  const { size, type, openPrefixCl, prefixCl } = props;
  const sizeCl = sizeClsMap[size] || &quot;test-btn__medium&quot;;
  const typeCl = typeClsMap[type] || &quot;test-btn__default&quot;;
  const btnCls = cx({
    &quot;test-btn&quot;: true,
    [typeCl]: true,
    [sizeCl]: true,
    [prefixCl]: openPrefixCl === 1,
  });
  return &lt;button className={btnCls}&gt;ç‚¹æˆ‘&lt;/button&gt;;
};
</code></pre>
<h3 id="ä¼ªè®¡ç®—å±æ€§">ï¼ˆä¼ªï¼‰è®¡ç®—å±æ€§</h3>
<p>é€šè¿‡ get å…³é”®å­—ï¼ŒæŠ½ç¦»è®¡ç®—é€»è¾‘ï¼Œæ ¹æ® state ä¸ props è®¡ç®—å‡ºè¡ç”Ÿå€¼ã€‚</p>
<pre><code class="language-js">// ä½¿ç”¨ getters å°è£… render æ‰€éœ€è¦çš„çŠ¶æ€æˆ–æ¡ä»¶çš„ç»„åˆ
// å¯¹äºè¿”å› boolean çš„ getter ä½¿ç”¨ is- å‰ç¼€å‘½å

// bad
render() {
    const { age } = this.state;
    const { school } = this.props;
    return (
        &lt;&gt;
        {
           age &gt; 18 &amp;&amp; (school === 'A' || school === 'B')
            ? &lt;VipComponent /&gt;
            : &lt;NormalComponent /&gt;
        }
        &lt;/&gt;
    )
}
</code></pre>
<pre><code class="language-js">// good
get isVIP() {
    const { age } = this.state;
    const { school } = this.props;
    return age &gt; 18 &amp;&amp; (school === 'A' || school === 'B')
    }

render() {
    return (
        &lt;&gt;
        {this.isVIP ? &lt;VipComponent /&gt; : &lt;NormalComponent /&gt;}
        &lt;/&gt;
    )
}
</code></pre>
<p>ä¸ºä»€ä¹ˆæ˜¯ï¼ˆä¼ªï¼‰ï¼Œå› ä¸ºé€šè¿‡è¿™ç§æ•ˆæœæ¨¡æ‹Ÿå‡ºæ¥çš„è®¡ç®—å±æ€§å’Œ Vue æä¾›çš„è®¡ç®—å±æ€§æœ‰æœ¬è´¨åŒºåˆ«ã€‚</p>
<p>å¯¹äº Vue è®¡ç®—å±æ€§ï¼ŒVue å®˜æ–¹æ–‡æ¡£ä¸­å­˜åœ¨è§£é‡Šï¼šâ€æˆ‘ä»¬å¯ä»¥å°†åŒä¸€å‡½æ•°å®šä¹‰ä¸ºä¸€ä¸ªæ–¹æ³•è€Œä¸æ˜¯ä¸€ä¸ªè®¡ç®—å±æ€§ã€‚ä¸¤ç§æ–¹å¼çš„æœ€ç»ˆç»“æœç¡®å®æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚ç„¶è€Œï¼Œä¸åŒçš„æ˜¯è®¡ç®—å±æ€§æ˜¯åŸºäºå®ƒä»¬çš„ä¾èµ–è¿›è¡Œç¼“å­˜çš„ã€‚åªåœ¨ç›¸å…³ä¾èµ–å‘ç”Ÿæ”¹å˜æ—¶å®ƒä»¬æ‰ä¼šé‡æ–°æ±‚å€¼ã€‚â€</p>
<p>å‡ä½¿å­˜åœ¨ä¸¤ä¸ª state å±æ€§ A.Bï¼Œè®¡ç®—å±æ€§åªä¾èµ– Aï¼Œä¸ä¾èµ– Bã€‚å€˜è‹¥ B å˜åŒ–ï¼Œè®¡ç®—å±æ€§ä¸ä¼šé‡æ–°è®¡ç®—ã€‚</p>
<p>ä½†åœ¨ React ä¸­ï¼Œä¾æ—§ä¼šæ‰§è¡Œ renderï¼Œæ‰€ä»¥ get æ²¡æœ‰ç¼“å­˜ï¼Œåªæ˜¯ä¸ªè¯­æ³•ç³–ã€‚</p>
<blockquote>
<p><a href="https://worldzhao.github.io/2019/03/16/react-computed/">æ¨èé˜…è¯»-ä½¿ç”¨ get å…³é”®å­—ä¼˜é›…å¤„ç†è¡¨å•è”åŠ¨-æˆ‘çš„åšå®¢</a></p>
</blockquote>
<h3 id="é™ä½-jsx-å¤æ‚åº¦">é™ä½ jsx å¤æ‚åº¦</h3>
<p>render(jsx) æ–¹æ³•å¤æ‚åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œéœ€è¦åˆç†æ‹†åˆ†æˆä¸åŒå­ç»„ä»¶æˆ–å­æ–¹æ³•ï¼ˆå•ä¸€èŒè´£ï¼‰ã€‚</p>
<p>bad pattern ä¸ä½œå±•ç¤ºï¼Œæƒ³åƒä¸€ä¸ª 200 è¡Œçš„ render æ–¹æ³•å¹¶ä¸” jsx ä¸­å……æ–¥ç€å„ç§åˆ¤æ–­åˆ¤æ–­é€»è¾‘å³å¯ã€‚</p>
<p>ä»¥ä¸€ä¸ªæ¨¡æ€æ¡†ç»„ä»¶ä¸ºä¾‹ï¼Œæ¨¡æ€æ¡† Header ä»¥åŠ Footer åŸºæœ¬éƒ½æ˜¯å¯é…ç½®çš„ï¼Œä¼šå­˜åœ¨è®¸å¤šåˆ¤æ–­ï¼Œå°†å…¶æŠ½ç¦»åˆ†è€Œæ²»ä¹‹å¯ä»¥æ›´å¹²å‡€ã€‚</p>
<p>åªè¦åˆç†æŠ½è±¡æ–¹æ³•ï¼Œä»£ç åŸºæœ¬ä¸ä¼šæœ‰å¤ªå¤§é—®é¢˜ã€‚</p>
<pre><code class="language-js">renderModalHeader = () =&gt; {};

renderModalContent = () =&gt; {};

renderModalFooter = () =&gt; {};

render() {
    return (
      &lt;div className=&quot;test-modal--container&quot;&gt;
        {this.renderModalHeader()}
        {this.renderModalContent()}
        {this.renderModalFooter()}
      &lt;/div&gt;
    );
  }
</code></pre>
<h3 id="å…¶ä»–">å…¶ä»–</h3>
<ul>
<li>
<p>if åˆ¤æ–­è¯­å¥ä¸é€šè¿‡å°½æ—©è¿”å›ï¼Œé¿å…ä¸€å¤§å †é€»è¾‘åæ¥ä¸ª elseï¼Œå¾ˆå¤šæ—¶å€™ç›´æ¥ return æ›´æ¸…æ™°</p>
</li>
<li>
<p>åœ¨åˆé€‚çš„åœºæ™¯ä½¿ç”¨ reduce/map/filter/some/everyï¼ˆå£°æ˜å¼ï¼‰ ç­‰æ–¹æ³•æ›¿æ¢ for å¾ªç¯ï¼ˆè¿‡ç¨‹å¼ï¼‰</p>
</li>
<li>
<p>é…ç½® webpack alias é¿å…å¯¼å…¥æ¨¡å—ç›¸å¯¹è·¯å¾„è¿‡é•¿çš„é—®é¢˜</p>
</li>
</ul>
<pre><code class="language-js">// bad
import { Modal } from &quot;../../../components/&quot;;
</code></pre>
<pre><code class="language-js">// good
import { Modal } from &quot;@components&quot;;
</code></pre>
<ul>
<li>å…¬å…±ç»„ä»¶éœ€è¦æœ‰ propTypes ä»¥åŠ defaultPropTypes é™æ€å±æ€§</li>
</ul>
<p>çœ‹äº† propTypes å±æ€§å°±åŸºæœ¬äº†è§£äº†ç»„ä»¶çš„ä½¿ç”¨æ–¹å¼ï¼Œä»£ç å³æ–‡æ¡£ï¼Œå¦‚æœ typescript æ›´å¥½ï¼ˆinterfaceï¼‰</p>
<ul>
<li>ç›¸åŒçš„ç»„ä»¶åŠŸèƒ½ä½¿ç”¨ HOC / render props/hooks ä¼˜åŒ–ï¼ˆé«˜é˜¶ç»„ä»¶éœ€è¦æ³¨æ„å±æ€§è¦†ç›–ä¸é™æ€æ–¹æ³•ä¸¢å¤±ï¼‰</li>
</ul>
]]></content>
    </entry>
</feed>